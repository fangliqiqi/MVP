import{h as e,r as a}from"./subject.1672389691407.js";import{d as l,f as o,$ as r,c as d,W as t,P as m,aD as u,a3 as c,o as s,a as n,U as p}from"./vue.1672389691407.js";import{m as i,E as g,a as f}from"./index.1672389691407.js";const h={"class":"check-archives-dialog"},I={"class":"dialog-footer"},b=p("取 消"),y=p("确 定"),F=l({name:"addSubjectCheckInfo"}),N=Object.assign(F,{emits:["ok"],setup(l,{expose:p,emit:F}){const N=u(),w=o(null),x=r({isShowDialog:!1,loading:!1,ruleForm:{empIdcard:null,empName:null,deptNo:null},info:null}),V=()=>{x.ruleForm.empIdcard=x.ruleForm.empIdcard.replace(/[^a-zA-Z0-9]/g,"")},_=r({empName:[{required:!0,message:"请输入人员姓名",trigger:"blur"}],empIdcard:[{required:!0,message:"请输入身份证号",trigger:"blur"}],deptNo:[{required:!0,message:"请输入项目编码",trigger:"blur"}]}),k=()=>{w.value&&w.value.clearValidate(),x.ruleForm={empIdcard:null,empName:null,deptNo:null},x.isShowDialog=!1},v=()=>{x.loading=!0,e(x.ruleForm).then((e=>{var l;e&&200===e.code?(N.push({path:"/archives/subject/add",query:{empIdcard:x.ruleForm.empIdcard,empName:x.ruleForm.empName,deptNo:x.ruleForm.deptNo,_t:i(x.ruleForm.empIdcard+x.ruleForm.empName+x.ruleForm.deptNo)}}),k()):e&&2===e.code?(l={empId:e.data.employeeId,empProId:e.data.empProId},f.confirm("该人员已减档减项，是否'复档复项'？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{const e=await a(l);e&&200===e.code?(g.success("复档复项成功"),F("ok"),k()):g.error(e.msg||"复档复项失败")}catch(e){g.error(e.msg||"复档复项失败")}}))["catch"]((()=>{}))):e&&3===e.code?(e=>{f.confirm("该人员在离职库已存在，是否'恢复档案'？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{const l=await a(e);l&&200===l.code?(g.success("恢复档案成功"),F("ok"),k()):g.error(l.msg||"恢复档案失败")}catch(l){g.error(l.msg||"恢复档案失败")}}))["catch"]((()=>{}))})({empId:e.data.employeeId}):e&&4===e.code?(e=>{f.confirm("该人员已减项，是否复项？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{const l=await a(e);l&&200===l.code?(g.success("复项成功"),F("ok"),k()):g.error(l.msg||"复项失败")}catch(l){g.error(l.msg||"复项失败")}}))["catch"]((()=>{}))})({empProId:e.data.empProId}):g.error(e.msg||"数据校验不通过")}))["finally"]((()=>{x.loading=!1}))},j=()=>{w.value&&w.value.validate((e=>{e&&v()}))};return p({openDialog:async e=>{x.info=e,x.isShowDialog=!0}}),(e,a)=>{const l=c("el-input"),o=c("el-form-item"),r=c("el-col"),u=c("el-row"),p=c("el-form"),i=c("el-button"),g=c("el-dialog");return s(),d("div",h,[t(g,{title:"人员项目档案新增",modelValue:x.isShowDialog,"onUpdate:modelValue":a[3]||(a[3]=e=>x.isShowDialog=e),"close-on-click-modal":!1,width:"576px",onClose:k},{footer:m((()=>[n("span",I,[t(i,{onClick:k,size:"default"},{"default":m((()=>[b])),_:1}),t(i,{type:"primary",onClick:j,loading:x.loading,size:"default"},{"default":m((()=>[y])),_:1},8,["loading"])])])),"default":m((()=>[t(p,{ref_key:"formRef",ref:w,model:x.ruleForm,rules:_,size:"default","label-width":"90px"},{"default":m((()=>[t(u,null,{"default":m((()=>[t(r,{"class":"mb20"},{"default":m((()=>[t(o,{label:"姓名",prop:"empName"},{"default":m((()=>[t(l,{modelValue:x.ruleForm.empName,"onUpdate:modelValue":a[0]||(a[0]=e=>x.ruleForm.empName=e),placeholder:"请输入人员姓名",maxlength:"20",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),t(r,{"class":"mb20"},{"default":m((()=>[t(o,{label:"身份证号",prop:"empIdcard"},{"default":m((()=>[t(l,{modelValue:x.ruleForm.empIdcard,"onUpdate:modelValue":a[1]||(a[1]=e=>x.ruleForm.empIdcard=e),placeholder:"请输入身份证号",maxlength:"20",onKeyup:V,clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),t(r,{"class":"mb20"},{"default":m((()=>[t(o,{label:"项目编码",prop:"deptNo"},{"default":m((()=>[t(l,{modelValue:x.ruleForm.deptNo,"onUpdate:modelValue":a[2]||(a[2]=e=>x.ruleForm.deptNo=e),placeholder:"请输入项目编码",maxlength:"20",clearable:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}}});export{N as default};