import{ah as e,N as t,E as a,M as s,d as o,ai as r,aj as n}from"./index.1672389691407.js";import{P as i}from"./ProTable.1672389691407.js";import{P as l}from"./index.16723896914072.js";import d from"./editUser.1672389691407.js";import{d as p,f as c,$ as u,a2 as m,c as h,W as x,P as y,u as f,a3 as I,o as g,a as k,V as v,U as S}from"./vue.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";import"./role.1672389691407.js";import"./dept.1672389691407.js";const j={"class":"system-dict-container"},O={key:0},W={key:1},b=p({name:"用户管理"}),_=Object.assign(b,{setup(p){const b=c(null),_=c(null),G=c(!1),F=u({btn:[{label:"手动同步",permission:["sys_role_add"],loading:G,icon:"icon-ic_edit_refresh",onClick:async()=>{const e=o.service({lock:!0,text:"数据同步中...",background:"rgba(0, 0, 0, 0.7)"});try{G.value=!0;const t=await r();t&&200===t.code?(a.success("数据同步成功"),b.value&&b.value.refresh()):a.error(t.msg||"数据同步失败"),G.value=!1}catch(t){a.error("数据同步失败")}finally{e.close(),G.value=!1}}}],columns:[{dataIndex:"index",title:"序号",hideInSearch:!0,minWidth:"80px"},{dataIndex:"nickname",title:"姓名",minWidth:"100px"},{dataIndex:"username",title:"用户名",hideInSearch:!0,minWidth:"120px"},{dataIndex:"deptName",title:"部门",hideInSearch:!0,minWidth:"140px"},{dataIndex:"phone",title:"手机号",hideInSearch:!0,minWidth:"140px"},{dataIndex:"email",title:"邮箱",hideInSearch:!0,minWidth:260},{dataIndex:"roleList",title:"角色",hideInSearch:!0,minWidth:200,formatter:e=>{const t=[];return e.roleList.forEach((e=>{t.push(e.roleName)})),t.join(",")},ellipsis:!0},{dataIndex:"post",title:"职务",hideInSearch:!0,minWidth:"140px",scopedSlots:{customRender:"post"}},{dataIndex:"userGroup",title:"用户组",hideInSearch:!0,minWidth:"140px",scopedSlots:{customRender:"userGroup"}},{dataIndex:"lockFlag",title:"用户状态",hideInSearch:!0,minWidth:"140px",scopedSlots:{customRender:"lockFlag"}},{dataIndex:"createTime",title:"创建时间",hideInSearch:!0,minWidth:"180px"},{dataIndex:"option",title:"操作",key:"option",minWidth:120,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],cellBtns:[{text:"编辑",prop:"edit",permission:["sys_user_edit"]}],postTypeOptions:[],userGroupOptions:[],lockFlagOptions:[{value:"9",label:"锁定",type:"info"},{value:"0",label:"有效",type:""}]}),{columns:T,cellBtns:R,btn:w,postTypeOptions:E,userGroupOptions:L,lockFlagOptions:N}=m(F),P=(e,t)=>e.find((e=>e.value==t)),U=(e,t)=>{const a=[];return e.forEach((e=>{a.push(e[t])})),a.join(",")},z=async t=>{try{const a=await e(t);if(a&&200==a.code&&a.data)return{current:a.data.current,total:a.data.total,data:a.data.records.map(((e,a)=>({...e,index:(t.current-1)*t.size+a+1})))}}catch(a){}return{current:1,total:0,data:[]}},B=async(e,t)=>{if("edit"==e){const e=await n(t.userId),s={userGroupOptions:L.value,postTypeOptions:E.value};if(200==e.code){const t=e.data;_.value.openDialog(t,s)}else a.error(e.msg)}},C=()=>{b.value.refresh()};return t("post_type").then((e=>{e&&200==e.code&&e.data?F.postTypeOptions=e.data:a.error(e.msg)})),t("group_type").then((e=>{e&&200==e.code&&e.data?F.userGroupOptions=e.data:a.error(e.msg)})),(e,t)=>{const a=I("el-tag");return g(),h("div",j,[x(i,{"row-key":"id",ref_key:"proRef",ref:b,columns:f(T),btn:f(w),columnEmptyText:"--",request:z},{roleList:y((e=>[k("span",null,v(U(e.roleList,"roleName")),1)])),post:y((e=>[k("span",null,v(f(s)(f(E),e.post)),1)])),userGroup:y((e=>[e.userGroup?(g(),h("span",O,v(f(s)(f(L),e.userGroup)),1)):(g(),h("span",W,"--"))])),lockFlag:y((e=>[x(a,{size:"small",type:P(f(N),e.lockFlag).type},{"default":y((()=>[S(v(P(f(N),e.lockFlag).label),1)])),_:2},1032,["type"])])),option:y((e=>[x(l,{array:f(R),model:e,onOnClick:B},null,8,["array","model"])])),_:1},8,["columns","btn"]),x(d,{ref_key:"editUserRef",ref:_,onOk:C},null,512)])}}});export{_ as default};