import{P as e}from"./ProTable.1672389691407.js";import{P as t}from"./index.16723896914072.js";import a from"./insureDetailDialog.1672389691407.js";import{B as n}from"./index.16723896914077.js";import r from"./ProjectSelect.1672389691407.js";import o from"./InsureCompanySelect.1672389691407.js";import{_ as l,f as s,g as i,U as d,a as c}from"./index.1672389691407.js";import{o as u,a8 as p,a9 as m,D as h}from"./header.1672389691407.js";import"./excel.1672389691407.js";import{s as f,i as y,j as E,k as _,l as x,u as g}from"./custserve.1672389691407.js";import{reduceHandleStatus as T,isUse as I,isEffect as v,isOverdue as D}from"./dict.1672389691407.js";import{i as C,f as b,$ as R,j as w,a2 as S,c as H,W as N,P as j,a3 as A,o as k,a as M,U as O,V as Y,T as F,ay as B,az as P}from"./vue.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";import"./xlsx.1672389691407.js";import"./company.1672389691407.js";const U={name:"已投保",components:{ProTable:e,ProButtons:t,insureDetailDialog:a,batchImportDialog:n,ArrowDown:s,ProjectSelect:r,CompanySelect:o},setup(){var e;const t=null==(e=C())?void 0:e.appContext.config.globalProperties.$message,a=b(null),n=b(null),r=b(null),o=b(null),l=b(null),s=R({params:{deptNo:null,insuranceCompanyName:null},searchConfig:{labelWidth:"110px",option:{extBtn:"extBtns"}},columns:[{dataIndex:"reduceHandleStatus",title:"减员状态",width:115,hideInSearch:!0,valueEnum:T},{dataIndex:"buyType",title:"投保类型",width:90,valueEnum:{1:"新增",3:"批增",4:"替换"}},{dataIndex:"projectName",title:"项目",minWidth:140,hideInSearch:!0,ellipsis:!0},{dataIndex:"empName",title:"姓名",width:100},{dataIndex:"empIdcardNo",title:"身份证号",width:170},{dataIndex:"insuranceCompanyName",title:"保险公司",minWidth:120,ellipsis:!0,hideInSearch:!0},{dataIndex:"insuranceCompanyName",title:"保险公司",hideInTable:!0,valueType:"custom",scopedSlots:{customRender:"CompanySelect"}},{dataIndex:"insuranceTypeName",title:"险种",minWidth:120,hideInSearch:!0,ellipsis:!0},{dataIndex:"reduceHandleStatus",title:"减员状态",width:90,hideInTable:!0,valueEnum:{1:"待减员",2:"减员中",3:"减员退回",4:"减员成功"}},{dataIndex:"policyDate",title:"保单起止时间",minWidth:220,hideInSearch:!0,scopedSlots:{customRender:"BeginEndTime"}},{dataIndex:"buyStandard",title:"购买标准（元）",width:120,hideInSearch:!0},{dataIndex:"isUse",title:"是否出险",width:90,valueEnum:I},{dataIndex:"isEffect",title:"是否有效",valueEnum:v,hideInSearch:!0},{dataIndex:"isOverdue",title:"是否过期",valueEnum:D},{dataIndex:"deptNo",title:"项目",valueType:"custom",hideInTable:!0,scopedSlots:{customRender:"ProjectSelect"}},{dataIndex:"policyNo",title:"保单号",hideInTable:!0},{dataIndex:"policyDate",title:"保单起止日期",hideInTable:!0,selectType:"daterange",format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",searchIndex:"startEndTime",startTime:"policyStart",endTime:"policyEnd",valueType:"dateTimeRange"},{dataIndex:"invoiceNo",title:"发票号",hideInTable:!0},{dataIndex:"createName",title:"派单人",width:90},{width:100,dataIndex:"createTime",title:"派单日期",selectType:"daterange",format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",searchIndex:"startEndTime_1",startTime:"createStartTime",endTime:"createEndTime",valueType:"dateTimeRange"},{dataIndex:"id",title:"id",width:180,hideInSearch:!0},{dataIndex:"option",title:"操作",key:"option",width:120,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"导出已投保名册",onClick:()=>{const e=Object.assign({},s.params,a.value.getParams());delete e.size,delete e.current,s.btn.find((e=>"导出已投保名册"===e.label)).loading=!0,x(e).then((e=>{t.success("导出成功")}))["finally"]((()=>{s.btn.find((e=>"导出已投保名册"===e.label)).loading=!1}))},permission:["insurance_custserve_insured_export"],icon:"icon-ic_edit_export"},{label:"减员",onClick:()=>{r.value&&r.value.openDialog()},permission:["insurance_custserve_insured_reduce"],type:"normal"},{label:"变更项目",onClick:()=>{o.value&&o.value.openDialog()},permission:["insurance_custserve_insured_change_dept"],type:"normal"},{label:"变更结算月",onClick:()=>{l.value&&l.value.openDialog()},permission:["insurance_custserve_insured_change_month"],type:"normal"}],cellBtns:[{text:"查看",prop:"detail",permission:["insurance_custserve_insured_detail"]},{text:"出险\t",prop:"edit",permission:["insurance_custserve_insured_edit"],tooltip:"当前转态不可出险",isGray:e=>1==e.isUse||(1==e.isEffect||(1==e.isOverdue||(1==e.reduceHandleStatus||2==e.reduceHandleStatus||4==e.reduceHandleStatus)))}]});w((()=>{i(["emp_natrue"]).then((e=>{s.dict=e,s.columns=s.columns.map((t=>{const a={...t};if("empNatrue"===t.dataIndex)a.valueEnum=e.emp_natrue;return a}))}))}));return{...S(s),request:async e=>{const t=Object.assign({},s.params,e);try{const e=await _({size:t.size,current:t.current,mId:t.mId},t);if(e&&200==e.code&&e.data)return{current:e.data.current,total:e.data.total,data:e.data.records||[]}}catch(a){}return{current:1,total:0,data:[]}},onCellClick:async(e,r)=>{switch(e){case"detail":n.value&&n.value.openDialog(r);break;case"edit":(e=>{c.confirm('<p style="font-size:16px;font-weight:600">确定标记该人员出险吗？<br/>\n\t\t\t\t<span style="color:red;font-size:14px;font-weight:400">出险后，无法减员，请谨慎操作！</span></p>',{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((async()=>{try{const n=await g(e.id);n&&200===n.code?(t.success("出险成功"),a.value&&a.value.doSearch()):t.error(n.msg||"出险失败")}catch(n){t.error("出险失败")}}))["catch"]((()=>{}))})(r)}},proTableRef:a,refreshList:()=>{a.value&&a.value.refresh()},insureDetailRef:n,reduceInsureRef:r,deptChangeRef:o,settleMonthChangeRef:l,onReset:()=>{s.params={deptNo:null,insuranceCompanyName:null}},formatRangeDateAndDiff:d,INSURE_REDUCE_HEADER:u,customErrorHeader:e=>{const t=[];return Object.keys(e).forEach((a=>{t.push({header:e[a],key:a,width:18})})),t.push({header:"错误原因",key:"errorMessage",width:30}),t},reduceInsuranceByFile:(e,t)=>f(t),DEPT_CHANGE_HEADER:p,deptChangeByFile:(e,t)=>y(t),SETTLE_MONTH_CHANGE_HEADER:m,settleMonthChangeByFile:(e,t)=>E(t),DATE_FORMAT_KEY:h}}},z=e=>(B("data-v-434a9822"),e=e(),P(),e),K={"class":"custserve-container"},L={"class":"el-dropdown-link"},G=O(" 模板下载 "),V=z((()=>M("a",{href:"/template/insurance/商险减员模板.xlsx",download:""},"减员模板",-1))),W=z((()=>M("a",{href:"/template/insurance/商险变更项目模板.xlsx",download:""},"变更项目模板",-1))),q=z((()=>M("a",{href:"/template/insurance/商险变更结算月模板.xlsx",download:""},"变更结算月模板",-1))),$={key:0,style:{color:"red"}},J=z((()=>M("div",null,[
M("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"减员失败！"),
M("span",null,[
O("存在不符合要求的数据，请修改后，重新导入！"),
M("br"),
O("已为您下载反馈结果！")])],-1))),Q=z((()=>M("div",null,[
M("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"项目变更失败！"),
M("span",null,[
O("存在不符合要求的数据，请修改后，重新导入！"),
M("br"),
O("已为您下载反馈结果！")])],-1))),X=z((()=>M("div",null,[
M("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"变更结算月失败！"),
M("span",null,[
O("存在不符合要求的数据，请修改后，重新导入！"),
M("br"),
O("已为您下载反馈结果！")])],-1)));var Z=l(U,[["render",function(e,t,a,n,r,o){const l=A("arrow-down"),s=A("el-icon"),i=A("el-button"),d=A("el-dropdown-item"),c=A("el-dropdown-menu"),u=A("el-dropdown"),p=A("project-select"),m=A("company-select"),h=A("pro-buttons"),f=A("pro-table"),y=A("insure-detail-dialog"),E=A("batch-import-dialog");return k(),H("div",K,[N(f,{ref:"proTableRef","row-key":"id",columns:e.columns,request:n.request,btn:e.btn,searchConfig:e.searchConfig,onOnReset:n.onReset},{extBtns:j((()=>[N(u,{style:{"margin-left":"6px"},"popper-class":"module-download"},{dropdown:j((()=>[N(c,null,{"default":j((()=>[N(d,null,{"default":j((()=>[V])),_:1}),N(d,null,{"default":j((()=>[W])),_:1}),N(d,null,{"default":j((()=>[q])),_:1})])),_:1})])),"default":j((()=>[M("span",L,[N(i,{size:"default"},{"default":j((()=>[G,N(s,{"class":"el-icon--right"},{"default":j((()=>[N(l)])),_:1})])),_:1})])])),_:1})])),ProjectSelect:j((()=>[N(p,{modelValue:e.params.deptNo,"onUpdate:modelValue":t[0]||(t[0]=t=>e.params.deptNo=t),style:{width:"100%"}},null,8,["modelValue"])])),CompanySelect:j((()=>[N(m,{modelValue:e.params.insuranceCompanyName,"onUpdate:modelValue":t[1]||(t[1]=t=>e.params.insuranceCompanyName=t),style:{width:"100%"}},null,8,["modelValue"])])),BeginEndTime:j((e=>[O(Y(n.formatRangeDateAndDiff(e.policyStart,e.policyEnd))+" ",1),e.buyMonth?(k(),H("span",$,Y(`${e.buyMonth}个月`),1)):F("",!0)])),option:j((t=>[N(h,{array:e.cellBtns,model:t,onOnClick:n.onCellClick},null,8,["array","model","onOnClick"])])),_:1},8,["columns","request","btn","searchConfig","onOnReset"]),N(y,{ref:"insureDetailRef"},null,512),N(E,{title:"发起减员",ref:"reduceInsureRef",header:n.INSURE_REDUCE_HEADER,upload:n.reduceInsuranceByFile,onOk:n.refreshList,type:1,customError:"",errorHeader:n.customErrorHeader(n.INSURE_REDUCE_HEADER),download:"",dateFormatKeys:n.DATE_FORMAT_KEY},{error:j((()=>[J])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"]),N(E,{title:"变更项目",ref:"deptChangeRef",header:n.DEPT_CHANGE_HEADER,upload:n.deptChangeByFile,onOk:n.refreshList,type:1,customError:"",errorHeader:n.customErrorHeader(n.DEPT_CHANGE_HEADER),download:"",dateFormatKeys:n.DATE_FORMAT_KEY},{error:j((()=>[Q])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"]),N(E,{title:"变更结算月",ref:"settleMonthChangeRef",header:n.SETTLE_MONTH_CHANGE_HEADER,upload:n.settleMonthChangeByFile,onOk:n.refreshList,type:1,customError:"",errorHeader:n.customErrorHeader(n.SETTLE_MONTH_CHANGE_HEADER),download:"",dateFormatKeys:n.DATE_FORMAT_KEY},{error:j((()=>[X])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"])])}],["__scopeId","data-v-434a9822"]]);export{Z as default};