import{e,f as a,h as t,j as n,k as r,l as o}from"./handle.1672389691407.js";import{_ as l,f as s,U as i,g as d,a as c,h as u}from"./index.1672389691407.js";import{P as m}from"./ProTable.1672389691407.js";import{P as p}from"./index.16723896914072.js";import h from"./checkInfo.16723896914072.js";import{B as f}from"./index.16723896914077.js";import{E as g}from"./index.16723896914076.js";import{f as _,$ as b,j as y,a2 as E,c as S,W as I,P as D,aD as x,i as C,a3 as R,o as T,U as k,V as N,T as v,a as w,u as H,ay as O,az as A}from"./vue.1672389691407.js";import M from"./ProjectSelect.1672389691407.js";import j from"./InsureCompanySelect.1672389691407.js";import{aQ as L,a3 as P,D as U,aR as Y,aN as B,aS as z,aT as F,aU as V,aP as K}from"./header.1672389691407.js";import W from"./insureDetailDialog.1672389691407.js";import{buyHandleStatus as $,buyType as X,settleType as q}from"./dict.1672389691407.js";import{a as G}from"./excel.1672389691407.js";import Q from"./downshiftDialog.16723896914072.js";import J from"./ChangeDialog.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";import"./staff.1672389691407.js";import"./xlsx.1672389691407.js";import"./vuedraggable.umd.1672389691407.js";import"./custserve.1672389691407.js";import"./company.1672389691407.js";const Z={name:"投保办理",components:{ProTable:m,ProButtons:p,ArrowDown:s,checkInfoVue:h,BatchImportDialog:f,ExportExcelDialog:g,insureDetailDialog:W,ProjectSelect:M,CompanySelect:j,downShiftDialog:Q,ChangeDialog:J},setup(){x();const{appContext:l}=C(),s=_(!1),m=l.config.globalProperties.$message,p=_(null),h=_(null),f=_(null),g=_(null),S=_(null),I=_(null),D=_(null),R=_(null),T=_(null),k=_(null),N=_(null),v=_(null),w=_(null),O=_(null),A=_(null),W=_(null),Q=(e,a)=>e&&a?`${e}/${a}`:e?`${e}`:a?`${a}`:"",J=_(null),Z=()=>{p.value&&p.value.refresh()},ee=e=>{let a=null;if(ne.selectionChangeList.length>0){a={idList:ne.selectionChangeList.map((e=>e.id))}}else a=Object.assign(p.value.getParams(),ne.params),delete a.size,delete a.current;return{...a,buyHandleStatus:e}},ae=(e,a)=>{const t=e.data&&e.data.map((e=>(e.insuranceAddress=Q(e.insuranceProvinceName,e.insuranceCityName),e.insuranceHandleAddress=Q(e.insuranceHandleProvinceName,e.insuranceHandleCityName),e.settleType=q[e.settleType],e.buyType=X[e.buyType],e)));let n=t.filter((e=>"替换"===e.buyType)),r=t.filter((e=>"替换"!==e.buyType));0!==t.length?G([V,K],[r,n],["新增批增","替换"],a||`商险投保导出办理人员名册${u().format("YYYYMMDDHHmmss")}`):m.error("导出办理数据为空！")},te=e=>{switch(ne.downSizeState){case"1":return!!["insure_export","insure_back"].includes(e);case"2":return!!["insure_success","insure_back","insure_mulity"].includes(e);case"3":return!!["insure_set","insure_back"].includes(e)}},ne=b({tabChangeing:!1,searchConfig:{labelWidth:110,option:{extBtn:"extBtns"}},columns:[{dataIndex:"buyHandleStatus",title:"投保状态",width:110,hideInSearch:!0,valueEnum:$},{dataIndex:"buyType",title:"投保类型",hideInSearch:!0,width:110,valueEnum:X},{dataIndex:"projectName",title:"项目",hideInSearch:!0,minWidth:180,ellipsis:!0},{dataIndex:"projectName",title:"所在项目",hideInTable:!0,valueType:"custom",scopedSlots:{customRender:"ProjectSelect"}},{dataIndex:"empName",title:"姓名",hideInSearch:!0,minWidth:120},{dataIndex:"empName",title:"员工姓名",hideInTable:!0},{dataIndex:"empIdcardNo",title:"身份证号",hideInSearch:!0,minWidth:180},{dataIndex:"empIdcardNo",title:"员工身份证号",hideInTable:!0},{dataIndex:"insuranceCompanyName",title:"保险公司",hideInTable:!0,valueType:"custom",scopedSlots:{customRender:"CompanySelect"}},{dataIndex:"insuranceCompanyName",title:"保险公司",hideInSearch:!0,minWidth:120},{dataIndex:"insuranceTypeName",title:"险种",minWidth:120},{dataIndex:"createTime",title:"保单起止时间",hideInSearch:!0,minWidth:230,valueType:"custom",scopedSlots:{customRender:"BeginEndTime"},ellipsis:!0},{dataIndex:"buyType",title:"派单类型",hideInTable:!0,minWidth:140,valueEnum:X},{dataIndex:"createName",title:"派单人",hideInTable:!0,minWidth:120},{dataIndex:"createTime",title:"派单时间",minWidth:180,hideInTable:!0,searchIndex:"startEndTime",startTime:"startDate",endTime:"endDate",format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",valueType:"dateTimeRange"},{dataIndex:"buyStandard",title:"购买标准（元）",hideInSearch:!0,minWidth:120},{dataIndex:"buyStandard",title:"购买标准",hideInTable:!0,minWidth:120,valueType:"custom",scopedSlots:{customRender:"buyStandard"}},{dataIndex:"createName",title:"派单人",hideInSearch:!0,minWidth:120},{dataIndex:"createTime",title:"派单日期",width:100,hideInSearch:!0,dateFormat:"YYYY-MM-DD"},{dataIndex:"option",title:"操作",key:"option",width:100,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"导出",onClick:()=>{ne.btn.find((e=>"导出"==e.label)).loading=!0,o(ee(2)).then((e=>{e&&200===e.code?ae(e,`商险投保导出投保中人员名册${u().format("YYYYMMDDHHmmss")}`):m.error(e.msg||"操作失败")}))["finally"]((()=>{ne.btn.find((e=>"导出"==e.label)).loading=!1}))},permission:["handle_insure_export"],type:"default",icon:"icon-ic_edit_upload",show:()=>"2"===ne.downSizeState},{label:"导出",onClick:()=>{ne.btn.find((e=>"导出"==e.label)).loading=!0,o(ee(3)).then((e=>{e&&200===e.code?ae(e,`商险投保导出已投保人员名册${u().format("YYYYMMDDHHmmss")}`):m.error(e.msg||"操作失败")}))["finally"]((()=>{ne.btn.find((e=>"导出"==e.label)).loading=!1}))},permission:["handle_insure_export"],type:"default",icon:"icon-ic_edit_upload",show:()=>"3"===ne.downSizeState},{label:"批量办理",type:"default",icon:"icon-ic_edit_upload",onClick:()=>{w.value&&w.value.openDialog()},permission:["handle_insure_batch"],show:()=>te("insure_mulity")},{label:"导出办理",onClick:()=>{c.confirm('<p style="font-size:16px;font-weight:600">办理成功<br/>\n\t\t\t\t<span style="color:red;font-size:14px;font-weight:400">确定这些记录导出办理吗？</span></p>',{type:"warning",dangerouslyUseHTMLString:!0}).then((async()=>{try{const e=await o(ee(1));e&&200===e.code?(ae(e),Z()):(m.error(e.msg||"操作失败"),Z())}catch(e){m.error(e.msg||"操作失败")}}))["catch"]((()=>{}))},permission:["handle_insure_export"],type:"default",icon:"icon-ic_edit_upload",show:()=>te("insure_export")},{label:"登记保单保费",type:"default",onClick:()=>{T.value&&T.value.openDialog()},permission:["handle_insure_cost"],icon:"icon-ic_edit_refresh",show:()=>te("insure_set")},{label:"登记发票号",type:"default",onClick:()=>{var e;null==(e=O.value)||e.openDialog()},permission:["handle_insure_invoice"],icon:"icon-ic_edit_refresh",show:()=>te("insure_set")},{label:"参保信息变更",type:"default",onClick:()=>{var e;null==(e=A.value)||e.openDialog()},permission:["handle_insured"],icon:"icon-ic_edit_refresh",show:()=>te("insure_set")},{label:"投保成功",type:"default",onClick:()=>{ne.selectionChangeList&&0!==ne.selectionChangeList.length?v.value.openDialog(ne.selectionChangeList):m.error("请勾选需要操作的记录")},permission:["handle_insure_back"],icon:"icon-ic_edit_refresh",show:()=>te("insure_success"),disabled:()=>0===ne.selectionChangeList.length},{label:"退回",type:"danger",onClick:()=>{ne.selectionChangeList&&0!==ne.selectionChangeList.length?N.value.openDialog(ne.selectionChangeList):m.error("请勾选需要操作的记录")},icon:"icon-ic_edit_export",show:()=>te("insure_back"),disabled:()=>0===ne.selectionChangeList.length}],cellBtns:[{text:"查看",prop:"detail"},{text:"变更",prop:"change",permission:["handle_insured_by_id"],isHide:()=>!te("insure_set")}],DICTS:{},dictKeys:["emp_natrue","emp_married","emp_national","emp_political","emp_registype","education","EMP_SOURCE","social_ecurity_state","commercial_satte","personnel_state","fund_status"],params:{deptNo:"",insuranceCompanyName:"",buyStandardMin:null,buyStandardMax:null},areaProps:{label:"areaName",isLeaf:"isLeaf",children:"children"},selectionChangeList:[],downSizeState:"1"});y((()=>{(async()=>{try{const e=await d(ne.dictKeys);e&&(ne.DICTS=e,ne.columns=ne.columns.map((a=>{const t={...a};switch(a.dataIndex){case"empNatrue":t.valueEnum=e.emp_natrue;break;case"fileSource":t.valueEnum=e.EMP_SOURCE;break;case"socialStatus":t.valueEnum=e.social_ecurity_state;break;case"insuranceStatus":t.valueEnum=e.commercial_satte;break;case"fundStatus":t.valueEnum=e.fund_status;break;case"contractStatus":t.valueEnum=e.personnel_state}return t})))}catch(e){}})()}));const re=_(),oe=_(),le=(e,a)=>{const t=`${e}`.replace(/\D|[^\d]/g,"");return setTimeout((()=>{e!==t&&(s.value=!0,setTimeout((()=>{s.value=!1,setTimeout((()=>{H(a).focus()}),0)}),0))}),0),t};return{...E(ne),formatterToNumberMin:e=>le(e,re),formatterToNumberMax:e=>le(e,oe),buyStandardMinRef:re,buyStandardMaxRef:oe,forceUpdateInput:s,request:async e=>{try{const a=Object.assign({},e,ne.params,{buyHandleStatus:ne.downSizeState});delete a.fileAddress;const t=await r({size:a.size,current:a.current,mId:a.mId},a);if(t&&200==t.code&&t.data)return{current:t.data.current,total:t.data.total,data:t.data.records}}catch(a){}return{current:1,total:0,data:[]}},onCellClick:async(e,a)=>{var t;switch(e){case"detail":J.value&&J.value.openDialog(a);break;case"change":null==(t=W.value)||t.openDialog(a)}},proTableRef:p,insureDetailRef:J,checkInfoDialog:h,downshiftDialog:f,batchImportDialog:g,batchDownshiftDialog:D,refreshList:Z,batchUpdateDialog:S,selectionChange:e=>{ne.selectionChangeList=e},exportExcelRef:I,onReset:()=>{ne.params={}},batchDeleteDialog:R,INSURE_REG_HEADER_EXPORT:L,STAFF_BATCH_DEL_ERROR_HEADER:P,DATE_FORMAT_KEY:U,customErrorHeader:e=>{const a=[];return Object.keys(e).forEach((t=>{a.push({header:e[t],key:t,width:18})})),a.push({header:"错误原因",key:"errorMessage",width:30}),a},HANDLE_BACK_INSURANCE_HEADER:Y,tabChange:e=>{Z()},registeredPolic:T,registeredPolicy:(e,a)=>t(a),batchErrorData:(e,a)=>{let t=null;switch(e){case"staff-batch-delete":case"staff-batch-back":t=a.map((e=>(e.buyHandleStatus=$[e.buyHandleStatus],e.buyType=X[e.buyType],e.policeStartEnd=`${e.policyStart}-${e.policyEnd}`,e)))}return t},formatRangeDateAndDiff:i,batchBackDialog:k,ProjectSelect:M,CompanySelect:j,downShiftDialog:N,openBatchBack:e=>{k.value.openErrorDialog(e)},INSURE_MULITY_HEADER:B,insureSucessDialog:v,openBatchInsureSucess:e=>{R.value.openErrorDialog(e)},sucessBackInsureSucess:()=>{Z()},sucessBack:()=>{Z()},handleMulityInsure:(e,a)=>n(a),mulityInsure:w,INSURE_INVOICE_HEADER_EXPORT:z,INSURE_INFORMATION_CHANGE_HEADER_EXPORT:F,registeredInvoiceNo:(a,t)=>e(t),registeredInvoice:O,informationChange:A,insInformationChange:(e,t)=>a(t),changeDialog:W}}},ee=e=>(O("data-v-d18ce5a4"),e=e(),A(),e),ae={"class":"archives-online-container"},te={key:0,style:{color:"red"}},ne={"class":"el-dropdown-link"},re=k(" 模板下载 "),oe=ee((()=>w("a",{href:"/template/insurance/商险登记保单保费模板.xlsx",download:""},"登记保单保费模板",-1))),le=ee((()=>w("a",{href:"/template/insurance/商险批量办理模板.xlsx",download:""},"商险批量办理模板",-1))),se=ee((()=>w("a",{href:"/template/insurance/商险批量变更模板.xlsx",download:""},"商险批量变更模板",-1))),ie=ee((()=>w("a",{href:"/template/insurance/商险登记发票号模板.xlsx",download:""},"登记发票号模板",-1))),de={key:0,"class":"buy-standard-range"},ce=ee((()=>w("span",{"class":"buy-standard-range--middle"},"-",-1))),ue=ee((()=>w("div",null,[
w("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"登记保单保费失败！"),
w("span",null,[
k("存在不符合要求的数据，请修改后，重新导入！"),
w("br"),
k("已为您下载反馈结果！")])],-1))),me=ee((()=>w("div",null,[
w("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"登记发票号失败！"),
w("span",null,[
k("存在不符合要求的数据，请修改后，重新导入！"),
w("br"),
k("已为您下载反馈结果！")])],-1))),pe=ee((()=>w("div",null,[
w("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"参保信息变更失败！"),
w("span",null,[
k("存在不符合要求的数据，请修改后，重新导入！"),
w("br"),
k("已为您下载反馈结果！")])],-1))),he=ee((()=>w("div",null,[
w("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批量办理失败！"),
w("span",null,[
k("存在不符合要求的数据，请修改后，重新导入！"),
w("br"),
k("已为您下载反馈结果！")])],-1))),fe=ee((()=>w("div",null,[
w("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"办理成功失败！"),
w("span",null,"已为您下载反馈结果！")],-1))),ge=ee((()=>w("div",null,[
w("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"退回失败！"),
w("span",null,"已为您下载反馈结果！")],-1)));var _e=l(Z,[["render",function(e,a,t,n,r,o){const l=R("el-tab-pane"),s=R("el-tabs"),i=R("arrow-down"),d=R("el-icon"),c=R("el-button"),u=R("el-dropdown-item"),m=R("el-dropdown-menu"),p=R("el-dropdown"),h=R("project-select"),f=R("company-select"),g=R("el-input"),_=R("pro-buttons"),b=R("pro-table"),y=R("check-info-vue"),E=R("down-shift-dialog"),x=R("batch-import-dialog"),C=R("change-dialog"),H=R("insure-detail-dialog");return T(),S("div",ae,[I(b,{ref:"proTableRef","row-key":"id",columns:e.columns,request:n.request,btn:e.btn,multi:!0,searchConfig:e.searchConfig,onSelectionChange:n.selectionChange,onOnReset:n.onReset,onOnLoading:a[5]||(a[5]=a=>{e.tabChangeing=a})},{tabChange:D((()=>[I(s,{type:"card","class":"card",onTabChange:n.tabChange,modelValue:e.downSizeState,"onUpdate:modelValue":a[0]||(a[0]=a=>e.downSizeState=a)},{"default":D((()=>[I(l,{label:"待投保",name:"1",disabled:e.tabChangeing},null,8,["disabled"]),I(l,{label:"投保中",name:"2",disabled:e.tabChangeing},null,8,["disabled"]),I(l,{label:"已投保",name:"3",disabled:e.tabChangeing},null,8,["disabled"])])),_:1},8,["onTabChange","modelValue"])])),BeginEndTime:D((e=>[k(N(n.formatRangeDateAndDiff(e.policyStart,e.policyEnd))+" ",1),e.buyMonth?(T(),S("span",te,N(`${e.buyMonth}个月`),1)):v("",!0)])),extBtns:D((()=>[I(p,{"popper-class":"module-download",style:{"margin-left":"6px"}},{dropdown:D((()=>[I(m,null,{"default":D((()=>[I(u,null,{"default":D((()=>[oe])),_:1}),I(u,null,{"default":D((()=>[le])),_:1}),I(u,null,{"default":D((()=>[se])),_:1}),I(u,null,{"default":D((()=>[ie])),_:1})])),_:1})])),"default":D((()=>[w("span",ne,[I(c,{size:"default"},{"default":D((()=>[re,I(d,{"class":"el-icon--right"},{"default":D((()=>[I(i)])),_:1})])),_:1})])])),_:1})])),ProjectSelect:D((()=>[I(h,{modelValue:e.params.deptNo,"onUpdate:modelValue":a[1]||(a[1]=a=>e.params.deptNo=a),clearable:"",style:{width:"100%"}},null,8,["modelValue"])])),CompanySelect:D((()=>[I(f,{modelValue:e.params.insuranceCompanyName,"onUpdate:modelValue":a[2]||(a[2]=a=>e.params.insuranceCompanyName=a),style:{width:"100%"}},null,8,["modelValue"])])),buyStandard:D((()=>[n.forceUpdateInput?v("",!0):(T(),S("div",de,[I(g,{ref:"buyStandardMinRef",modelValue:e.params.buyStandardMin,"onUpdate:modelValue":a[3]||(a[3]=a=>e.params.buyStandardMin=a),placeholder:"最低标准","class":"buy-standard-range--left",clearable:"",formatter:e=>n.formatterToNumberMin(e)},null,8,["modelValue","formatter"]),ce,I(g,{ref:"buyStandardMaxRef",modelValue:e.params.buyStandardMax,"onUpdate:modelValue":a[4]||(a[4]=a=>e.params.buyStandardMax=a),placeholder:"最高标准","class":"buy-standard-range--right",clearable:"",formatter:e=>n.formatterToNumberMax(e)},null,8,["modelValue","formatter"])]))])),option:D((a=>[I(_,{array:e.cellBtns,model:a,onOnClick:n.onCellClick},null,8,["array","model","onOnClick"])])),_:1},8,["columns","request","btn","searchConfig","onSelectionChange","onOnReset"]),I(y,{ref:"checkInfoDialog",onOk:n.refreshList},null,8,["onOk"]),I(E,{ref:"downshiftDialog",onOk:n.refreshList},null,8,["onOk"]),I(x,{title:"登记保单保费",ref:"registeredPolic",header:n.INSURE_REG_HEADER_EXPORT,upload:n.registeredPolicy,onOk:n.refreshList,type:1,customError:"",errorHeader:n.customErrorHeader(n.INSURE_REG_HEADER_EXPORT),download:"",dateFormatKeys:n.DATE_FORMAT_KEY},{error:D((()=>[ue])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"]),I(x,{title:"登记发票号",ref:"registeredInvoice",header:n.INSURE_INVOICE_HEADER_EXPORT,upload:n.registeredInvoiceNo,onOk:n.refreshList,type:1,customError:"",errorHeader:n.customErrorHeader(n.INSURE_INVOICE_HEADER_EXPORT),download:"",dateFormatKeys:n.DATE_FORMAT_KEY},{error:D((()=>[me])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"]),I(x,{title:"参保信息变更",ref:"informationChange",header:n.INSURE_INFORMATION_CHANGE_HEADER_EXPORT,upload:n.insInformationChange,onOk:n.refreshList,type:1,customError:"",errorHeader:n.customErrorHeader(n.INSURE_INFORMATION_CHANGE_HEADER_EXPORT),download:"",dateFormatKeys:n.DATE_FORMAT_KEY},{error:D((()=>[pe])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"]),I(C,{ref:"changeDialog",onOk:n.refreshList},null,8,["onOk"]),I(x,{title:"批量办理",ref:"mulityInsure",header:n.INSURE_MULITY_HEADER,upload:n.handleMulityInsure,onOk:n.refreshList,type:1,customError:"",errorHeader:n.customErrorHeader(n.INSURE_MULITY_HEADER),download:"",dateFormatKeys:n.DATE_FORMAT_KEY},{error:D((()=>[he])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"]),I(H,{ref:"insureDetailRef"},null,512),I(x,{title:"办理成功",ref:"batchDeleteDialog",type:1,onOk:n.refreshList,errName:"办理成功",batchName:"staff-batch-delete",errorHeader:n.HANDLE_BACK_INSURANCE_HEADER,errorData:n.batchErrorData,customError:"",customErrorContent:"",download:""},{error:D((()=>[fe])),_:1},8,["onOk","errorHeader","errorData"]),I(x,{title:"退回",ref:"batchBackDialog",type:1,onOk:n.refreshList,errName:"投保退回",batchName:"staff-batch-back",errorHeader:n.HANDLE_BACK_INSURANCE_HEADER,errorData:n.batchErrorData,customError:"",customErrorContent:"",download:""},{error:D((()=>[ge])),_:1},8,["onOk","errorHeader","errorData"]),I(E,{ref:"downShiftDialog",title:"退回",required:!0,type:1,onErrorBack:n.openBatchBack,onSucess:n.sucessBack},null,8,["onErrorBack","onSucess"]),I(E,{ref:"insureSucessDialog",required:!1,title:"投保成功",type:2,onErrorBack:n.openBatchInsureSucess,onSucess:n.sucessBackInsureSucess},null,8,["onErrorBack","onSucess"])])}],["__scopeId","data-v-d18ce5a4"]]);export{_e as default};