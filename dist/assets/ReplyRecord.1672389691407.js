import{P as e}from"./ProTable.1672389691407.js";import{P as o}from"./index.16723896914072.js";import r from"./AddReply.1672389691407.js";import t from"./ReplyFileDetail.1672389691407.js";import{_ as a,F as l,E as n,C as d}from"./index.1672389691407.js";import{d as i,f as s,$ as c,c as p,W as u,P as m,A as y,o as f,F as R,a5 as x,V as h,U as k}from"./vue.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";const v=["onClick"],b=k("--"),_=i({name:"ReplyRecord"});var j=a(Object.assign(_,{props:{orderNo:String},emits:["onActionUpdate"],setup(a,{emit:i}){const k=a,_=s(null),j=s(null),N=s(null),w=c({columns:[{dataIndex:"index",title:"序号",width:100},{dataIndex:"createName",title:"回复人"},{dataIndex:"createTime",title:"回复时间"},{dataIndex:"replyContent",title:"回复内容",minWidth:150,tooltip:!0},{dataIndex:"orderReplyEnclosure",title:"相关附件",minWidth:150,tooltip:!0,valueType:"custom",scopedSlots:{customRender:"orderReplyEnclosure"},formatter:(e,o,r)=>(r||[]).reduce(((e,o)=>e+o.enclosureName+"\n"),"")},{dataIndex:"option",title:"操作",key:"option",width:100,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"添加",onClick:()=>{var e;null==(e=null==j?void 0:j.value)||e.openDialog()},permission:["order:order_uploadReplyEnclosure"],icon:"icon-ic_edit_add",disabled:()=>y("disable")}],cellBtns:[{text:"详情",prop:"detail",permission:[]}]}),E=()=>{var e;null==(e=null==_?void 0:_.value)||e.doSearch(),i("onActionUpdate")},I=async e=>{try{e.orderNo=k.orderNo;const o=await l(e);if(o&&200==o.code&&o.data)return{current:o.data.current,total:o.data.total,data:o.data.records.map(((o,r)=>({...o,index:(e.current-1)*e.size+r+1})))}}catch(o){}return{current:1,total:0,data:[]}},g=async(e,o)=>{var r;if("detail"===e)null==(r=null==N?void 0:N.value)||r.openDialog(o)};return(a,l)=>(f(),p("div",null,[u(e,{ref_key:"proTableRef",ref:_,"row-key":"id",columns:w.columns,request:I,btn:w.btn,showHeader:!1,"class":"reply-record-table"},{option:m((e=>[u(o,{array:w.cellBtns,model:e,onOnClick:g},null,8,["array","model"])])),orderReplyEnclosure:m((e=>[e.orderReplyEnclosure&&e.orderReplyEnclosure.length?(f(!0),p(R,{key:0},x(e.orderReplyEnclosure,(e=>(f(),p("a",{key:e.id,onClick:o=>(e=>{n.warning("正在下载"),d(e.id).then((e=>{const o=(e.data||"").replace(/(http:|https:)/,location.protocol);window.open(o,"_blank")}))})(e),"class":"enclosure"},h(e.enclosureName),9,v)))),128)):(f(),p(R,{key:1},[b],64))])),_:1},8,["columns","btn"]),u(r,{ref_key:"addReplyRef",ref:j,onOk:E,orderNo:k.orderNo},null,8,["orderNo"]),u(t,{ref_key:"replyFileDetailRef",ref:N},null,512)]))}}),[["__scopeId","data-v-d5bddf2e"]]);export{j as default};