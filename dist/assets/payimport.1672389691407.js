import{g as a}from"./presendorder.1672389691407.js";import{g as t,p as e,a as r}from"./payimport.16723896914072.js";import{s as o,B as n,L as s,t as d}from"./header.1672389691407.js";import{s as i,E as c,h as l}from"./index.1672389691407.js";import{r as m}from"./xlsx.1672389691407.js";import{e as Y}from"./excel.1672389691407.js";import{$ as u,f as h,k as f}from"./vue.1672389691407.js";const g=u([{dataIndex:"salaryType",title:"表单类型",defalutValue:"0",position:"header",type:"radio",radioData:{0:"薪资",3:"劳务费",4:"稿酬"},config:{onChange:a=>{g[0].value=a,g[1].value="",p(a)}}},{dataIndex:"settleDepart",title:"项目名称",position:"header",type:"page-select",span:12,config:{request:a=>E(Object.assign({},a,{flag:"1"}),"getProjectName"),valueKey:"id",title:"departName",search:"departName",placeholder:"请选择项目名称",onChange:async a=>{if(a){g[1].value=a.id,g[2].disabled=!1,g[2].value="";const e=await t(a.id);200==e.code?g[2].selectData=e.data:c.error(e.msg)}else g[2].disabled=!0,g[2].value=""}}},{dataIndex:"configId",title:"方案名称",position:"header",type:"select",span:12,selectData:[],disabled:!0,config:{value:"id",label:"name",onChange:a=>{if(a){g[2].value=a;const t=g[2].selectData.find((t=>t.id==a));g.map((a=>{"salaryMonth"==a.dataIndex?a.value=t.salaryMonth.toString():"socialMonth"==a.dataIndex?a.value=t.socialMonth.toString():"fundMonth"==a.dataIndex?a.value=t.fundMonth.toString():"socialPriority"==a.dataIndex?a.value=t.socialPriority.toString():"fundPriority"==a.dataIndex?a.value=t.fundPriority.toString():"grantType"==a.dataIndex&&(a.value=t.grantType.toString())}))}else p(0)}}},{dataIndex:"salaryMonth",title:"工资月份",position:"header",type:"select",disabled:!0,selectData:{"-6":l().subtract(6,"month").format("YYYYMM"),"-5":l().subtract(5,"month").format("YYYYMM"),"-4":l().subtract(4,"month").format("YYYYMM"),"-3":l().subtract(3,"month").format("YYYYMM"),"-2":l().subtract(2,"month").format("YYYYMM"),"-1":l().subtract(1,"month").format("YYYYMM"),0:l().format("YYYYMM"),1:l().add(1,"month").format("YYYYMM")},span:12,config:{onChange:a=>{}}},{dataIndex:"socialMonth",title:"社保月份",position:"header",type:"select",selectData:{"-6":l().subtract(6,"month").format("YYYYMM"),"-5":l().subtract(5,"month").format("YYYYMM"),"-4":l().subtract(4,"month").format("YYYYMM"),"-3":l().subtract(3,"month").format("YYYYMM"),"-2":l().subtract(2,"month").format("YYYYMM"),"-1":l().subtract(1,"month").format("YYYYMM"),0:l().format("YYYYMM"),1:l().add(1,"month").format("YYYYMM")},span:12,disabled:!0,config:{onChange:a=>{}}},{dataIndex:"fundMonth",title:"公积金月份",position:"header",type:"select",disabled:!0,selectData:{"-6":l().subtract(6,"month").format("YYYYMM"),"-5":l().subtract(5,"month").format("YYYYMM"),"-4":l().subtract(4,"month").format("YYYYMM"),"-3":l().subtract(3,"month").format("YYYYMM"),"-2":l().subtract(2,"month").format("YYYYMM"),"-1":l().subtract(1,"month").format("YYYYMM"),0:l().format("YYYYMM"),1:l().add(1,"month").format("YYYYMM")},span:12,config:{onChange:a=>{}}},{dataIndex:"socialPriority",title:"社保优先级",position:"header",type:"select",disabled:!0,selectData:{0:"生成",1:"缴纳"},span:12,config:{onChange:a=>{}}},{dataIndex:"fundPriority",title:"公积金优先级",position:"header",type:"select",disabled:!0,selectData:{0:"生成",1:"缴纳"},span:12,config:{onChange:a=>{}}},{dataIndex:"grantType",title:"发放方式",position:"header",type:"select",disabled:!0,selectData:{0:"现金",1:"转账"},span:12,config:{onChange:a=>{}}}]),p=a=>{const t=["","","configId","salaryMonth","socialMonth","fundMonth","socialPriority","fundPriority","grantType"];g[2].value="",0!=a?t.forEach(((a,t)=>{t>1&&(g[t].dataIndex="")})):t.forEach(((a,t)=>{t>1&&(g[t].dataIndex=a,g[t].value="")}))},M=h(!1),y=h(!1),b=async a=>{try{y.value=!0,M.value=!0;const t=await m(a.raw),e=t[0].headers;let r=!1;o.map((a=>{e.includes(a)||(r=!0)})),r?(c.error("请检查表头,身份证校验必须包括[员工姓名,身份证号]"),M.value=!1):I(t)}catch(t){M.value=!1,c.error(t.msg||"身份证号校验失败")}},I=async a=>{const t=a[0].data,e=[];t.map((a=>{e.push({name:a["员工姓名"],idCard:a["身份证号"]})}));const r=await async function(a){return i({url:"/yifu-check/method/tcheckidcard/checkSalaryIdCard",method:"POST",data:a})}(e);if(200==r.code)c.success("身份证校验通过"),y.value=!1,M.value=!1;else if(1==r.code){M.value=!1,c.error(r.msg||"身份证校验失败");let a=d,t=null;t=r.data.map((a=>({name:a.name,idCard:a.idCard,reason:a.isTrue?"":a.reason||"",isTrue:a.isTrue?"是":"否"}))),Y(a,t,"身份证校验结果")}},v=f((()=>{const a=g.find((a=>"salaryType"==a.dataIndex));switch(a.value||a.defalutValue){case"3":return s;case"4":return n}})),x=f((()=>{const a=g.find((a=>"salaryType"==a.dataIndex));return"0"==(a.value||a.defalutValue)?2:0})),T={salaryType:[{required:!0,message:"请选择表单类型",trigger:"change"}],settleDepart:[{required:!0,message:"请选择项目名称",trigger:"change"}],configId:[{required:!0,message:"请选择方案名称",trigger:"change"}]},C=async a=>await D(a),D=async(a,t)=>{const{file:e}=a,r={settleDepart:a.settleDepart,configId:a.configId,salaryType:a.salaryType,repeatFlag:1,...t};return await j(e,r)},P=a=>{for(const t in a)a[t]&&"string"==typeof a[t]&&(a[t]=a[t].trim());return a},j=async(a,t)=>{try{const r=[...(await m(a.raw))[0].data].map((a=>{const t=Object.keys(a),e={};return t.forEach((t=>{t.startsWith("__EMPTY")||(e[t]=a[t])})),P(e)}));return new Promise((async(a,o)=>{try{const o=await e(t,JSON.stringify(r)),n=o.message||o.msg||"导入失败";o&&o.data&&o.data.length?a({code:1,msg:n,data:o.data}):o&&200===o.code?a({code:200,msg:"导入成功",data:null}):a({code:1,msg:n,data:null})}catch(n){o({code:1,msg:"导入失败"})}}))}catch(r){return{code:1,msg:"导入失败"}}},w=(a,t)=>t.map((a=>{const t=a.message;return{line:a.lineNum,isError:t?"是":"否",error:t}})),N=[{dataIndex:"deptId",title:"项目名称",position:"header",type:"page-select",config:{request:a=>E(Object.assign({},a,{flag:"1"}),"getProjectName"),valueKey:"id",title:"departName",search:"departName",placeholder:"请选择项目名称",onChange:a=>{}}}],S=(a,t)=>{const e={deptId:a.deptId};return r(e,t)},q={deptId:[{required:!0,message:"请选择项目名称",trigger:"change"}]},E=async(t,e)=>{try{if("getProjectName"===e){const e=await a(t);if(200==e.code)return{current:e.data.current,total:e.data.total,data:e.data.records};c.error(e.msg)}}catch(r){}return{current:1,total:0,data:[]}};export{w as batchErrorData,T as batchRules,C as batchUploadFile,D as batchUploadFileExt,S as batchUploadyYearMoney,M as beforeFlag,y as cardCheck,b as changeFile,p as changePayParams,x as importType,q as momeyRules,N as moneyParams,g as payParams,v as pay_header,P as trimObj};