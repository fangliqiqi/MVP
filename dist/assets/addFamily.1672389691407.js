import{g as e}from"./staff.1672389691407.js";import{s as l,t as a,v as o}from"./attach.1672389691407.js";import{P as r}from"./index.16723896914073.js";import{E as t}from"./index.1672389691407.js";import{d,f as m,$ as i,c as u,W as s,P as n,a3 as p,o as c,a as f,F as g,a5 as h,O as y,U as b}from"./vue.1672389691407.js";const F={"class":"system-add-dic-container"},V={"class":"dialog-footer"},_=b("取 消"),w=b("确 定"),N=d({name:"systemAddDic"}),k=Object.assign(N,{emits:["ok"],setup(d,{expose:b,emit:N}){const k=m(null),x=m(null),S=i({isShowDialog:!1,id:null,loading:!1,title:"新增家庭信息",ruleForm:{empId:"",empCode:"",empIdcard:"",empName:"",familyName:"",relationshipSelf:"",birthday:"",workUnit:"",contractTel:""},options:[],relationList:[]}),U={empName:[{required:!0,message:"请选择员工",trigger:"change"}],familyName:[{required:!0,message:"请输入成员姓名",trigger:"blur"},{min:2,max:20,message:"成员姓名长度在 2 到 20 个字符",trigger:"blur"}],relationshipSelf:[{required:!0,message:"请选择与本人的关系",trigger:"change"}],contractTel:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},v=async l=>{try{l.fileStatus=0;const a=await e(l);if(a&&200==a.code&&a.data)return{current:a.data.current,total:a.data.total,data:a.data.records};t.error(a.msg)}catch(a){}return{current:1,total:0,data:[]}},I=e=>{S.ruleForm.empCode=e.empCode,S.ruleForm.empId=e.id,S.ruleForm.empIdcard=e.empIdcard,S.options=[e]},D=e=>e.getTime()>Date.now(),C=async e=>{try{const a=await l(e);if(a&&200===a.code){const e={...a.data};S.options=[{empIdcard:e.empIdcard,empName:e.empName}],S.ruleForm=e,S.isShowDialog=!0}else t.error(a.msg||"获取家庭信息详情失败")}catch(a){T(),t.error("获取家庭信息详情失败")}},T=()=>{k.value.resetFields(),S.ruleForm={empId:"",empCode:"",empIdcard:"",empName:"",familyName:"",relationshipSelf:"",birthday:"",workUnit:"",contractTel:""},S.isShowDialog=!1,S.id=null,S.loading=!1},j=()=>{T()},q=()=>{k.value&&k.value.validate((e=>{e&&(S.loading=!0,null!==S.id&&void 0!==S.id?a(S.ruleForm).then((e=>{e&&200==e.code?(t.success("编辑家庭信息成功"),N("ok"),T()):t.error(e.msg||"编辑家庭信息失败")}),(()=>{t.error("编辑家庭信息失败")}))["finally"]((()=>{S.loading=!1})):o(S.ruleForm).then((e=>{e&&200==e.code?(t.success("新增家庭信息成功"),N("ok"),T()):t.error(e.msg||"新增家庭信息失败")}),(()=>{t.error("新增家庭信息失败")}))["finally"]((()=>{S.loading=!1})))}))};return b({openDialog:async(e,l)=>{S.relationList=l,S.loading=!1,e&&e.id?(S.title="编辑家庭信息",S.id=e.id,await C(e.id)):(S.title="新增家庭信息",S.id=null,S.ruleForm={empId:"",empCode:"",empIdcard:"",empName:"",familyName:"",relationshipSelf:"",birthday:"",workUnit:"",contractTel:""},S.isShowDialog=!0)}}),(e,l)=>{const a=p("el-form-item"),o=p("el-col"),t=p("el-input"),d=p("el-option"),m=p("el-select"),i=p("el-date-picker"),b=p("el-row"),N=p("el-form"),C=p("el-button"),Y=p("el-dialog");return c(),u("div",F,[s(Y,{title:S.title,modelValue:S.isShowDialog,"onUpdate:modelValue":l[7]||(l[7]=e=>S.isShowDialog=e),"close-on-click-modal":!1,width:"816px",onClose:T},{footer:n((()=>[f("span",V,[s(C,{onClick:j,size:"default"},{"default":n((()=>[_])),_:1}),s(C,{type:"primary",onClick:q,loading:S.loading,size:"default"},{"default":n((()=>[w])),_:1},8,["loading"])])])),"default":n((()=>[s(N,{ref_key:"formRef",ref:k,model:S.ruleForm,rules:U,size:"default","label-width":"110px"},{"default":n((()=>[s(b,null,{"default":n((()=>[s(o,{md:12,lg:12,xl:12},{"default":n((()=>[s(a,{label:"员工姓名",prop:"empName"},{"default":n((()=>[s(r,{disabled:!!S.id,ref_key:"pageSelectRef",ref:x,modelValue:S.ruleForm.empName,"onUpdate:modelValue":l[0]||(l[0]=e=>S.ruleForm.empName=e),request:v,"value-key":"empName",title:"empName",search:"empName",placeholder:"请选择员工",options:S.options,onChange:I},null,8,["disabled","modelValue","options"])])),_:1})])),_:1}),s(o,{md:12,lg:12,xl:12},{"default":n((()=>[s(a,{label:"身份证号",prop:"empIdcard"},{"default":n((()=>[s(t,{modelValue:S.ruleForm.empIdcard,"onUpdate:modelValue":l[1]||(l[1]=e=>S.ruleForm.empIdcard=e),placeholder:"身份证号",disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),s(o,{md:12,lg:12,xl:12},{"default":n((()=>[s(a,{label:"成员姓名",prop:"familyName"},{"default":n((()=>[s(t,{modelValue:S.ruleForm.familyName,"onUpdate:modelValue":l[2]||(l[2]=e=>S.ruleForm.familyName=e),placeholder:"请输入成员姓名",maxlength:"20",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),s(o,{md:12,lg:12,xl:12},{"default":n((()=>[s(a,{label:"与本人关系",prop:"relationshipSelf"},{"default":n((()=>[s(m,{modelValue:S.ruleForm.relationshipSelf,"onUpdate:modelValue":l[3]||(l[3]=e=>S.ruleForm.relationshipSelf=e),placeholder:"请选择与本人的关系",clearable:"",filterable:"",style:{width:"100%"}},{"default":n((()=>[(c(!0),u(g,null,h(S.relationList,(e=>(c(),y(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),s(o,{md:12,lg:12,xl:12},{"default":n((()=>[s(a,{label:"出生日期",prop:"birthday"},{"default":n((()=>[s(i,{modelValue:S.ruleForm.birthday,"onUpdate:modelValue":l[4]||(l[4]=e=>S.ruleForm.birthday=e),type:"date",placeholder:"请选择出生日期",style:{width:"100%"},"value-format":"YYYY-MM-DD 00:00:00","disabled-date":D},null,8,["modelValue"])])),_:1})])),_:1}),s(o,{md:12,lg:12,xl:12},{"default":n((()=>[s(a,{label:"工作单位",prop:"workUnit"},{"default":n((()=>[s(t,{modelValue:S.ruleForm.workUnit,"onUpdate:modelValue":l[5]||(l[5]=e=>S.ruleForm.workUnit=e),placeholder:"请输入工作单位",maxlength:"100"},null,8,["modelValue"])])),_:1})])),_:1}),s(o,{md:12,lg:12,xl:12},{"default":n((()=>[s(a,{label:"手机号码",prop:"contractTel"},{"default":n((()=>[s(t,{modelValue:S.ruleForm.contractTel,"onUpdate:modelValue":l[6]||(l[6]=e=>S.ruleForm.contractTel=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["title","modelValue"])])}}});export{k as default};