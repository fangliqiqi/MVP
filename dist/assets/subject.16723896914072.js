import{c as e,d as t,e as a,f as r}from"./subject.1672389691407.js";import{P as o}from"./ProTable.1672389691407.js";import{P as l}from"./index.16723896914072.js";import{l as n,i}from"./city.1672389691407.js";import{_ as s,f as c,g as d,a as p}from"./index.1672389691407.js";import u from"./addSubjectCheckInfo.1672389691407.js";import m from"./changeProve.1672389691407.js";import{i as h,f,j as _,E as g,$ as b,w as y,a2 as E,c as C,W as v,P as x,aD as S,aA as R,a3 as j,o as D,a as I,O as T,U as L,ay as k,az as A}from"./vue.1672389691407.js";import w from"./reduceSubjectDialog.1672389691407.js";import O from"./changeSubjectDialog.1672389691407.js";import{E as P,S as H,a as N,b as B,c as U,d as W,e as z,f as J,g as M}from"./header.1672389691407.js";import{E as q}from"./index.16723896914076.js";import{B as V}from"./index.16723896914077.js";import{o as G,a as F}from"./events.1672389691407.js";import{S as $}from"./dicts.1672389691407.js";import{v as X}from"./xlsx.1672389691407.js";import"./echarts.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./proveForm.1672389691407.js";import"./prove.1672389691407.js";import"./provePdf.1672389691407.js";import"./vuedraggable.umd.1672389691407.js";import"./excel.1672389691407.js";const K={name:"项目档案",components:{ProTable:o,ProButtons:l,ArrowDown:c,addSubjectCheckInfo:u,reduceElectronicDialog:w,changeSubjectDialog:O,changeProveVue:m,ExportExcelDialog:q,batchImportDialog:V},setup(){var o;const l=null==(o=h())?void 0:o.appContext.config.globalProperties.$message,s=f(null),c=f(null),u=f(null),m=f(null),C=S(),v=R(),x=f(null),j=f(null),D=f(null),I=f(null),T=f(null),L=f(null),k=f(null),{proxy:A}=h(),w=()=>{s.value&&s.value.refresh()},O=e=>"1"==e.projectStatus,q=({dataIndex:e,title:t,minWidth:a,customRender:r,formatter:o,ellipsis:l=!1,tooltip:n=!1})=>[{dataIndex:e,title:t,minWidth:a,valueType:"custom",scopedSlots:{customRender:r},hideInTable:!0,tooltip:n,ellipsis:l},{dataIndex:e,title:t,minWidth:a,formatter:o,hideInSearch:!0,tooltip:n,ellipsis:l}];_((()=>{F(A,v.path,(()=>{w()}))})),g((()=>{G(A)}));const V=b({areaProps:{label:"areaName",isLeaf:"isLeaf",children:"children"},selectionChangeList:[],SUBJECT_EXPORT_HEADER:U,SUBJECT_IMPORT_HEADER:W,SUBJECT_UPDATE_HEADER:z,SUBJECT_REDUCE_HEADER:J,SUBJECT_CHANGE_HEADER:M,params:{archivesLocation:null,socialSecurityLocation:null,businessThirdType:null,empNatrue:null,contractStatus:null,insuranceStatus:null,socialStatus:null,fundStatus:null,projectStatus:null},dict:{emp_natrue:null,personnel_state:null,commercial_satte:null,social_ecurity_state:null,in_item_state:null},searchConfig:{labelWidth:"125px",option:{extBtn:"extBtns"}},columns:[{dataIndex:"empNo",title:"员工编码",minWidth:140,ellipsis:!0,fixed:"left"},{dataIndex:"empName",title:"员工姓名",minWidth:120,ellipsis:!0},{dataIndex:"empIdcard",title:"身份证号",minWidth:180},{dataIndex:"empPhone",title:"手机号码",minWidth:140},...q({dataIndex:"archivesLocation",title:"档案所在地",minWidth:160,customRender:"archivesLocation",tooltip:!0,formatter:e=>i({province:e.fileProvince,city:e.fileCity,town:e.fileTown})}),...q({dataIndex:"socialSecurityLocation",title:"社保所在地",minWidth:160,tooltip:!0,customRender:"socialSecurityLocation",formatter:e=>i({province:e.socialProvince,city:e.socialCity,town:e.socialTown})}),{dataIndex:"unitName",title:"客户名称",minWidth:180,ellipsis:!0},{dataIndex:"deptName",title:"项目名称",minWidth:180,ellipsis:!0},{dataIndex:"deptNo",title:"项目编码",minWidth:120,ellipsis:!0},{dataIndex:"businessThirdType",title:"业务类型",minWidth:120,ellipsis:!0},{dataIndex:"empNatrue",title:"员工类型",minWidth:120,multiple:!0,searchIndex:"empNatureArray"},{dataIndex:"createTime",title:"创建时间",minWidth:160,hideInSearch:!0},{dataIndex:"createName",title:"创建人",minWidth:100,hideInSearch:!0},{dataIndex:"contractStatus",title:"合同状态",minWidth:100,multiple:!0,searchIndex:"contractStatusArray"},{dataIndex:"insuranceStatus",title:"商险状态",minWidth:100,multiple:!0,searchIndex:"insuranceStatusArray"},{dataIndex:"socialStatus",title:"社保状态",minWidth:100,multiple:!0,searchIndex:"socialStatusArray"},{dataIndex:"fundStatus",title:"公积金状态",minWidth:100,multiple:!0,searchIndex:"fundStatusArray"},{dataIndex:"salaryStatus",title:"近3个月发薪",minWidth:100,hideInSearch:!0,valueEnum:$},{dataIndex:"projectStatusReplace",title:"在项状态",minWidth:100,formatter:e=>1==e.projectStatus?"已减项":0==e.projectStatus&&0==e.status?"草稿":0==e.projectStatus&&1==e.status?"已审核":"--",valueEnum:{0:"草稿",1:"已审核",2:"已减项"}},{dataIndex:"option",title:"操作",key:"option",width:220,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"新增",onClick:()=>{c.value&&c.value.openDialog()},permission:["archives_temployeeproject_add"],icon:"icon-ic_edit_add"},{label:"批量导入",type:"normal",onClick:()=>{D.value&&D.value.openDialog()},permission:["wxhr:employeeProjectinfo_importListAdd"],icon:"icon-ic_edit_upload"},{label:"批量更新",type:"normal",onClick:()=>{I.value&&I.value.openDialog()},permission:["archives_project_importListUpdate"],icon:"icon-ic_edit_refresh"},{label:"批量删除",type:"normal",onClick:()=>{if(!V.selectionChangeList||0===V.selectionChangeList.length)return void l.error("请先选择待删除的项目档案");const e=`<p style="font-size:16px;font-weight:600">是否确定删除${V.selectionChangeList.length}条项目档案?<br/>\n\t\t\t\t<span style="color:red;font-size:14px;font-weight:400">删除后，档案将从系统消失，请谨慎操作！</span></p>`;p.confirm(e,{type:"warning",dangerouslyUseHTMLString:!0}).then((async()=>{try{const e=V.selectionChangeList.map((e=>e.id)),a=await t(e);a&&200===a.code?(l.success("档案批量删除成功"),w()):a.data&&k.value&&(a.data.map((e=>{const t=e.message.split(";");return e.empName=t[0]||"",e.empIdCard=t[1]||"",e.deptNo=t[2]||"",e.result="否",e.error=t[3]||"",e})),k.value.openErrorDialog(a.data))}catch(e){l.error("删除失败")}}))["catch"]((()=>{}))},permission:["archives_temployeeproject_batchdel"],icon:"icon-ic_edit_delete"},{label:"批量导出",type:"normal",onClick:()=>{let e=Object.assign({},s.value.getParams(),V.params);e.hasOwnProperty("projectStatusReplace")&&(0==e.projectStatusReplace?e.proStatus=0:1==e.projectStatusReplace&&(e.proStatus=1),e.projectStatusReplace=1==e.projectStatusReplace?0:0!=e.projectStatusReplace?1:0),delete e.size,delete e.current;for(let t in e)(void 0===e[t]||null===e[t]||e[t]instanceof Array&&0===e[t].length)&&delete e[t],"archivesLocation"!==t&&"socialSecurityLocation"!==t||delete e[t];j.value&&j.value.openDialog(((t,r)=>{let o={exportFields:t.map((e=>e.dataIndex))};const l=V.selectionChangeList.map((e=>e.id));l&&l.length?o.idList=l:o={...o,...e},a({},o).then((e=>{e.code&&200!==e.code&&p.error(e.msg),r(!0)}))}))},permission:["archives_temployeeproject_batchexport"],icon:"icon-ic_edit_export"},{label:"批量划转",type:"normal",onClick:()=>{L.value&&L.value.openDialog()},permission:["archives_tempchangeinfo_batchchange"]},{label:"批量减项",type:"normal",onClick:()=>{T.value&&T.value.openDialog()},permission:["archives_temployeeproject_batchdelempproinfo"]}],cellBtns:[{text:"详情",prop:"detail",permission:[]},{text:"编辑",prop:"edit",permission:["archives_temployeeproject_edit"],tooltip:"当前档案不可编辑",isGray:O},{text:"减项",prop:"reduce",permission:["archives_temployeeproject_delempproinfo"],tooltip:"当前档案不可减项",isGray:O},{text:"删除",prop:"delete",permission:["archives_temployeeproject_del"],tooltip:"当前档案不可删除",isGray:e=>"0"==e.projectStatus&&"1"==e.status},{text:"划转",prop:"change",permission:["archives_tempchangeinfo_change"],tooltip:"当前档案不可划转",isGray:O},{text:"证明开具",prop:"prove",permission:["demo_tcertrecord_add"],tooltip:"当前档案不可开具证明"}],initParams:{empIdcard:""}});_((()=>{d(["emp_natrue","personnel_state","commercial_satte","social_ecurity_state","in_item_state","fund_status","customer_business_sub_type"]).then((e=>{V.dict=e,V.columns=V.columns.map((t=>{const a={...t};switch(t.dataIndex){case"empNatrue":a.valueEnum=e.emp_natrue;break;case"socialStatus":a.valueEnum=e.social_ecurity_state;break;case"insuranceStatus":a.valueEnum=e.commercial_satte;break;case"fundStatus":a.valueEnum=e.fund_status;break;case"contractStatus":a.valueEnum=e.personnel_state}return a}))}))}));y((()=>{v.query.projectIdCard&&(V.initParams.empIdcard=v.query.projectIdCard,s.value&&s.value.doSearch({empIdcard:v.query.projectIdCard,size:10,current:1,initParams:v.query.projectIdCard}))}));return{...E(V),request:async t=>{const a=Object.assign({},V.params,t);"0"==a.projectStatusReplace?(a.projectStatus=0,a.status=0,delete a.projectStatusReplace):"1"==a.projectStatusReplace?(a.projectStatus=0,a.status=1,delete a.projectStatusReplace):"2"==a.projectStatusReplace?(a.projectStatus=1,delete a.status,delete a.projectStatusReplace):(delete a.projectStatusReplace,delete a.status,delete a.projectStatus),delete a.archivesLocation,delete a.socialSecurityLocation;try{const r=await e(a);if(r&&200==r.code&&r.data)return{current:r.data.current,total:r.data.total,data:r.data.records.map(((e,a)=>({...e,index:(t.current-1)*t.size+a+1})))}}catch(r){}return{current:1,total:0,data:[]}},onCellClick:async(e,t)=>{const a=v.query.projectIdCard?v.query.projectIdCard:"";switch(e){case"detail":C.push({name:"subject-detail",params:{id:t.id},query:{projectIdCard:a}});break;case"edit":C.push({name:"subject-edit",params:{id:t.id}});break;case"delete":(e=>{p.confirm('<p style="font-size:16px;font-weight:600">是否确定删除?<br/>\n\t\t\t\t<span style="color:red;font-size:14px;font-weight:400">删除后，档案将从系统消失，请谨慎操作！</span></p>',{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((async()=>{try{const t=await r(e.id);t&&200===t.code?(l.success("档案删除成功"),w()):l.error(t.msg||"档案删除失败")}catch(t){l.error("档案删除失败")}}))["catch"]((()=>{}))})(t);break;case"reduce":u.value&&u.value.openDialog(t);break;case"change":m.value&&m.value.openDialog(t);break;case"prove":x.value&&x.value.openDialog(t)}},proTableRef:s,refreshList:w,changeArchivesLocation:(e,t)=>{const a=[e.id];t.parent&&0!=t.parent.level&&(a.unshift(t.parent.data.id),t.parent.parent&&0!=t.parent.parent.level&&a.unshift(t.parent.parent.data.id));let r=null,o=null,l=null;r=a[0]||null,a.length>1&&(o=a[1]||null),a.length>2&&(l=a[2]||null),V.params.fileProvince=r,V.params.fileCity=o,V.params.fileTown=l},changeSocialSecurityLocation:(e,t)=>{const a=[e.id];t.parent&&0!=t.parent.level&&(a.unshift(t.parent.data.id),t.parent.parent&&0!=t.parent.parent.level&&a.unshift(t.parent.parent.data.id)),V.params.socialProvince=a[0]||null,V.params.socialCity=a[1]||null,V.params.socialTown=a[2]||null},clearSocialSecurityLocation:()=>{V.params.socialProvince=null,V.params.socialCity=null,V.params.socialTown=null},businessPrimaryTypeLoad:(e,t)=>{if(e.isLeaf)return t([]);setTimeout((()=>{t([])}),400)},checkInfoDialog:c,reduceElectronicRef:u,changeElectronicRef:m,selectionChange:e=>{V.selectionChangeList=e},changeProveRef:x,exportExcelRef:j,batchImportDialogRef:D,batchUpdateDialogRef:I,validBatchUpdateSheet:async e=>{const t=e.file.raw,a=await X(t,W,0,null,z);return a&&Array.isArray(a)&&a.length?{code:200}:a&&a.code&&1==a.code?{code:1,msg:"表格数据为空，请检查表格数据是否正确"}:{code:1,msg:"请检查你的表头信息，并确保与批量更新模板一致"}},batchReduceDialogRef:T,batchChangeDialogRef:L,batchDeleteDialog:k,batchErrorData:(e,t)=>{let a=null;switch(e){case"subject-batch-reduce":a=t.map((e=>{const t=e.message.split(";");return{line:e.lineNum,isError:"是",empName:t[0]||"",empIdCard:t[1]||"",deptNo:t[2]||"",leaveReason:t[3]||"",leaveRemark:t[4]||"",error:t[5]||""}})).sort(((e,t)=>Number(e.line)-Number(t.line)));break;case"suject-batch-delete":a=t.map((e=>({empName:e.empName,empIdCard:e.empIdCard,deptNo:e.deptNo,result:"否",error:e.error})));break;case"subject-batch-change":a=t.map((e=>{let t=e.errors&&e.errors.length?e.errors.join(","):null;return{line:e.lineNum,isError:t?"是":"否",error:t}})).sort(((e,t)=>Number(e.line)-Number(t.line)));break;default:a=t.map((e=>({line:e.lineNum,isError:e.message?"是":"否",error:e.message}))).sort(((e,t)=>Number(e.line)-Number(t.line)))}return a},onReset:()=>{delete v.query.projectIdCard,V.params={},V.initParams.empIdcard=null},ERROR_HEADER:P,SUBJECT_BATCH_DEL_ERROR_HEADER:H,SUBJECT_BATCH_COMMON_ERROR_HEADER:N,SUBJECT_BATCH_REDUCE_ERROR_HEADER:B,clearFileAddress:()=>{V.params.fileProvince=null,V.params.fileCity=null,V.params.fileTown=null},loadArea:(e,t)=>{const a=e.level,r=e.isLeaf;if(0!==a)return t(r?[]:n(e.data.id));t(n(0));return t([])}}}},Q=e=>(k("data-v-6e5e7a4e"),e=e(),A(),e),Y={"class":"system-dict-container"},Z={"class":"el-dropdown-link"},ee=L(" 模板下载 "),te=Q((()=>I("a",{href:"/template/subject/项目档案批量导入模板.xlsx",download:""},"批量导入模板",-1))),ae=Q((()=>I("a",{href:"/template/subject/项目档案批量更新模板.xlsx",download:""},"批量更新模板",-1))),re=Q((()=>I("a",{href:"/template/subject/项目档案批量划转模板.xlsx",download:""},"批量划转模板",-1))),oe=Q((()=>I("a",{href:"/template/subject/项目档案批量减项模板.xlsx",download:""},"批量减项模板",-1))),le=Q((()=>I("div",null,[
I("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批量导入失败！"),
I("span",null,[
L("存在不符合要求的数据，请修改后，重新导入！"),
I("br"),
L("已为您下载反馈结果！")])],-1))),ne=Q((()=>I("div",null,[
I("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批量更新失败！"),
I("span",null,[
L("存在不符合要求的数据，请修改后，重新导入！"),
I("br"),
L("已为您下载反馈结果！")])],-1))),ie=Q((()=>I("div",null,[
I("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批量减项失败！"),
I("span",null,[
L("存在不符合要求的数据，请修改后，重新导入！"),
I("br"),
L("已为您下载反馈结果！")])],-1))),se=Q((()=>I("div",null,[
I("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批量划转失败！"),
I("span",null,[
L("存在不符合要求的数据，请修改后，重新导入！"),
I("br"),
L("已为您下载反馈结果！")])],-1))),ce=Q((()=>I("div",null,[
I("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批量删除失败！"),
I("span",null,[
L("该档案存在进行中/已完结的服务！"),
I("br"),
L("已为您下载反馈结果！")])],-1)));var de=s(K,[["render",function(e,t,a,r,o,l){const n=j("arrow-down"),i=j("el-icon"),s=j("el-button"),c=j("el-dropdown-item"),d=j("el-dropdown-menu"),p=j("el-dropdown"),u=j("el-tree-select"),m=j("pro-buttons"),h=j("pro-table"),f=j("addSubjectCheckInfo"),_=j("reduce-electronic-dialog"),g=j("change-subject-dialog"),b=j("export-excel-dialog"),y=j("changeProveVue"),E=j("batch-import-dialog");return D(),C("div",Y,[v(h,{ref:"proTableRef","row-key":"id",columns:e.columns,request:r.request,btn:e.btn,searchConfig:e.searchConfig,multi:"",onSelectionChange:r.selectionChange,onOnReset:r.onReset,initParams:e.initParams},{extBtns:x((()=>[v(p,{"class":"arch-btn","popper-class":"module-download"},{dropdown:x((()=>[v(d,null,{"default":x((()=>[v(c,null,{"default":x((()=>[te])),_:1}),v(c,null,{"default":x((()=>[ae])),_:1}),v(c,null,{"default":x((()=>[re])),_:1}),v(c,null,{"default":x((()=>[oe])),_:1})])),_:1})])),"default":x((()=>[I("span",Z,[v(s,{size:"default"},{"default":x((()=>[ee,v(i,{"class":"el-icon--right"},{"default":x((()=>[v(n)])),_:1})])),_:1})])])),_:1})])),archivesLocation:x((a=>[v(u,{modelValue:e.params.archivesLocation,"onUpdate:modelValue":t[0]||(t[0]=t=>e.params.archivesLocation=t),style:{width:"100%"},placeholder:a.placeholder||"请选择",props:e.areaProps,onCurrentChange:r.changeArchivesLocation,onClear:r.clearFileAddress,"node-key":"id",load:r.loadArea,lazy:"",clearable:"","check-strictly":""},null,8,["modelValue","placeholder","props","onCurrentChange","onClear","load"])])),socialSecurityLocation:x((a=>[(D(),T(u,{modelValue:e.params.socialSecurityLocation,"onUpdate:modelValue":t[1]||(t[1]=t=>e.params.socialSecurityLocation=t),key:"arch_search_props_"+a.dateIndex+"_oIndex",style:{width:"100%"},placeholder:a.placeholder||"请选择",props:e.areaProps,onCurrentChange:r.changeSocialSecurityLocation,onClear:r.clearSocialSecurityLocation,"node-key":"id",load:r.loadArea,"check-strictly":"",lazy:"",clearable:""},null,8,["modelValue","placeholder","props","onCurrentChange","onClear","load"]))])),businessPrimaryType:x((a=>[v(u,{modelValue:e.params.businessThirdType,"onUpdate:modelValue":t[2]||(t[2]=t=>e.params.businessThirdType=t),lazy:"",load:r.businessPrimaryTypeLoad,style:{width:"100%"},placeholder:a.placeholder||"请选择",props:{label:"label",children:"children",isLeaf:"isLeaf"},onCurrentChange:r.changeSocialSecurityLocation,"node-key":"id",clearable:""},null,8,["modelValue","load","placeholder","onCurrentChange"])])),option:x((t=>[v(m,{array:e.cellBtns,model:t,onOnClick:r.onCellClick},null,8,["array","model","onOnClick"])])),_:1},8,["columns","request","btn","searchConfig","onSelectionChange","onOnReset","initParams"]),v(f,{ref:"checkInfoDialog",onOk:r.refreshList},null,8,["onOk"]),v(_,{ref:"reduceElectronicRef",onOk:r.refreshList},null,8,["onOk"]),v(g,{ref:"changeElectronicRef",onOk:r.refreshList},null,8,["onOk"]),v(b,{ref:"exportExcelRef",heads:e.SUBJECT_EXPORT_HEADER,title:"项目档案导出",useCode:"archives_temployeeproject_batchexport"},null,8,["heads"]),v(y,{ref:"changeProveRef"},null,512),v(E,{ref:"batchImportDialogRef",header:e.SUBJECT_IMPORT_HEADER,url:"/yifu-archives/method/temployeeproject/importListAdd",onOk:r.refreshList,type:1,demobilize:"",batchName:"subject-batch-import",errorHeader:r.SUBJECT_BATCH_COMMON_ERROR_HEADER,errorData:r.batchErrorData,demobilizeParamsName:"idAdd",customError:"",customErrorContent:"",download:""},{error:x((()=>[le])),_:1},8,["header","onOk","errorHeader","errorData"]),v(E,{title:"批量更新",ref:"batchUpdateDialogRef",header:e.SUBJECT_IMPORT_HEADER,url:"/yifu-archives/method/temployeeproject/importListUpate",onOk:r.refreshList,batchName:"subject-batch-update",valid:r.validBatchUpdateSheet,errorHeader:r.SUBJECT_BATCH_COMMON_ERROR_HEADER,errorData:r.batchErrorData,customError:"",customErrorContent:"",download:""},{error:x((()=>[ne])),_:1},8,["header","onOk","valid","errorHeader","errorData"]),v(E,{title:"批量减项",ref:"batchReduceDialogRef",header:e.SUBJECT_REDUCE_HEADER,batchName:"subject-batch-reduce",url:"/yifu-archives/method/temployeeproject/batchDeleteEmpPro",onOk:r.refreshList,type:1,errorHeader:r.SUBJECT_BATCH_REDUCE_ERROR_HEADER,errorData:r.batchErrorData,customError:"",customErrorContent:"",download:""},{error:x((()=>[ie])),_:1},8,["header","onOk","errorHeader","errorData"]),v(E,{title:"批量划转",ref:"batchChangeDialogRef",header:e.SUBJECT_CHANGE_HEADER,batchName:"subject-batch-change",url:"/yifu-archives/method/tempchangeinfo/batchChangeArc",onOk:r.refreshList,type:1,errorHeader:r.SUBJECT_BATCH_COMMON_ERROR_HEADER,errorData:r.batchErrorData,customError:"",customErrorContent:"",download:""},{error:x((()=>[se])),_:1},8,["header","onOk","errorHeader","errorData"]),v(E,{title:"批量删除",ref:"batchDeleteDialog",type:1,errName:"项目档案批量删除",onOk:r.refreshList,batchName:"suject-batch-delete",errorHeader:r.SUBJECT_BATCH_DEL_ERROR_HEADER,errorData:r.batchErrorData,download:"",customError:"",customErrorContent:""},{error:x((()=>[ce])),_:1},8,["onOk","errorHeader","errorData"])])}],["__scopeId","data-v-6e5e7a4e"]]);export{de as default};