import{t as e,v as a}from"./staff.1672389691407.js";import{P as t}from"./ProTable.1672389691407.js";import{P as i}from"./index.16723896914072.js";import n from"./redocumentDialog.1672389691407.js";import{i as r,f as s,$ as l,j as o,E as d,a2 as m,c,W as p,P as u,aD as h,aA as f,a3 as x,o as g,O as C}from"./vue.1672389691407.js";import{a5 as _}from"./header.1672389691407.js";import{i as v,l as y}from"./city.1672389691407.js";import{_ as I,g as T,a as b}from"./index.1672389691407.js";import{E as A}from"./index.16723896914076.js";import{o as j,a as R}from"./events.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./subject.1672389691407.js";import"./xlsx.1672389691407.js";import"./vuedraggable.umd.1672389691407.js";const E={"class":"archives-withdrawn-container"};var P=I({name:"离职库",components:{ProTable:t,ProButtons:i,RedocumentDialog:n,ExportExcelDialog:A},setup(){var t;const i=h(),n=f();null==(t=r())||t.appContext.config.globalProperties.$message;const c=s(null),p=s(null),u=s(null),{proxy:x}=r(),g=()=>{c.value&&c.value.refresh()},C=l({selectionChangeList:[],searchConfig:{labelWidth:110},columns:[{dataIndex:"empCode",title:"员工主码",minWidth:140,tooltip:!0,fixed:"left"},{dataIndex:"empName",title:"员工姓名",minWidth:160},{dataIndex:"empIdcard",title:"身份证号",minWidth:200},{dataIndex:"empPhone",title:"手机号码",minWidth:140},{dataIndex:"fileAddress",title:"档案所在地",hideInSearch:!0,minWidth:180,ellipsis:!0,formatter:e=>v({province:e.fileProvince,city:e.fileCity,town:e.fileTown})},{dataIndex:"unitName",title:"单位名称",minWidth:140,ellipsis:!0},{dataIndex:"deptName",title:"项目名称",minWidth:140,ellipsis:!0},{dataIndex:"deptNo",title:"项目编码",minWidth:140,ellipsis:!0},{dataIndex:"empNatrue",searchIndex:"empNatureArray",title:"员工类型",minWidth:180,multiple:!0},{dataIndex:"fileAddress",title:"档案所在地",hideInTable:!0,valueType:"custom",scopedSlots:{customRender:"fileAddress"}},{dataIndex:"leaveTime",title:"减档时间",minWidth:180,searchIndex:"startEndTime",startTime:"leaveTimeStart",endTime:"leaveTimeEnd",valueType:"dateTimeRange",ellipsis:!0},{dataIndex:"leaveUserName",title:"减档人",minWidth:160},{dataIndex:"option",title:"操作",key:"option",width:160,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"批量导出",onClick:()=>{let e=Object.assign({},c.value.getParams(),C.params);delete e.size,delete e.current,delete e.startEndTime,u.value&&u.value.openDialog(((t,i)=>{const n={...e,exportFields:t.map((e=>e.dataIndex))},r=C.selectionChangeList.map((e=>e.id));r&&r.length&&(n.idList=r),a({},n).then((e=>{e.code&&200!==e.code&&b.error(e.msg),i(!0)}))}))},permission:["employee_export_employee_leave"],icon:"icon-ic_edit_export"}],cellBtns:[{text:"详情",prop:"detail",permission:["hro:archives-online-detail"]},{text:"复档",prop:"redocument",permission:["temployeeinfo_restore"]}],DICTS:{},dictKeys:["emp_natrue","emp_married","emp_national","emp_political","emp_registype","education","EMP_SOURCE","social_ecurity_state","commercial_satte","personnel_state","fund_status"],params:{},areaProps:{label:"areaName",isLeaf:"isLeaf",children:"children"}});return o((()=>{(async()=>{try{const e=await T(C.dictKeys);e&&(C.DICTS=e,C.columns=C.columns.map((a=>{const t={...a};return"empNatrue"===a.dataIndex&&(t.valueEnum=e.emp_natrue),t})))}catch(e){}})(),R(x,n.path,(()=>{g()}))})),d((()=>{j(x)})),{...m(C),request:async a=>{try{const t=Object.assign({},a,C.params,{fileStatus:"1"});delete t.fileAddress;const i=await e(t);if(i&&200==i.code&&i.data)return{current:i.data.current,total:i.data.total,data:i.data.records}}catch(t){}return{current:1,total:0,data:[]}},onCellClick:async(e,a)=>{switch(e){case"detail":i.push({name:"withdrawn-detail",params:{id:a.id}});break;case"redocument":p.value&&p.value.openDialog(a)}},proTableRef:c,refreshList:g,changeFileAddress:(e,a)=>{const t=[e.id];a.parent&&0!=a.parent.level&&(t.unshift(a.parent.data.id),a.parent.parent&&0!=a.parent.parent.level&&t.unshift(a.parent.parent.data.id)),C.params.fileProvince=t[0]||null,C.params.fileCity=t[1]||null,C.params.fileTown=t[2]||null},loadArea:(e,a)=>{const t=e.level,i=e.isLeaf;if(0!==t)return a(i?[]:y(e.data.id));a(y(0));return a([])},clearFileAddress:()=>{C.params.fileProvince=null,C.params.fileCity=null,C.params.fileTown=null},redocumentDialog:p,exportExcelRef:u,STAFF_WITHDRAWN_EXPORT__HEADER:_,selectionChange:e=>{C.selectionChangeList=e},onReset:()=>{C.params={}}}}},[["render",function(e,a,t,i,n,r){const s=x("el-tree-select"),l=x("pro-buttons"),o=x("pro-table"),d=x("redocument-dialog"),m=x("export-excel-dialog");return g(),c("div",E,[p(o,{ref:"proTableRef","row-key":"id",columns:e.columns,request:i.request,btn:e.btn,multi:!0,searchConfig:e.searchConfig,onSelectionChange:i.selectionChange,onOnReset:i.onReset},{fileAddress:u((t=>[(g(),C(s,{modelValue:e.params.fileAddress,"onUpdate:modelValue":a[0]||(a[0]=a=>e.params.fileAddress=a),key:"arch_search_props_"+t.dateIndex+"_oIndex",style:{width:"100%"},placeholder:"请选择",props:e.areaProps,onCurrentChange:i.changeFileAddress,onClear:i.clearFileAddress,"node-key":"id",load:i.loadArea,"check-strictly":"",lazy:"",clearable:""},null,8,["modelValue","props","onCurrentChange","onClear","load"]))])),option:u((a=>[p(l,{array:e.cellBtns,model:a,onOnClick:i.onCellClick},null,8,["array","model","onOnClick"])])),_:1},8,["columns","request","btn","searchConfig","onSelectionChange","onOnReset"]),p(d,{ref:"redocumentDialog",onOk:i.refreshList},null,8,["onOk"]),p(m,{ref:"exportExcelRef",heads:i.STAFF_WITHDRAWN_EXPORT__HEADER,title:"员工档案导出"},null,8,["heads"])])}]]);export{P as default};