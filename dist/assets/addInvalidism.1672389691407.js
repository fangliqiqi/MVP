import{g as e}from"./staff.1672389691407.js";import{A as l,B as a,C as t}from"./attach.1672389691407.js";import{g as i}from"./file.1672389691407.js";import{P as d}from"./index.16723896914073.js";import o from"./attachUpload.1672389691407.js";import{E as r}from"./index.1672389691407.js";import{d as m,f as s,$ as u,c as n,W as p,P as c,a3 as f,o as g,a as b,F as y,a5 as h,O as F,U as _}from"./vue.1672389691407.js";const V={"class":"system-add-dic-container"},v=_("是"),I=_("否"),w={"class":"dialog-footer"},x=_("取 消"),D=_("确 定"),N=m({name:"systemAddDic"}),L=Object.assign(N,{emits:["ok"],setup(m,{expose:_,emit:N}){const L=s(null),k=s(null),T=s(null),j=u({isShowDialog:!1,loading:!1,id:null,title:"新增伤残信息",ruleForm:{empId:"",empCode:"",empName:"",empIdcard:"",disabilityName:"",occupationalDisease:"",disabilityLevel:"",startTime:"",endTime:"",injuryIdentification:"0",attaIds:"",remark:""},fileList:[],options:[],disabilityGradeList:[]}),U={empName:[{required:!0,message:"请选择员工",trigger:"change"}],disabilityName:[{required:!0,message:"请输入伤残名称",trigger:"blur"}],disabilityLevel:[{required:!0,message:"请选择伤残等级",trigger:"change"}],startTime:[{required:!0,message:"请选择伤残开始日期",trigger:"change"}],endTime:[{required:!0,message:"请选择伤残结束日期",trigger:"blur"}]},C=e=>{j.fileList=e.value},S=e=>{j.fileList=e.value},Y=async l=>{try{l.fileStatus=0;const a=await e(l);if(a&&200==a.code&&a.data)return{current:a.data.current,total:a.data.total,data:a.data.records};r.error(a.msg)}catch(a){}return{current:1,total:0,data:[]}},q=e=>{j.ruleForm.empCode=e.empCode,j.ruleForm.empId=e.id,j.ruleForm.empIdcard=e.empIdcard,j.options=[e]},R=e=>e.getTime()>Date.now(),z=e=>!j.ruleForm.startTime||e.getTime()<Date.parse(j.ruleForm.startTime),M=async e=>{try{const a=await l(e);if(a&&200===a.code){const e={...a.data};j.options=[{empIdcard:e.empIdcard,empName:e.empName}],j.ruleForm=e,j.isShowDialog=!0}else r.error(a.msg||"获取伤残信息详情失败");const t=await i(e);t&&200===t.code?j.fileList=t.data.map((e=>(e.name=e.attaName,e.uid=e.id,e.url=e.attaUrl,e))):(j.fileList=[],r.error(t.msg||"获取附件失败"))}catch(a){G()}},G=()=>{L.value.resetFields(),j.ruleForm={empId:"",empCode:"",empName:"",empIdcard:"",disabilityName:"",occupationalDisease:"",disabilityLevel:"",startTime:"",endTime:"",injuryIdentification:"0",attaIds:"",remark:""},j.isShowDialog=!1,j.loading=!1},P=()=>{G()},A=()=>{L.value.validate((e=>{if(e){j.loading=!0;const e=[];j.fileList.forEach((l=>{e.push(l.uid)})),j.ruleForm.attaIds=e.join(","),null!==j.id&&void 0!==j.id?a(j.ruleForm).then((e=>{e&&200==e.code?(r.success("编辑伤残信息成功"),N("ok"),G()):r.error(e.msg||"编辑伤残信息失败")}),(()=>{r.error("编辑伤残信息失败")}))["finally"]((()=>{j.loading=!1})):t(j.ruleForm).then((e=>{e&&200==e.code?(r.success("新增伤残信息成功"),N("ok"),G()):r.error(e.msg||"新增伤残信息失败")}),(()=>{r.error("新增伤残信息失败")}))["finally"]((()=>{j.loading=!1}))}}))};return _({openDialog:async(e,l)=>{j.disabilityGradeList=l,e&&e.id?(j.title="编辑伤残信息",j.id=e.id,await M(e.id)):(j.title="新增伤残信息",j.id=null,j.ruleForm={empId:"",empCode:"",empName:"",empIdcard:"",disabilityName:"",occupationalDisease:"",disabilityLevel:"",startTime:"",endTime:"",injuryIdentification:"0",attaIds:"",remark:""},j.fileList=[],j.isShowDialog=!0)}}),(e,l)=>{const a=f("el-form-item"),t=f("el-col"),i=f("el-input"),r=f("el-option"),m=f("el-select"),s=f("el-date-picker"),u=f("el-radio"),_=f("el-radio-group"),N=f("el-row"),M=f("el-form"),E=f("el-button"),O=f("el-dialog");return g(),n("div",V,[p(O,{title:j.title,modelValue:j.isShowDialog,"onUpdate:modelValue":l[9]||(l[9]=e=>j.isShowDialog=e),"close-on-click-modal":!1,width:"816px",onClose:G},{footer:c((()=>[b("span",w,[p(E,{onClick:P,size:"default"},{"default":c((()=>[x])),_:1}),p(E,{type:"primary",onClick:A,loading:j.loading,size:"default"},{"default":c((()=>[D])),_:1},8,["loading"])])])),"default":c((()=>[p(M,{ref_key:"formRef",ref:L,model:j.ruleForm,rules:U,size:"default","label-width":"110px"},{"default":c((()=>[p(N,null,{"default":c((()=>[p(t,{md:12,lg:12,xl:12},{"default":c((()=>[p(a,{label:"员工姓名",prop:"empName"},{"default":c((()=>[p(d,{disabled:!!j.id,ref_key:"pageSelectRef",ref:k,modelValue:j.ruleForm.empName,"onUpdate:modelValue":l[0]||(l[0]=e=>j.ruleForm.empName=e),request:Y,"value-key":"empName",title:"empName",search:"empName",placeholder:"请选择员工",options:j.options,onChange:q},null,8,["disabled","modelValue","options"])])),_:1})])),_:1}),p(t,{md:12,lg:12,xl:12},{"default":c((()=>[p(a,{label:"身份证号"},{"default":c((()=>[p(i,{disabled:"",modelValue:j.ruleForm.empIdcard,"onUpdate:modelValue":l[1]||(l[1]=e=>j.ruleForm.empIdcard=e),placeholder:"身份证号"},null,8,["modelValue"])])),_:1})])),_:1}),p(t,{md:12,lg:12,xl:12},{"default":c((()=>[p(a,{label:"伤残病名称",prop:"disabilityName"},{"default":c((()=>[p(i,{modelValue:j.ruleForm.disabilityName,"onUpdate:modelValue":l[2]||(l[2]=e=>j.ruleForm.disabilityName=e),placeholder:"请输入伤残病名称",maxlength:"50",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),p(t,{md:12,lg:12,xl:12},{"default":c((()=>[p(a,{label:"职业病名称",prop:"occupationalDisease"},{"default":c((()=>[p(i,{modelValue:j.ruleForm.occupationalDisease,"onUpdate:modelValue":l[3]||(l[3]=e=>j.ruleForm.occupationalDisease=e),placeholder:"请输入职业病名称",maxlength:"50",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),p(t,{md:12,lg:12,xl:12},{"default":c((()=>[p(a,{label:"伤残等级",prop:"disabilityLevel"},{"default":c((()=>[p(m,{modelValue:j.ruleForm.disabilityLevel,"onUpdate:modelValue":l[4]||(l[4]=e=>j.ruleForm.disabilityLevel=e),placeholder:"请选择伤残等级",clearable:"",filterable:"",style:{width:"100%"}},{"default":c((()=>[(g(!0),n(y,null,h(j.disabilityGradeList,(e=>(g(),F(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),p(t,{md:12,lg:12,xl:12},{"default":c((()=>[p(a,{label:"伤残开始日期",prop:"startTime"},{"default":c((()=>[p(s,{modelValue:j.ruleForm.startTime,"onUpdate:modelValue":l[5]||(l[5]=e=>j.ruleForm.startTime=e),type:"date",placeholder:"请选择伤残开始日期",style:{width:"100%"},"value-format":"YYYY-MM-DD 00:00:00","disabled-date":R},null,8,["modelValue"])])),_:1})])),_:1}),p(t,{md:12,lg:12,xl:12},{"default":c((()=>[p(a,{label:"伤残结束日期",prop:"endTime"},{"default":c((()=>[p(s,{modelValue:j.ruleForm.endTime,"onUpdate:modelValue":l[6]||(l[6]=e=>j.ruleForm.endTime=e),type:"date",placeholder:"请选择伤残结束日期",style:{width:"100%"},"value-format":"YYYY-MM-DD 00:00:00","disabled-date":z},null,8,["modelValue"])])),_:1})])),_:1}),p(t,{md:12,lg:12,xl:12},{"default":c((()=>[p(a,{label:"是否工伤",prop:"injuryIdentification"},{"default":c((()=>[p(_,{modelValue:j.ruleForm.injuryIdentification,"onUpdate:modelValue":l[7]||(l[7]=e=>j.ruleForm.injuryIdentification=e)},{"default":c((()=>[p(u,{label:"0"},{"default":c((()=>[v])),_:1}),p(u,{label:"1"},{"default":c((()=>[I])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),p(t,{md:24,lg:24,xl:24},{"default":c((()=>[p(a,{label:"备注",prop:"remark"},{"default":c((()=>[p(i,{type:"textarea",modelValue:j.ruleForm.remark,"onUpdate:modelValue":l[8]||(l[8]=e=>j.ruleForm.remark=e),autosize:{minRows:2,maxRows:4},placeholder:"请输入备注","show-word-limit":"",maxlength:"200",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),p(N,{md:24,lg:24,xl:24},{"default":c((()=>[p(a,{label:"附件"},{"default":c((()=>[p(o,{ref_key:"attachUploadRef",ref:T,"file-list":j.fileList,onRemovefile:S,onChangefile:C,type:1,filePath:"degreefileList",domain:j.id},null,8,["file-list","domain"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["title","modelValue"])])}}});export{L as default};