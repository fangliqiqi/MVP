import{d as e,f as t,$ as a,a2 as r,c as o,W as s,P as n,aD as i,a3 as d,o as l,U as c,V as m}from"./vue.1672389691407.js";import{_ as p,I as u,h,E as x,J as g,a as f,K as y}from"./index.1672389691407.js";import{P as C}from"./ProTable.1672389691407.js";import{P as T}from"./index.16723896914072.js";import{e as N}from"./excel.1672389691407.js";import{E as b}from"./index.16723896914076.js";import{O as S}from"./header.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";import"./xlsx.1672389691407.js";import"./vuedraggable.umd.1672389691407.js";var j=p(e({name:"订单管理",components:{ProTable:C,ProButtons:T,ExportExcelDialog:b},setup(){const e=i(),o=t(null),s=t(null),n=t(null),d={0:"待处理",1:"处理中",2:"已办结"},l=()=>{if(c.value=!0,m.selectionChangeList.length>0){const e=[];m.selectionChangeList.map((t=>{e.push(t.id)})),m.params={idList:e}}else m.params=o.value.getParams(),delete m.params.size,delete m.params.current;u(m.params).then((e=>{N(S,e.data.map((e=>({orderNo:e.orderNo,createTime:e.createTime,createName:e.createName,customerName:e.customerName,deptName:e.deptName,deptNo:e.deptNo,orderStatus:d[e.orderStatus]}))),`订单列表导出${h().format("YYYYMMDD")}`),x.success("导出成功")}))["finally"]((()=>{c.value=!1}))},c=t(!1),m=a({selectionChangeList:[],ORDER_EXPORT_HEADER:S,searchConfig:{labelWidth:110,option:{extBtn:"extBtns"}},btn:[{label:"批量导出",onClick:l,loading:c,permission:["order:order_getOrderList"],icon:"icon-ic_edit_export"}],columns:[{dataIndex:"orderNo",title:"订单号",minWidth:"80px"},{dataIndex:"createTime",title:"订单日期",searchIndex:"startEndTime",startTime:"startDate",endTime:"endDate",valueType:"dateTimeRange",selectType:"daterange",format:"YYYY-MM-DD",minWidth:100},{dataIndex:"createName",title:"下单人"},{dataIndex:"customerName",title:"客户名称",tooltip:!0,minWidth:200},{dataIndex:"deptName",title:"项目名称",minWidth:200,tooltip:!0},{dataIndex:"deptNo",title:"项目编码"},{dataIndex:"orderStatus",title:"订单状态",scopedSlots:{customRender:"orderStatus"},valueType:"select",valueEnum:d},{dataIndex:"option",title:"操作",key:"option",width:200,fixed:"right",hideInSearch:!0,scopedSlots:{customRender:"option"}}],cellBtns:[{text:"办理",prop:"manage",permission:["order:order_manage"],isGray:e=>"2"==e.orderStatus},{text:"详情",prop:"detail",permission:["order:order_detail"]},{text:"办结",prop:"conclude",permission:["order:order_conclude"],isGray:e=>"2"==e.orderStatus}]});return{...r(m),proRef:o,request:async e=>{try{let t=await g(e);if(t&&200==t.code&&t.data)return{current:t.data.current,total:t.data.total,data:t.data.records}}catch(t){}},typeOptions:d,onCellClick:async(t,a)=>{switch(t){case"manage":e.push({name:"oreder-manage-handle",params:{id:a.id}});break;case"detail":e.push({name:"oreder-manage-detail",params:{id:a.id}});break;case"conclude":const t='<p style="font-size:16px;font-weight:600">是否确定办结?<br/>\n\t\t\t\t\t<span style="color:red;font-size:14px;font-weight:400">办结后，将禁止对订单进行任何操作，仅可查看，请谨慎操作！</span></p>';f.confirm(t,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((async()=>{try{const e=await y({id:a.id,status:2});e&&200==e.code?(x.success("办结成功"),o.value.refresh()):x.error(e.msg)}catch(e){}}))["catch"]((()=>{}))}},detailLogRef:s,selectionChange:e=>{m.selectionChangeList=e},handleBatchExport:l,exportExcelRef:n}}}),[["render",function(e,t,a,r,i,p){const u=d("pro-buttons"),h=d("pro-table");return l(),o("div",null,[s(h,{"row-key":"id",ref:"proRef",columns:e.columns,request:e.request,btn:e.btn,multi:"",searchConfig:e.searchConfig,onSelectionChange:e.selectionChange},{orderStatus:n((t=>[c(m(e.typeOptions[t.orderStatus]),1)])),option:n((t=>[s(u,{ref:"proButtons",array:e.cellBtns,model:t,onOnClick:e.onCellClick},null,8,["array","model","onOnClick"])])),_:1},8,["columns","request","btn","searchConfig","onSelectionChange"])])}]]);export{j as default};