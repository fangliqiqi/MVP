import{g as e}from"./staff.1672389691407.js";import{O as l,P as a,Q as i}from"./attach.1672389691407.js";import{g as t}from"./file.1672389691407.js";import{P as o}from"./index.16723896914073.js";import r from"./attachUpload.1672389691407.js";import{E as d}from"./index.1672389691407.js";import{d as u,f as m,$ as n,c as s,W as c,P as f,a3 as p,o as g,a as h,F as b,a5 as y,O as F,U as v}from"./vue.1672389691407.js";const _={"class":"system-add-dic-container"},V=v("是"),L=v("否"),q={"class":"dialog-footer"},I=v("取 消"),w=v("确 定"),x=u({name:"systemAddDic"}),C=Object.assign(x,{emits:["ok"],setup(u,{expose:v,emit:x}){const C=m(null),U=m(null),Y=m(null),k=n({isShowDialog:!1,loading:!1,id:null,title:"新增职业资格",ruleForm:{empId:"",empCode:"",empName:"",empIdcard:"",certificationNo:"",declareYear:"",assessmentUnit:"",obtainType:"",qualificationType:"",qualificationLevel:"",heightIdentification:"0",remark:"",attaIds:""},fileList:[],options:[],dictConfig:{obtainTypeList:[],qualificationTypeList:[],qualificationLevelList:[],levelList:[]},editYear:""}),N={empName:[{required:!0,message:"请选择员工",trigger:"change"}],qualificationType:[{required:!0,message:"请选择资格类型",trigger:"change"}],qualificationLevel:[{required:!0,message:"请选择资格等级",trigger:"change"}]},T=e=>{k.fileList=e.value},D=e=>{k.fileList=e.value},j=async l=>{try{l.fileStatus=0;const a=await e(l);if(a&&200==a.code&&a.data)return{current:a.data.current,total:a.data.total,data:a.data.records};d.error(a.msg)}catch(a){}return{current:1,total:0,data:[]}},S=e=>{k.ruleForm.empCode=e.empCode,k.ruleForm.empId=e.id,k.ruleForm.empIdcard=e.empIdcard,k.options=[e]},R=e=>e.getFullYear()>(new Date).getFullYear(),z=e=>{e>(new Date).getFullYear()?k.ruleForm.declareYear=k.editYear:(k.editYear=e,k.ruleForm.declareYear=e)},P=e=>{k.dictConfig.levelList=k.dictConfig.qualificationLevelList.filter((l=>l.parentId==e)),k.ruleForm.qualificationLevel=""},O=async e=>{try{const a=await l(e);if(a&&200===a.code){const e={...a.data};k.options=[{empIdcard:e.empIdcard,empName:e.empName}],k.ruleForm=e,k.isShowDialog=!0,k.dictConfig.levelList=k.dictConfig.qualificationLevelList.filter((e=>e.parentId==k.ruleForm.qualificationType))}else d.error(a.msg||"获取职业资格详情失败");const i=await t(e);i&&200===i.code?k.fileList=i.data.map((e=>(e.name=e.attaName,e.uid=e.id,e.url=e.attaUrl,e))):(k.fileList=[],d.error(i.msg||"获取附件失败"))}catch(a){E()}},E=()=>{C.value.resetFields(),k.ruleForm={empId:"",empCode:"",empName:"",empIdcard:"",certificationNo:"",declareYear:"",assessmentUnit:"",obtainType:"",qualificationType:"",qualificationLevel:"",heightIdentification:"0",remark:"",attaIds:""},k.editYear="",k.isShowDialog=!1,k.loading=!1},A=()=>{E()},Q=()=>{C.value.validate((e=>{if(e){k.loading=!0;const e=[];k.fileList.forEach((l=>{e.push(l.uid)})),k.ruleForm.attaIds=e.join(","),null!==k.id&&void 0!==k.id?a(k.ruleForm).then((e=>{e&&200==e.code?(d.success("编辑职业资格成功"),x("ok"),E()):d.error(e.msg||"编辑职业资格失败")}),(()=>{d.error("编辑职业资格失败")}))["finally"]((()=>{k.loading=!1})):i(k.ruleForm).then((e=>{e&&200==e.code?(d.success("新增职业资格成功"),x("ok"),E()):d.error(e.msg||"新增职业资格失败")}),(()=>{d.error("新增职业资格失败")}))["finally"]((()=>{k.loading=!1}))}}))};return v({openDialog:async(e,l)=>{k.dictConfig=l,e&&e.id?(k.title="编辑职业资格",k.id=e.id,k.editYear=e.declareYear,await O(e.id)):(k.title="新增职业资格",k.id=null,k.ruleForm={empId:"",empCode:"",empName:"",empIdcard:"",certificationNo:"",declareYear:"",assessmentUnit:"",obtainType:"",qualificationType:"",qualificationLevel:"",heightIdentification:"0",remark:"",attaIds:""},k.fileList=[],k.isShowDialog=!0)}}),(e,l)=>{const a=p("el-form-item"),i=p("el-col"),t=p("el-input"),d=p("el-date-picker"),u=p("el-option"),m=p("el-select"),n=p("el-radio"),v=p("el-radio-group"),x=p("el-row"),O=p("el-form"),W=p("el-button"),$=p("el-dialog");return g(),s("div",_,[c($,{title:k.title,modelValue:k.isShowDialog,"onUpdate:modelValue":l[10]||(l[10]=e=>k.isShowDialog=e),"close-on-click-modal":!1,width:"816px",onClose:E},{footer:f((()=>[h("span",q,[c(W,{onClick:A,size:"default"},{"default":f((()=>[I])),_:1}),c(W,{type:"primary",onClick:Q,loading:k.loading,size:"default"},{"default":f((()=>[w])),_:1},8,["loading"])])])),"default":f((()=>[c(O,{ref_key:"formRef",ref:C,model:k.ruleForm,rules:N,size:"default","label-width":"110px"},{"default":f((()=>[c(x,null,{"default":f((()=>[c(i,{md:12,lg:12,xl:12},{"default":f((()=>[c(a,{label:"员工姓名",prop:"empName"},{"default":f((()=>[c(o,{disabled:!!k.id,ref_key:"pageSelectRef",ref:U,modelValue:k.ruleForm.empName,"onUpdate:modelValue":l[0]||(l[0]=e=>k.ruleForm.empName=e),request:j,"value-key":"empName",title:"empName",search:"empName",placeholder:"请选择员工",options:k.options,onChange:S},null,8,["disabled","modelValue","options"])])),_:1})])),_:1}),c(i,{md:12,lg:12,xl:12},{"default":f((()=>[c(a,{label:"身份证号"},{"default":f((()=>[c(t,{modelValue:k.ruleForm.empIdcard,"onUpdate:modelValue":l[1]||(l[1]=e=>k.ruleForm.empIdcard=e),placeholder:"身份证号",disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),c(i,{md:12,lg:12,xl:12},{"default":f((()=>[c(a,{label:"证书编号",prop:"certificationNo"},{"default":f((()=>[c(t,{modelValue:k.ruleForm.certificationNo,"onUpdate:modelValue":l[2]||(l[2]=e=>k.ruleForm.certificationNo=e),placeholder:"请输入证书编号",maxlength:"50",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),c(i,{md:12,lg:12,xl:12},{"default":f((()=>[c(a,{label:"申报年度",prop:"declareYear"},{"default":f((()=>[c(d,{modelValue:k.ruleForm.declareYear,"onUpdate:modelValue":l[3]||(l[3]=e=>k.ruleForm.declareYear=e),type:"year",style:{width:"100%"},"disabled-date":R,"value-format":"YYYY",placeholder:"请选择申报年度",onChange:z},null,8,["modelValue"])])),_:1})])),_:1}),c(i,{md:12,lg:12,xl:12},{"default":f((()=>[c(a,{label:"评定机构",prop:"assessmentUnit"},{"default":f((()=>[c(t,{modelValue:k.ruleForm.assessmentUnit,"onUpdate:modelValue":l[4]||(l[4]=e=>k.ruleForm.assessmentUnit=e),placeholder:"请输入评定机构",maxlength:"50",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),c(i,{md:12,lg:12,xl:12},{"default":f((()=>[c(a,{label:"获取方式",prop:"obtainType\t"},{"default":f((()=>[c(m,{modelValue:k.ruleForm.obtainType,"onUpdate:modelValue":l[5]||(l[5]=e=>k.ruleForm.obtainType=e),placeholder:"请选择获取方式",clearable:"",filterable:"",style:{width:"100%"}},{"default":f((()=>[(g(!0),s(b,null,y(k.dictConfig.obtainTypeList,(e=>(g(),F(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),c(i,{md:12,lg:12,xl:12},{"default":f((()=>[c(a,{label:"资格类型",prop:"qualificationType"},{"default":f((()=>[c(m,{modelValue:k.ruleForm.qualificationType,"onUpdate:modelValue":l[6]||(l[6]=e=>k.ruleForm.qualificationType=e),placeholder:"请选择资格类型",clearable:"",filterable:"",style:{width:"100%"},onChange:P},{"default":f((()=>[(g(!0),s(b,null,y(k.dictConfig.qualificationTypeList,(e=>(g(),F(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),c(i,{md:12,lg:12,xl:12},{"default":f((()=>[c(a,{label:"资格等级",prop:"qualificationLevel"},{"default":f((()=>[c(m,{modelValue:k.ruleForm.qualificationLevel,"onUpdate:modelValue":l[7]||(l[7]=e=>k.ruleForm.qualificationLevel=e),placeholder:"请选择资格等级",clearable:"",filterable:"",disabled:!k.ruleForm.qualificationType,style:{width:"100%"}},{"default":f((()=>[(g(!0),s(b,null,y(k.dictConfig.levelList,(e=>(g(),F(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1}),c(i,{md:12,lg:12,xl:12},{"default":f((()=>[c(a,{label:"是否最高等级",prop:"heightIdentification"},{"default":f((()=>[c(v,{modelValue:k.ruleForm.heightIdentification,"onUpdate:modelValue":l[8]||(l[8]=e=>k.ruleForm.heightIdentification=e)},{"default":f((()=>[c(n,{label:"0"},{"default":f((()=>[V])),_:1}),c(n,{label:"1"},{"default":f((()=>[L])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),c(i,{md:24,lg:24,xl:24},{"default":f((()=>[c(a,{label:"备注",prop:"remark"},{"default":f((()=>[c(t,{type:"textarea",modelValue:k.ruleForm.remark,"onUpdate:modelValue":l[9]||(l[9]=e=>k.ruleForm.remark=e),autosize:{minRows:2,maxRows:4},placeholder:"请输入备注","show-word-limit":"",maxlength:"200",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),c(x,{md:24,lg:24,xl:24},{"default":f((()=>[c(a,{label:"附件"},{"default":f((()=>[c(r,{ref_key:"attachUploadRef",ref:Y,"file-list":k.fileList,onRemovefile:D,onChangefile:T,type:2,filePath:"degreefileList",domain:k.id},null,8,["file-list","domain"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["title","modelValue"])])}}});export{C as default};