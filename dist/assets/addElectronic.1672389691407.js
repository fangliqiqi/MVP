import{s as e,_ as a,g as l,E as t}from"./index.1672389691407.js";import o from"./attachUpload.1672389691407.js";import{P as r}from"./index.16723896914073.js";import{g as i}from"./file.1672389691407.js";import{g as d}from"./staff.1672389691407.js";import{d as s,f as u,$ as n,c as m,W as c,P as f,a3 as p,o as h,a as y,F as g,a5 as _,O as v,U as b}from"./vue.1672389691407.js";async function F(a){return e({url:"/yifu-archives/method/telecemployeeinfo/page",method:"GET",params:a})}async function I(a){return e({url:"/yifu-archives/method/telecemployeeinfo/"+a,method:"DELETE"})}async function T(a){return e({url:"/yifu-archives/method/telecemployeeinfo/"+a,method:"get"})}const w={"class":"archives-add-electronic-container"},S={"class":"dialog-footer"},V=b("取 消"),j=b("确 定"),D=s({name:"addElectronic"});var L=a(Object.assign(D,{emits:["ok"],setup(a,{expose:s,emit:b}){const F=u(null),I=u(null),D=n({isShowDialog:!1,id:null,title:"新增电子档案",ruleForm:{empIdcard:null,empName:null,dataType:null,attaInfo:null},fileList:[],literatureTypesDataSource:{},options:[],loading:!1}),L={empIdcard:[{required:!0,message:"请选择身份证号"}],empName:[{required:!0,message:"请输入员工姓名"}],dataType:[{required:!0,message:"请选择资料类型"}]},k=e=>{D.fileList=e.value},N=e=>{D.fileList=e.value},U=async e=>{try{const a=await d(Object.assign({},e,{fileStatus:0}));if(a&&200==a.code&&a.data)return{current:a.data.current,total:a.data.total,data:a.data.records};t.error(a.msg)}catch(a){}return{current:1,total:0,data:[]}},x=e=>{D.ruleForm.empName=e.empName,D.ruleForm.empIdcard=e.empIdcard,D.options=[e]},E=async e=>{try{const a=await T(e);if(a&&200===a.code){D.options=[{...a.data}],D.ruleForm=a.data,D.isShowDialog=!0;const l=await i(e);l&&200===l.code?D.fileList=l.data.map((e=>(e.name=e.attaName,e.uid=e.id,e.url=e.attaUrl,e))):(D.fileList=[],t.error(l.msg||"获取附件失败"))}else t.error(a.msg||"获取电子档案详情失败"),O()}catch(a){O(),t.error("获取电子档案详情失败")}},O=()=>{D.ruleForm={},D.isShowDialog=!1,D.loading=!1,F.value&&F.value.clearValidate()},P=()=>{O()},C=()=>{F.value&&F.value.validate((a=>{if(a){D.loading=!0;const a=[];D.fileList.forEach((e=>{a.push(e.uid)})),D.ruleForm.attaIds=a.join(","),null!==D.id&&void 0!==D.id?async function(a){return e({url:"/yifu-archives/method/telecemployeeinfo",method:"PUT",data:a})}(D.ruleForm).then((e=>{e&&200==e.code?(t.success("编辑电子档案成功"),b("ok"),O()):t.error(e.msg||"编辑电子档案失败")}),(()=>{t.error("编辑电子档案失败")}))["finally"]((e=>{D.loading=!1})):async function(a){return e({url:"/yifu-archives/method/telecemployeeinfo",method:"POST",data:a})}(D.ruleForm).then((e=>{e&&200==e.code?(t.success("新增电子档案成功"),b("ok"),O()):t.error(e.msg||"新增电子档案失败")}),(()=>{t.error("新增电子档案失败")}))["finally"]((e=>{D.loading=!1}))}}))};return s({openDialog:async e=>{D.loading=!1,e&&e.id?(D.title="编辑电子档案",D.fileList=[],D.id=e.id,await E(e.id)):(D.title="新增电子档案",D.fileList=[],D.id=null,D.ruleForm={empIdcard:null,empName:null,dataType:null,attaInfo:null},setTimeout((()=>{F.value&&F.value.clearValidate()}),100)),l("literature_types").then((e=>{D.literatureTypesDataSource=e})),D.isShowDialog=!0}}),(e,a)=>{const l=p("el-form-item"),t=p("el-col"),i=p("el-input"),d=p("el-option"),s=p("el-select"),u=p("el-row"),n=p("el-form"),b=p("el-button"),T=p("el-dialog");return h(),m("div",w,[c(T,{title:D.title,modelValue:D.isShowDialog,"onUpdate:modelValue":a[3]||(a[3]=e=>D.isShowDialog=e),"close-on-click-modal":!1,width:"576px",onClose:O},{footer:f((()=>[y("span",S,[c(b,{onClick:P,size:"default"},{"default":f((()=>[V])),_:1}),c(b,{type:"primary",onClick:C,size:"default",loading:D.loading},{"default":f((()=>[j])),_:1},8,["loading"])])])),"default":f((()=>[c(n,{ref_key:"formRef",ref:F,model:D.ruleForm,rules:L,size:"default","label-width":"90px"},{"default":f((()=>[c(u,null,{"default":f((()=>[c(t,{"class":"mb20"},{"default":f((()=>[c(l,{label:"身份证号",prop:"empIdcard"},{"default":f((()=>[c(r,{disabled:!!D.id,ref_key:"pageSelectRef",ref:I,modelValue:D.ruleForm.empIdcard,"onUpdate:modelValue":a[0]||(a[0]=e=>D.ruleForm.empIdcard=e),request:U,"value-key":"empIdcard",title:"empIdcard",search:"empIdcard",placeholder:"请输入身份证号查询",options:D.options,onChange:x},null,8,["disabled","modelValue","options"])])),_:1})])),_:1}),c(t,{"class":"mb20"},{"default":f((()=>[c(l,{label:"员工姓名",prop:"empName"},{"default":f((()=>[c(i,{disabled:"",modelValue:D.ruleForm.empName,"onUpdate:modelValue":a[1]||(a[1]=e=>D.ruleForm.empName=e),placeholder:"请输入员工姓名",maxlength:"20",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),c(t,{"class":"mb20"},{"default":f((()=>[c(l,{label:"资料类型",prop:"dataType"},{"default":f((()=>[c(s,{modelValue:D.ruleForm.dataType,"onUpdate:modelValue":a[2]||(a[2]=e=>D.ruleForm.dataType=e),modelModifiers:{trim:!0},style:{width:"100%"},placeholder:"请选择",filterable:""},{"default":f((()=>[(h(!0),m(g,null,_(D.literatureTypesDataSource,((e,a)=>(h(),v(d,{key:"archives_add_electronic_dataType_"+a,label:e,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),c(t,{"class":"mb20"},{"default":f((()=>[c(l,{label:"附件",prop:"attaInfo"},{"default":f((()=>[c(o,{ref:"attachUploadRef","file-list":D.fileList,onRemovefile:N,onChangefile:k,type:8,filePath:"degreefileList",domain:D.id},null,8,["file-list","domain"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["title","modelValue"])])}}}),[["__scopeId","data-v-02133a07"]]),k=Object.freeze(Object.defineProperty({__proto__:null,"default":L},Symbol.toStringTag,{value:"Module"}));export{L as a,T as b,k as c,I as d,F as g};