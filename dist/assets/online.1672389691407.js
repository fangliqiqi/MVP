import{g as e,n as t,o as a,p as r}from"./staff.1672389691407.js";import{_ as n,f as o,g as l,a as i}from"./index.1672389691407.js";import{S as s}from"./dicts.1672389691407.js";import{P as d}from"./ProTable.1672389691407.js";import{P as c}from"./index.16723896914072.js";import p from"./checkInfo.1672389691407.js";import m from"./downshiftDialog.1672389691407.js";import{B as u}from"./index.16723896914077.js";import{E as h}from"./index.16723896914076.js";import{i as f,f as g,$ as _,j as b,E as x,a2 as y,c as E,W as v,P as I,aD as A,aA as D,a3 as S,o as R,a as C,O as T,V as w,U as k,ay as N,az as j}from"./vue.1672389691407.js";import{v as O}from"./xlsx.1672389691407.js";import{o as F,a as H}from"./events.1672389691407.js";import{$ as P,a0 as W,a1 as L,a2 as B,q as U,E as z,a3 as V,a4 as M}from"./header.1672389691407.js";import{i as q,l as $}from"./city.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./excel.1672389691407.js";import"./vuedraggable.umd.1672389691407.js";const K={name:"在档人员",components:{ProTable:d,ProButtons:c,ArrowDown:o,checkInfoVue:p,downshiftDialog:m,BatchImportDialog:u,ExportExcelDialog:h},setup(){var n;const o=A(),d=D(),c=null==(n=f())?void 0:n.appContext.config.globalProperties.$message,p=g(null),m=g(null),u=g(null),h=g(null),E=g(null),v=g(null),I=g(null),S=g(null),{proxy:R}=f(),C=()=>{p.value&&p.value.refresh()},T=_({searchConfig:{labelWidth:110,option:{extBtn:"extBtns"}},columns:[{dataIndex:"empCode",title:"员工主码",minWidth:140,tooltip:!0,fixed:"left"},{dataIndex:"empName",title:"员工姓名",minWidth:160},{dataIndex:"empIdcard",title:"身份证号",minWidth:200},{dataIndex:"empNatrue",title:"员工类型",minWidth:180,multiple:!0,hideInTable:!0,searchIndex:"empNatureArray"},{dataIndex:"empAge",title:"年龄(岁)",minWidth:100,hideInSearch:!0},{dataIndex:"empAgeStart",title:"开始年龄",minWidth:100,valueType:"custom",placeholder:"请输入开始年龄(岁)",hideInTable:!0,scopedSlots:{customRender:"empAgeStart"}},{dataIndex:"empAgeEnd",title:"截止年龄",placeholder:"请输入截止年龄(岁)",valueType:"custom",minWidth:100,hideInTable:!0,scopedSlots:{customRender:"empAgeEnd"}},{dataIndex:"empPhone",title:"手机号码",minWidth:140},{dataIndex:"address",title:"档案所在地",hideInSearch:!0,minWidth:180,ellipsis:!0,formatter:e=>q({province:e.fileProvince,city:e.fileCity,town:e.fileTown})},{dataIndex:"fileSource",title:"档案来源",hideInSearch:!0,minWidth:160,tooltip:!0},{dataIndex:"empNatrue",title:"员工类型",minWidth:180,multiple:!0,hideInSearch:!0,searchIndex:"empNatureArray"},{dataIndex:"createTime",title:"创建时间",hideInSearch:!0,minWidth:180},{dataIndex:"createName",title:"创建人",hideInSearch:!0,minWidth:160,tooltip:!0},{dataIndex:"multi",title:"是否多项目",hideInSearch:!0,minWidth:120,formatter:e=>null==e.projectNum||null==e.projectNum?"--":e.projectNum>1?"是":"否"},{dataIndex:"projectNum",title:"现存项目数",hideInSearch:!0,minWidth:120,scopedSlots:{customRender:"projectNum"}},{dataIndex:"contractStatus",title:"合同状态",valueType:"select",minWidth:160,multiple:!0,searchIndex:"contractStatusArray"},{dataIndex:"insuranceStatus",title:"商险状态",valueType:"select",minWidth:160,multiple:!0,searchIndex:"insuranceStatusArray"},{dataIndex:"socialStatus",title:"社保状态",valueType:"select",minWidth:160,multiple:!0,searchIndex:"socialStatusArray"},{dataIndex:"fundStatus",title:"公积金状态",valueType:"select",minWidth:160,multiple:!0,searchIndex:"fundStatusArray"},{dataIndex:"fileAddress",title:"档案所在地",hideInTable:!0,valueType:"custom",scopedSlots:{customRender:"fileAddress"}},{dataIndex:"salaryStatus",title:"近3个月发薪",minWidth:180,valueEnum:s},{dataIndex:"status",title:"档案状态",minWidth:180,valueEnum:{0:"草稿",1:"已审核"}},{dataIndex:"projectNum",title:"是否多项目",hideInTable:!0,minWidth:180,valueEnum:{1:"否",2:"是"}},{dataIndex:"option",title:"操作",key:"option",width:240,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"新增",onClick:()=>{m.value&&m.value.openDialog()},permission:["temployeeinfo_add"],icon:"icon-ic_edit_add"},{label:"批量导入",onClick:()=>{h.value&&h.value.openDialog()},type:"default",permission:["employee_batch_import"],icon:"icon-ic_edit_upload"},{label:"批量更新",type:"default",onClick:()=>{E.value&&E.value.openDialog()},permission:["employee_batch_update"],icon:"icon-ic_edit_refresh"},{label:"批量删除",type:"default",onClick:()=>{if(!T.selectionChangeList||0===T.selectionChangeList.length)return void c.error("请先选择待删除的人员档案");const e=`<p style="font-size:16px;font-weight:600">是否确定删除${T.selectionChangeList.length}条档案?<br/>\n\t\t\t\t<span style="color:red;font-size:14px;font-weight:400">删除后，档案将从系统消失，请谨慎操作！</span></p>`;i.confirm(e,{type:"warning",dangerouslyUseHTMLString:!0}).then((async()=>{try{const e=T.selectionChangeList.map((e=>e.id)),a=await t(e);a&&200===a.code?(c.success("档案批量删除成功"),C()):a.data&&S.value&&S.value.openErrorDialog(a.data)}catch(e){c.error("删除失败")}}))["catch"]((()=>{}))},permission:["temployeeinfo_batch_del"],icon:"icon-ic_edit_delete"},{label:"批量导出",type:"default",onClick:()=>{let e=Object.assign({},p.value.getParams(),T.params);delete e.size,delete e.current;for(let t in e)(e[t]instanceof Array&&0===e[t].length||"fileAddress"===t)&&delete e[t];v.value&&v.value.openDialog(((t,r)=>{const n={...e,exportFields:t.map((e=>e.dataIndex))},o=T.selectionChangeList.map((e=>e.id));o&&o.length&&(n.idList=o),a({},n).then((e=>{e.code&&200!==e.code&&i.error(e.msg),r(!0)}))}))},permission:["hro:archives-online-batch-export"],icon:"icon-ic_edit_export"},{label:"批量减档",type:"default",onClick:()=>{I.value&&I.value.openDialog()},permission:["temployeeinfo_batch_minus"],icon:"icon-ic_edit_delete"}],cellBtns:[{text:"详情",prop:"detail"},{text:"编辑",prop:"edit",permission:["temployeeinfo_edit"]},{text:"减档",prop:"downshift",permission:["temployeeinfo_minus"]},{text:"删除",prop:"delete",permission:["temployeeinfo_del"],tooltip:"当前状态不可删除",isGray:e=>"0"!=e.status}],DICTS:{},dictKeys:["emp_natrue","emp_married","emp_national","emp_political","emp_registype","education","EMP_SOURCE","social_ecurity_state","commercial_satte","personnel_state","fund_status"],params:{},areaProps:{label:"areaName",isLeaf:"isLeaf",children:"children"},selectionChangeList:[]});b((()=>{(async()=>{try{const e=await l(T.dictKeys);e&&(T.DICTS=e,T.columns=T.columns.map((t=>{const a={...t};switch(t.dataIndex){case"empNatrue":a.valueEnum=e.emp_natrue;break;case"fileSource":a.valueEnum=e.EMP_SOURCE;break;case"socialStatus":a.valueEnum=e.social_ecurity_state;break;case"insuranceStatus":a.valueEnum=e.commercial_satte;break;case"fundStatus":a.valueEnum=e.fund_status;break;case"contractStatus":a.valueEnum=e.personnel_state}return a})))}catch(e){}})(),H(R,d.path,(()=>{C()}))})),x((()=>{F(R)}));return{...y(T),request:async t=>{try{const a=Object.assign({},t,T.params,{fileStatus:"0"});delete a.fileAddress;const r=await e(a);if(r&&200==r.code&&r.data)return{current:r.data.current,total:r.data.total,data:r.data.records}}catch(a){}return{current:1,total:0,data:[]}},onCellClick:async(e,t)=>{switch(e){case"detail":o.push({name:"online-detail",params:{id:t.id}});break;case"delete":(e=>{i.confirm('<p style="font-size:16px;font-weight:600">是否确定删除?<br/>\n\t\t\t\t<span style="color:red;font-size:14px;font-weight:400">删除后，档案将从系统消失，请谨慎操作！</span></p>',{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((async()=>{try{const t=await r(e.id);t&&200===t.code?(c.success("档案删除成功"),C()):c.error(t.msg||"档案删除失败")}catch(t){c.error(t&&t.msg||"档案删除失败")}}))["catch"]((()=>{}))})(t);break;case"edit":o.push({name:"online-edit",params:{id:t.id}});break;case"downshift":u.value&&u.value.openDialog(t)}},proTableRef:p,checkInfoDialog:m,downshiftDialog:u,batchImportDialog:h,batchDownshiftDialog:I,refreshList:C,changeFileAddress:(e,t)=>{const a=[e.id];t.parent&&0!=t.parent.level&&(a.unshift(t.parent.data.id),t.parent.parent&&0!=t.parent.parent.level&&a.unshift(t.parent.parent.data.id));let r=null,n=null,o=null;r=a[0]||null,a.length>1&&(n=a[1]||null),a.length>2&&(o=a[2]||null),T.params.fileProvince=r,T.params.fileCity=n,T.params.fileTown=o},loadArea:(e,t)=>{const a=e.level,r=e.isLeaf;if(0!==a)return t(r?[]:$(e.data.id));t($(0));return t([])},clearFileAddress:()=>{T.params.fileProvince=null,T.params.fileCity=null,T.params.fileTown=null},batchUpdateDialog:E,STAFF_BATCH_UPDATE_HEADER:P,STAFF_IMPORT_HEADER:W,STAFF_EXPORT_HEADER:L,validBatchUpdateSheet:async e=>{const t=e.file.raw,a=await O(t,P,0,null,M);return a&&Array.isArray(a)&&a.length?{code:200}:a&&a.code&&1==a.code?{code:1,msg:"表格数据为空，请检查表格数据是否正确"}:{code:1,msg:"请检查你的表头信息，并确保与批量更新模板一致"}},selectionChange:e=>{T.selectionChangeList=e},exportExcelRef:v,STAFF_DOWNSHIFT_HEADER:B,onReset:()=>{T.params={}},batchDeleteDialog:S,STAFF_IMPORT_ERROR_HEADER:U,ERROR_HEADER:z,batchErrorData:(e,t)=>{let a=null;switch(e){case"staff-batch-import":a=t.map((e=>{const t=e.errors||[];return{line:e.lineNum,isError:t.length>0?"是":"否",error:t.join(",")}})).sort(((e,t)=>Number(e.line)-Number(t.line)));break;case"staff-batch-downshift":a=t.map((e=>{const t=e.errorSet||[];return{line:e.lineNum,error:t.join(",")}})).sort(((e,t)=>Number(e.line)-Number(t.line)));break;case"staff-batch-update":a=t.map((e=>{const t=e.errors||[];return{line:e.lineNum,isError:t.length>0?"是":"否",error:t.join(",")}})).sort(((e,t)=>Number(e.line)-Number(t.line)));break;case"staff-batch-delete":a=t.map((e=>({line:e.lineNum,empName:e.empName,empIdCard:e.empIdCard,result:0==e.result?"否":"是",error:e.errorSet.join(",")}))).sort(((e,t)=>Number(e.line)-Number(t.line)))}return a},STAFF_BATCH_DEL_ERROR_HEADER:V,toSubject:e=>{o.push({path:"/archives/subject",query:{projectIdCard:e.empIdcard}})}}}},X=e=>(N("data-v-64d65724"),e=e(),j(),e),G={"class":"archives-online-container"},J={"class":"el-dropdown-link"},Q=k(" 模板下载 "),Y=X((()=>C("a",{href:"/template/人员档案批量导入模板.xlsx",download:""}," 批量导入模板",-1))),Z=X((()=>C("a",{href:"/template/人员档案批量更新模板.xlsx",download:""}," 批量更新模板",-1))),ee=X((()=>C("a",{href:"/template/人员档案批量减档模板.xlsx",download:""}," 批量减档模板",-1))),te=["onClick"],ae=X((()=>C("div",null,[
C("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批量导入失败！"),
C("span",null,[
k("存在不符合要求的数据，请修改后，重新导入！"),
C("br"),
k("已为您下载反馈结果！")])],-1))),re=X((()=>C("div",null,[
C("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批量更新失败！"),
C("span",null,[
k("存在不符合要求的数据，请修改后，重新导入！"),
C("br"),
k("已为您下载反馈结果！")])],-1))),ne=X((()=>C("div",null,[
C("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批量减档失败！"),
C("span",null,[
k("存在不符合要求的数据，请修改后，重新导入！"),
C("br"),
k("已为您下载反馈结果！")])],-1))),oe=X((()=>C("div",null,[
C("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批量删除失败！"),
C("span",null,[
k("该档案存在进行中/已完结的服务！"),
C("br"),
k("已为您下载反馈结果！")])],-1)));var le=n(K,[["render",function(e,t,a,r,n,o){const l=S("arrow-down"),i=S("el-icon"),s=S("el-button"),d=S("el-dropdown-item"),c=S("el-dropdown-menu"),p=S("el-dropdown"),m=S("el-tree-select"),u=S("el-input-number"),h=S("pro-buttons"),f=S("pro-table"),g=S("check-info-vue"),_=S("downshift-dialog"),b=S("batch-import-dialog"),x=S("export-excel-dialog");return R(),E("div",G,[v(f,{ref:"proTableRef","row-key":"id",columns:e.columns,request:r.request,btn:e.btn,multi:!0,searchConfig:e.searchConfig,onSelectionChange:r.selectionChange,onOnReset:r.onReset},{extBtns:I((()=>[v(p,{"class":"arch-btn","popper-class":"module-download"},{dropdown:I((()=>[v(c,null,{"default":I((()=>[v(d,null,{"default":I((()=>[Y])),_:1}),v(d,null,{"default":I((()=>[Z])),_:1}),v(d,null,{"default":I((()=>[ee])),_:1})])),_:1})])),"default":I((()=>[C("span",J,[v(s,{size:"default"},{"default":I((()=>[Q,v(i,{"class":"el-icon--right"},{"default":I((()=>[v(l)])),_:1})])),_:1})])])),_:1})])),fileAddress:I((a=>[(R(),T(m,{modelValue:e.params.fileAddress,"onUpdate:modelValue":t[0]||(t[0]=t=>e.params.fileAddress=t),key:"arch_search_props_"+a.dateIndex+"_oIndex",style:{width:"100%"},placeholder:"请选择",props:e.areaProps,onCurrentChange:r.changeFileAddress,onClear:r.clearFileAddress,"node-key":"id",load:r.loadArea,"check-strictly":"",lazy:"",clearable:""},null,8,["modelValue","props","onCurrentChange","onClear","load"]))])),empAgeStart:I((a=>[v(u,{modelValue:e.params.empAgeStart,"onUpdate:modelValue":t[1]||(t[1]=t=>e.params.empAgeStart=t),placeholder:"请输入",min:1,max:100,precision:0,step:1,controls:!1,style:{width:"100%"}},null,8,["modelValue"])])),empAgeEnd:I((a=>[v(u,{modelValue:e.params.empAgeEnd,"onUpdate:modelValue":t[2]||(t[2]=t=>e.params.empAgeEnd=t),placeholder:"请输入",min:1,precision:0,step:1,controls:!1,style:{width:"100%"}},null,8,["modelValue"])])),projectNum:I((e=>[C("a",{href:"#",onClick:t=>r.toSubject(e)},w(e.projectNum),9,te)])),option:I((t=>[v(h,{array:e.cellBtns,model:t,onOnClick:r.onCellClick},null,8,["array","model","onOnClick"])])),_:1},8,["columns","request","btn","searchConfig","onSelectionChange","onOnReset"]),v(g,{ref:"checkInfoDialog",onOk:r.refreshList},null,8,["onOk"]),v(_,{ref:"downshiftDialog",onOk:r.refreshList},null,8,["onOk"]),v(b,{ref:"batchImportDialog",type:1,header:r.STAFF_IMPORT_HEADER,url:"/yifu-archives/method/temployeeinfo/batchImportEmployee",demobilize:"",onOk:r.refreshList,batchName:"staff-batch-import",demobilizeParamsName:"isCanAdd",errorHeader:r.STAFF_IMPORT_ERROR_HEADER,errorData:r.batchErrorData,customError:"",customErrorContent:"",download:""},{error:I((()=>[ae])),_:1},8,["header","onOk","errorHeader","errorData"]),v(b,{title:"批量更新",ref:"batchUpdateDialog",header:r.STAFF_BATCH_UPDATE_HEADER,url:"/yifu-archives/method/temployeeinfo/batchUpdateEmployee",onOk:r.refreshList,batchName:"staff-batch-update",valid:r.validBatchUpdateSheet,errorHeader:r.STAFF_IMPORT_ERROR_HEADER,errorData:r.batchErrorData,customError:"",customErrorContent:"",download:""},{error:I((()=>[re])),_:1},8,["header","onOk","valid","errorHeader","errorData"]),v(b,{title:"批量减档",ref:"batchDownshiftDialog",type:1,onOk:r.refreshList,header:r.STAFF_DOWNSHIFT_HEADER,batchName:"staff-batch-downshift",url:"/yifu-archives/method/temployeeinfo/batchMinusEmployee",errorHeader:r.ERROR_HEADER,errorData:r.batchErrorData,customError:"",customErrorContent:"",download:""},{error:I((()=>[ne])),_:1},8,["onOk","header","errorHeader","errorData"]),v(b,{title:"批量删除",ref:"batchDeleteDialog",type:1,onOk:r.refreshList,errName:"员工档案批量删除",batchName:"staff-batch-delete",errorHeader:r.STAFF_BATCH_DEL_ERROR_HEADER,errorData:r.batchErrorData,customError:"",customErrorContent:"",download:""},{error:I((()=>[oe])),_:1},8,["onOk","errorHeader","errorData"]),v(x,{ref:"exportExcelRef",heads:r.STAFF_EXPORT_HEADER,title:"员工档案导出",useCode:"hro:archives-online-batch-export"},null,8,["heads"])])}],["__scopeId","data-v-64d65724"]]);export{le as default};