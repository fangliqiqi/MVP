import{P as e}from"./ProTable.1672389691407.js";import{P as a}from"./index.16723896914072.js";import t from"./insureDetailDialog.1672389691407.js";import r from"./insureEditDialog.1672389691407.js";import{B as n}from"./index.16723896914077.js";import{I as o,m as s,n as i,o as d,D as l}from"./header.1672389691407.js";import{d as u}from"./custserve.1672389691407.js";import{_ as c,f as p,x as m,y as h,z as _,A as f,B as y,L as E,a as x}from"./index.1672389691407.js";import{reduceHandleStatus as I,buyHandleStatus as b,distributeType as D}from"./dict.1672389691407.js";import{i as R,f as g,h as S,$ as v,a2 as H,c as A,W as N,P as T,A as w,a3 as C,o as k,a as B,V as F,U,ay as j,az as O}from"./vue.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";import"./AreaUnionSelect.1672389691407.js";import"./company.1672389691407.js";import"./xlsx.1672389691407.js";import"./excel.1672389691407.js";const K={name:"Insurance",components:{ProTable:e,ProButtons:a,insureDetailDialog:t,insureEditDialog:r,ArrowDown:p,batchImportDialog:n},emits:["onActionUpdate"],props:{orderNo:String},setup(e,a){var t;const r=null==(t=R())?void 0:t.appContext.config.globalProperties.$message,n=g(null),c=g(null),p=g(null),A=g(null),N=g(null),T=g(null),C=g(null);S((()=>e.orderNo),((e,a)=>{k()}));const k=()=>{n.value&&n.value.refresh()},B=()=>{n.value&&n.value.doSearch()},F=e=>{if(w("disable"))return!0;const a=E.get("user_info");return(null==a?void 0:a.id)==e.createBy?4!==e.buyHandleStatus:5==e.buyType||4!=e.buyHandleStatus},U=v({searchConfig:{labelWidth:"90px",option:{extBtn:"extBtns"}},columns:[{dataIndex:"buyType",title:"派单类型",width:115,valueEnum:D,hideInSearch:!0},{dataIndex:"empName",title:"员工姓名",width:120},{dataIndex:"empIdcardNo",title:"身份证号",width:170},{dataIndex:"insuranceCompanyName",title:"保险公司",minWidth:120,hideInSearch:!0,ellipsis:!0},{dataIndex:"insuranceTypeName",title:"险种",minWidth:120,hideInSearch:!0,ellipsis:!0},{dataIndex:"buyStandard",title:"购买标准（元）",minWidth:120,hideInSearch:!0,ellipsis:!0},{dataIndex:"dieDisableQuota",title:"身故和残疾（万元）",minWidth:150,hideInSearch:!0,ellipsis:!0},{dataIndex:"medicalQuota",title:"医疗额度（万元）",minWidth:140,hideInSearch:!0,ellipsis:!0},{dataIndex:"createName",title:"申请人",minWidth:120,hideInSearch:!0,ellipsis:!0},{dataIndex:"createUserDeptName",title:"申请人所在部门",minWidth:120,hideInSearch:!0,ellipsis:!0},{dataIndex:"createTime",title:"申请时间",valueType:"dateTimeRange",searchIndex:"createTime",startTime:"startDate",endTime:"endDate",minWidth:160,valueFormat:"YYYY-MM-DD",format:"YYYY-MM-DD",selectType:"daterange"},{dataIndex:"buyHandleStatus",title:"办理状态",width:115,hideInSearch:!0,valueType:"custom",scopedSlots:{customRender:"buyHandleStatus"}},{dataIndex:"option",title:"操作",key:"option",width:180,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"新增投保",onClick:()=>{c.value&&c.value.openDialog()},permission:["insurance_custserve_insure_add"],icon:"icon-ic_edit_add",disabled:()=>w("disable")},{label:"批增",onClick:()=>{p.value&&p.value.openDialog()},permission:["insurance_custserve_insure_batch_add"],icon:"icon-ic_edit_add",disabled:()=>w("disable")},{label:"替换",type:"normal",onClick:()=>{T.value&&T.value.openDialog()},permission:["insurance_custserve_insure_update"],icon:"icon-ic_edit_refresh",disabled:()=>w("disable")},{label:"减员",type:"normal",onClick:()=>{C.value&&C.value.openDialog()},permission:["insurance_custserve_insured_reduce"],icon:"icon-ic_edit_export",disabled:()=>w("disable")}],cellBtns:[{text:"查看",prop:"detail",permission:["insurance_custserve_insure_detail"]},{text:"编辑",prop:"edit",permission:["insurance_custserve_insure_edit"],tooltip:"当前状态不可编辑",isGray:F},{text:"删除",prop:"delete",permission:["insurance_custserve_insure_delete"],tooltip:"当前状态不可删除",isGray:F}]});return{...H(e),...H(U),request:async a=>{const t=Object.assign({orderNo:e.orderNo},a);try{const e=await y({size:t.size,current:t.current},t);if(e&&200==e.code&&e.data)return{current:e.data.current,total:e.data.total,data:e.data.records||[]}}catch(r){}return{current:1,total:0,data:[]}},onCellClick:async(e,a)=>{switch(e){case"detail":A.value&&A.value.openDialog(a);break;case"edit":N.value&&N.value.openDialog(a);break;case"delete":(e=>{x.confirm('<p style="font-size:16px;font-weight:600">是否确定删除?<br/>\n\t\t\t\t<span style="color:red;font-size:14px;font-weight:400">删除后，投保记录将从系统消失，请谨慎操作！</span></p>',{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((async()=>{try{const a=await u(e.id);200===a.code?r.success("删除成功"):r.error(a.msg||"删除失败")}catch(a){r.error("删除失败")}finally{B()}}))["catch"]((()=>{}))})(a)}},proTableRef:n,addInsureRef:c,addBatchInsureRef:p,insureChangeRef:T,reduceInsureRef:C,refreshList:k,doSearchList:B,insureDetailRef:A,insureEditRef:N,INSURE_ADD_HEADER:o,INSURE_BATCH_HEADER:s,INSURE_CHANGE_HEADER:i,INSURE_REDUCE_HEADER:d,addInsuranceByFile:(a,t)=>m({data:t,orderNo:e.orderNo}),customErrorHeader:e=>{const a=[];return Object.keys(e).forEach((t=>{a.push({title:e[t],dataIndex:t})})),a.push({title:"错误原因",dataIndex:"errorMessage",width:200}),a},addBatchInsuranceByFile:(a,t)=>h({data:t,orderNo:e.orderNo}),changeInsuranceByFile:(a,t)=>_({data:t,orderNo:e.orderNo}),reduceInsuranceByFile:(a,t)=>f({data:t,orderNo:e.orderNo}),DATE_FORMAT_KEY:l,reduceHandleStatus:I,buyHandleStatus:b,actionSuccess:()=>{k(),a.emit("onActionUpdate")}}}},Y=e=>(j("data-v-45cd1ae4"),e=e(),O(),e),z={"class":"custserve-container"},M={"class":"el-dropdown-link"},W=U(" 模板下载 "),P=Y((()=>B("a",{href:"/template/insurance/商险新增模板.xlsx",download:""},"新增投保模板",-1))),q=Y((()=>B("a",{href:"/template/insurance/商险批增模板.xlsx",download:""},"批增模板",-1))),G=Y((()=>B("a",{href:"/template/insurance/商险替换模板.xlsx",download:""},"替换模板",-1))),L=Y((()=>B("a",{href:"/template/insurance/商险减员模板.xlsx",download:""},"减员模板",-1))),Q={key:0},$={key:1},V=Y((()=>B("div",null,[
B("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"新增投保失败！"),
B("span",null,[
U("存在不符合要求的数据，请修改后，重新导入！"),
B("br"),
U("已为您下载反馈结果！")])],-1))),J=Y((()=>B("div",null,[
B("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批增投保失败！"),
B("span",null,[
U("存在不符合要求的数据，请修改后，重新导入！"),
B("br"),
U("已为您下载反馈结果！")])],-1))),X=Y((()=>B("div",null,[
B("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"替换投保失败！"),
B("span",null,[
U("存在不符合要求的数据，请修改后，重新导入！"),
B("br"),
U("已为您下载反馈结果！")])],-1))),Z=Y((()=>B("div",null,[
B("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"减员失败！"),
B("span",null,[
U("存在不符合要求的数据，请修改后，重新导入！"),
B("br"),
U("已为您下载反馈结果！")])],-1)));var ee=c(K,[["render",function(e,a,t,r,n,o){const s=C("arrow-down"),i=C("el-icon"),d=C("el-button"),l=C("el-dropdown-item"),u=C("el-dropdown-menu"),c=C("el-dropdown"),p=C("pro-buttons"),m=C("pro-table"),h=C("insure-detail-dialog"),_=C("insure-edit-dialog"),f=C("batch-import-dialog");return k(),A("div",z,[N(m,{ref:"proTableRef","row-key":"onlyId",columns:e.columns,request:r.request,btn:e.btn,searchConfig:e.searchConfig,manualRequest:!0},{extBtns:T((()=>[N(c,{"popper-class":"module-download",style:{"margin-left":"6px"}},{dropdown:T((()=>[N(u,null,{"default":T((()=>[N(l,null,{"default":T((()=>[P])),_:1}),N(l,null,{"default":T((()=>[q])),_:1}),N(l,null,{"default":T((()=>[G])),_:1}),N(l,null,{"default":T((()=>[L])),_:1})])),_:1})])),"default":T((()=>[B("span",M,[N(d,{size:"default"},{"default":T((()=>[W,N(i,{"class":"el-icon--right"},{"default":T((()=>[N(s)])),_:1})])),_:1})])])),_:1})])),option:T((a=>[N(p,{array:e.cellBtns,model:a,onOnClick:r.onCellClick},null,8,["array","model","onOnClick"])])),buyHandleStatus:T((e=>[5==e.buyType?(k(),A("span",Q,F(r.reduceHandleStatus[e.reduceHandleStatus]),1)):(k(),A("span",$,F(r.buyHandleStatus[e.buyHandleStatus]),1))])),_:1},8,["columns","request","btn","searchConfig"]),N(h,{ref:"insureDetailRef"},null,512),N(_,{ref:"insureEditRef",onOk:r.doSearchList},null,8,["onOk"]),N(f,{title:"新增投保",ref:"addInsureRef",header:r.INSURE_ADD_HEADER,upload:r.addInsuranceByFile,onOk:r.actionSuccess,type:1,customError:"",errorHeader:r.customErrorHeader(r.INSURE_ADD_HEADER),download:"",dateFormatKeys:r.DATE_FORMAT_KEY},{error:T((()=>[V])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"]),N(f,{title:"批增投保",ref:"addBatchInsureRef",header:r.INSURE_BATCH_HEADER,upload:r.addBatchInsuranceByFile,onOk:r.actionSuccess,type:1,customError:"",errorHeader:r.customErrorHeader(r.INSURE_BATCH_HEADER),download:"",dateFormatKeys:r.DATE_FORMAT_KEY},{error:T((()=>[J])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"]),N(f,{title:"替换投保",ref:"insureChangeRef",header:r.INSURE_CHANGE_HEADER,upload:r.changeInsuranceByFile,onOk:r.actionSuccess,type:1,customError:"",errorHeader:r.customErrorHeader(r.INSURE_CHANGE_HEADER),download:"",dateFormatKeys:r.DATE_FORMAT_KEY},{error:T((()=>[X])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"]),N(f,{title:"发起减员",ref:"reduceInsureRef",header:r.INSURE_REDUCE_HEADER,upload:r.reduceInsuranceByFile,onOk:r.actionSuccess,type:1,customError:"",errorHeader:r.customErrorHeader(r.INSURE_REDUCE_HEADER),download:"",dateFormatKeys:r.DATE_FORMAT_KEY},{error:T((()=>[Z])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"])])}],["__scopeId","data-v-45cd1ae4"]]);export{ee as default};