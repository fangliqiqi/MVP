import{$ as e,f as a,a3 as l,o as d,c as o,W as t,P as s,a as i,U as n,d as r,w as c,a2 as u,O as h,T as m,F as g,a5 as p,V as f,_ as v,ay as k,az as x}from"./vue.1672389691407.js";import{e as y}from"./xlsx.1672389691407.js";import{d as H}from"./vuedraggable.umd.1672389691407.js";import{_ as C,s as F,n as b,E as D,h as _,a as S}from"./index.1672389691407.js";const V={"class":"archives-add-electronic-container"},w={"class":"dialog-footer"},I=n("取 消"),E=n("确 定");var A=C({__name:"save",emits:["save"],setup(n,{expose:r,emit:c}){const u=e({isShowDialog:!1,title:"保存导出筛选",saveFilterForm:{name:""},saveFilterRules:{name:[{required:!0,message:"请输入筛选名称",trigger:"blur"}]},saveLoading:!1}),h=a(null),m=()=>{h.value.resetFields(),u.isShowDialog=!1,u.saveFilterForm.name="",g()},g=()=>{u.saveLoading=!1},p=async()=>{u.saveLoading=!0;const e=u.saveFilterForm.name;c("save",e)};return r({openDialog:()=>{u.isShowDialog=!0},closeDialog:m,closeLoading:g}),(e,a)=>{const n=l("el-input"),r=l("el-form-item"),c=l("el-form"),g=l("el-button"),f=l("el-dialog");return d(),o("div",V,[t(f,{title:u.title,modelValue:u.isShowDialog,"onUpdate:modelValue":a[1]||(a[1]=e=>u.isShowDialog=e),width:"600px",onClose:m,"close-on-click-modal":!1},{footer:s((()=>[i("span",w,[i("div",null,[t(g,{onClick:m,size:"default"},{"default":s((()=>[I])),_:1}),t(g,{type:"primary",onClick:p,size:"default",disabled:!u.saveFilterForm.name,loading:u.saveLoading},{"default":s((()=>[E])),_:1},8,["disabled","loading"])])])])),"default":s((()=>[t(c,{model:u.saveFilterForm,ref_key:"saveFilterForm",ref:h,"label-width":"100px",rules:u.saveFilterRules},{"default":s((()=>[t(r,{label:"名称",prop:"name"},{"default":s((()=>[t(n,{modelValue:u.saveFilterForm.name,"onUpdate:modelValue":a[0]||(a[0]=e=>u.saveFilterForm.name=e),maxlength:"10",placeholder:"请拟定一个筛选器名称"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])])}}},[["__scopeId","data-v-6942a87e"]]);const L=r({name:"ExportExcel",components:{draggable:H,saveVue:A,Close:b},props:{heads:{type:Array,"default":null},title:{type:String,"default":"导出"},useCode:{type:String,"default":""}},setup(l,d){const o=e({isShowDialog:!1,checkAll:!1,isIndeterminate:!1,checkedHeads:[],fn:null,exportHeads:[],exporting:!1,maxSaveFilter:3,drag:!1,diyHeadlist:[],diyHead:""}),t=a(null),s=async e=>{const a=await async function(e){return F({url:"/yifu-archives/method/lexcelheadforio/getOwnList/"+e,method:"GET"})}(l.useCode);200==a.code?(o.diyHeadlist=a.data,e&&(o.diyHead=o.diyHeadlist[o.diyHeadlist.length-1].id)):D.error(a.msg)},i=(e,a,d)=>{if(e)return void(o.exporting=!1);const t={};o.checkedHeads.forEach((e=>{if(d.item)try{return t[e]=d[e](e,t[e])}catch(l){}return t[e]=a[e]||""})),y(o.exportHeads,t,{fileName:`${l.title}${_().format("YYYYMMDD")}`,type:{bookType:"xlsx",bookSST:!0,type:"binary",cellStyles:!0}}),D.success("导出完成！")};c((()=>{o.draggableHead=l.heads}));return{...u(l),...u(o),closeDialog:()=>{o.isShowDialog=!1,o.checkAll=!1,o.isIndeterminate=!1,o.exporting=!1,o.diyHead="",o.checkedHeads=[],o.exportHeads=[],o.fn=null},onSubmit:()=>{(o.exportHeads=l.heads.filter((e=>o.checkedHeads.includes(e.dataIndex))),o.exportHeads&&0!==o.exportHeads.length)?(o.draggableHead.forEach(((e,a)=>{e.index=a})),o.exportHeads=o.exportHeads.sort(((e,a)=>e.index-a.index)),o.fn&&(o.exporting=!0,o.fn(o.exportHeads,i))):D.success("导出项为空，请选择需要的导出项")},handleCheckAllChange:e=>{o.checkedHeads=e?l.heads.map((e=>e.dataIndex)):[],o.diyHead=!1,o.isIndeterminate=!1},handleCheckedHeadsChange:e=>{o.checkedHeads=e,o.checkAll=e.length===l.heads.length,o.isIndeterminate=0!=e.length&&e.length!=l.heads.length},openDialog:async e=>{l.useCode&&s(),o.isShowDialog=!0,o.fn=e},exportExcelFile:i,saveFilter:()=>{t.value&&t.value.openDialog(l.useCode,o.checkedHeads)},saveFilterFn:e=>{if(o.diyHeadlist.length>=o.maxSaveFilter)return D.warning(`最多只允许添加${o.maxSaveFilter}个筛选配置！`),void(t.value&&t.value.closeDialog());(async function(e,a){return F({url:"/yifu-archives/method/lexcelheadforio",method:"POST",params:e,data:a})})({maxMun:o.maxSaveFilter},{name:e,remark:l.title,useCode:l.useCode,excelHeadText:o.checkedHeads.join(",")}).then((e=>{200===e.code?(D.success("保存成功"),s(!0),t.value&&t.value.closeDialog()):D.error(e.msg||"保存失败")}))["catch"]((e=>{D.error("保存失败")}))["finally"]((()=>{t.value&&t.value.closeLoading()}))},saveVueDialog:t,closeDiy:e=>{S.confirm("是否确定删除?","提示",{type:"warning"}).then((()=>{(async function(e){return F({url:"/yifu-archives/method/lexcelheadforio/"+e,method:"DELETE"})})(e).then((e=>{200===e.code?(D.success("删除成功"),o.checkedHeads=[],o.isIndeterminate=!1,s(),o.checkAll=!1):D.error(e.msg||"删除失败")}))["catch"]((e=>{D.error("删除失败")}))}))},changeDiy:(e,a)=>{o.checkedHeads=a.excelHeadText.split(","),o.checkAll=o.checkedHeads.length===l.heads.length,o.isIndeterminate=o.checkedHeads.length>0&&o.checkedHeads.length<l.heads.length}}}}),T=e=>(k("data-v-3c466f5e"),e=e(),x(),e),U={"class":"archives-add-electronic-container"},z=n("全选"),j={"class":"dialog-footer export-footer"},Y=n("保存导出筛选"),$=T((()=>i("span",null,null,-1))),M=n("取 消"),O=n("导 出");var P=C(L,[["render",function(e,a,r,c,u,k){const x=l("el-checkbox"),y=l("el-tooltip"),H=l("Close"),C=l("el-icon"),F=l("el-radio"),b=l("el-radio-group"),D=l("draggable"),_=l("el-checkbox-group"),S=l("el-button"),V=l("el-dialog"),w=l("save-vue");return d(),o("div",U,[t(V,{title:e.title,modelValue:e.isShowDialog,"onUpdate:modelValue":a[6]||(a[6]=a=>e.isShowDialog=a),width:"800px",onClose:e.closeDialog,"close-on-click-modal":!1},{footer:s((()=>[i("span",j,[e.useCode?(d(),h(S,{key:0,type:"primary",size:"default",disabled:!e.checkedHeads||0==e.checkedHeads.length,onClick:e.saveFilter},{"default":s((()=>[Y])),_:1},8,["disabled","onClick"])):m("",!0),$,i("div",null,[t(S,{onClick:e.closeDialog,size:"default"},{"default":s((()=>[M])),_:1},8,["onClick"]),t(S,{type:"primary",onClick:e.onSubmit,size:"default",disabled:!e.checkedHeads||0==e.checkedHeads.length,loading:e.exporting},{"default":s((()=>[O])),_:1},8,["onClick","disabled","loading"])])])])),"default":s((()=>[t(x,{modelValue:e.checkAll,"onUpdate:modelValue":a[0]||(a[0]=a=>e.checkAll=a),indeterminate:e.isIndeterminate,onChange:e.handleCheckAllChange},{"default":s((()=>[z])),_:1},8,["modelValue","indeterminate","onChange"]),t(b,{"class":"radio_group",modelValue:e.diyHead,"onUpdate:modelValue":a[1]||(a[1]=a=>e.diyHead=a)},{"default":s((()=>[(d(!0),o(g,null,p(e.diyHeadlist,(a=>(d(),h(F,{key:a.id,label:a.id,"class":"radio_item",onChange:l=>e.changeDiy(l,a)},{"default":s((()=>[t(y,{content:a.name,placement:"top",effect:"dark"},{"default":s((()=>[n(f(a.name),1)])),_:2},1032,["content"]),t(C,{onClick:v((l=>e.closeDiy(a.id)),["stop"])},{"default":s((()=>[t(H)])),_:2},1032,["onClick"])])),_:2},1032,["label","onChange"])))),128))])),_:1},8,["modelValue"]),t(_,{modelValue:e.checkedHeads,"onUpdate:modelValue":a[5]||(a[5]=a=>e.checkedHeads=a),onChange:e.handleCheckedHeadsChange},{"default":s((()=>[t(D,{"class":"draggable",group:"export",modelValue:e.draggableHead,"onUpdate:modelValue":a[2]||(a[2]=a=>e.draggableHead=a),onStart:a[3]||(a[3]=a=>e.drag=!0),onEnd:a[4]||(a[4]=a=>e.drag=!1),"item-key":"title","chosen-class":"chosen"},{item:s((({element:e})=>[(d(),h(x,{key:e.dataIndex,label:e.dataIndex},{"default":s((()=>[n(f(e.title),1)])),_:2},1032,["label"]))])),_:1},8,["modelValue"])])),_:1},8,["modelValue","onChange"])])),_:1},8,["title","modelValue","onClose"]),t(w,{ref:"saveVueDialog",onSave:e.saveFilterFn},null,8,["onSave"])])}],["__scopeId","data-v-3c466f5e"]]);export{P as E};