import{_ as e,a8 as a,E as t,ag as l}from"./index.1672389691407.js";import{b as d}from"./role.1672389691407.js";import{d as s,f as o,$ as r,c as n,W as c,P as i,a3 as h,o as u,a as p,U as f}from"./vue.1672389691407.js";const m={"class":"system-add-role-container"},y={"class":"dialog-footer"},g=f("取 消"),k=f("确 定"),C=s({name:"systemAddManage"});var I=e(Object.assign(C,{setup(e,{expose:s}){const f=o(null),C=r({isShowDialog:!1,roleId:"",title:"权限管理",menuData:[],menuProps:{children:"children",label:"label"},defaultCheckedKeys:[],fatherData:[]}),I=()=>{C.defaultCheckedKeys=[],C.isShowDialog=!1},v=()=>{I()},D=o(!1),w=()=>{D.value=!0;const e=f.value.getCheckedKeys(),a={roleId:C.roleId,menuIds:e.join(",")};d(a).then((e=>{200==e.code?(t.success("权限设置成功"),I()):t.error(e.msg)}))["catch"]((e=>{t.error(e.msg)}))["finally"]((()=>{D.value=!1}))};let b=[];const x=e=>(e.map((e=>{let a=[];e.children&&"0"==e.type&&(e.children.map((e=>{"0"==e.type&&a.push(e.id)})),b.push({parentId:e.id,child:a,label:e.label,type:e.type}),x(e.children))})),b),_=(e,a)=>{S.value?K(e,C.fatherData):j(e)},K=(e,a)=>{0==e.type&&e.children&&e.children.forEach((e=>{0==e.type&&(f.value.setChecked(e.id,!0),K(e,a))})),-1!=e.parentId&&(f.value.setChecked(e.parentId,!0),a.map((t=>{t.child.length>0&&t.child.includes(e.parentId)&&(f.value.setChecked(t.parentId,!0),K(t,a))})))},j=e=>{if(0==e.type&&e.children&&e.children.forEach((e=>{f.value.setChecked(e.id,!1),e.children&&j(e)})),0==e.type){((e,a)=>{const t=f.value.getCheckedKeys(),l=e.find((e=>e.parentId==a)),d=l?l.child:[];for(let s=0;s<d.length;s++)if(t.includes(d[s]))return!1;return!0})(C.fatherData,e.parentId)&&f.value.setChecked(e.parentId,!1),C.fatherData.map((a=>{a.child.length>0&&a.child.includes(e.parentId)&&j(a)}))}},S=o(!1),E=(e,a)=>{S.value=a},P=async e=>{const d=await a();200==d.code?C.menuData=d.data:t.warning(d.msg);const s=await l(e);200==s.code?C.defaultCheckedKeys=s.data||[]:t.warning(s.msg)};return s({openDialog:async e=>{C.defaultCheckedKeys=[],C.roleId=e.roleId,await P(e.roleId),C.isShowDialog=!0,C.fatherData=x(C.menuData)}}),(e,a)=>{const t=h("el-tree"),l=h("el-col"),d=h("el-row"),s=h("el-button"),o=h("el-dialog");return u(),n("div",m,[c(o,{title:C.title,modelValue:C.isShowDialog,"onUpdate:modelValue":a[0]||(a[0]=e=>C.isShowDialog=e),"destroy-on-close":"",width:"769px",onClose:v},{footer:i((()=>[p("span",y,[c(s,{onClick:v,size:"default"},{"default":i((()=>[g])),_:1}),c(s,{type:"primary",onClick:w,loading:D.value,size:"default"},{"default":i((()=>[k])),_:1},8,["loading"])])])),"default":i((()=>[c(d,{gutter:35,style:{"max-height":"500px"}},{"default":i((()=>[c(l,{xs:24,sm:24,md:24,lg:24,xl:24,"class":"mb20"},{"default":i((()=>[c(t,{ref_key:"ruleForm",ref:f,data:C.menuData,props:C.menuProps,"default-checked-keys":C.defaultCheckedKeys,"node-key":"id","show-checkbox":"","class":"menu-data-tree","check-strictly":"",onCheck:_,onCheckChange:E},null,8,["data","props","default-checked-keys"])])),_:1})])),_:1})])),_:1},8,["title","modelValue"])])}}}),[["__scopeId","data-v-21fd26b3"]]);export{I as default};