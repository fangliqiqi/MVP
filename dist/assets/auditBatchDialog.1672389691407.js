import{B as e}from"./index.16723896914077.js";import{c as a}from"./order.1672389691407.js";import{g as l,E as r}from"./index.1672389691407.js";import{a3 as t}from"./header.1672389691407.js";import{d as o,f as u,$ as s,k as d,j as i,c as m,W as n,P as p,u as c,a3 as f,o as g,a as k,O as h,F,a5 as b,U as S,V as _,T as y}from"./vue.1672389691407.js";import"./xlsx.1672389691407.js";import"./excel.1672389691407.js";import"./index.16723896914073.js";const v=S("通过"),x=S("退回"),V={"class":"dialog-footer"},w=S("取 消"),j=S("确 定"),D=k("div",null,[
k("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批量审核失败！"),
k("span",null,[
S("存在审核失败的派单信息！"),
k("br"),
S("已为您下载反馈结果！")])],-1),R=o({name:"bathAuditDialog"}),O=Object.assign(R,{emits:["ok"],setup(o,{expose:R,emit:O}){const C=u(null),q=u(null),U=s({isShowDialog:!1,ruleForm:{auditStatus:"1",auditRemark:null},data:null,refuseOptions:{},loading:!1,dictKeys:["dispatch-audit-add-reason"],DICTS:{}}),z=()=>{U.ruleForm.auditRemark=null,setTimeout((()=>{C.value&&C.value.clearValidate()}),100)};d((()=>"1"==U.ruleForm.auditStatus));const E=d((()=>"1"==U.ruleForm.auditStatus?{auditStatus:[{required:!0,message:"请选择审核状态"}]}:"2"==U.ruleForm.auditStatus?"999"==U.ruleForm.remark?{auditStatus:[{required:!0,message:"请选择审核状态"}],remark:[{required:!0,message:"请选择退回原因"}],auditRemark:[{required:!0,message:"请输入审核意见"}]}:{auditStatus:[{required:!0,message:"请选择审核状态"}],remark:[{required:!0,message:"请选择退回原因"}]}:void 0)),K=(e,a)=>(consloe.log("get prop:",e,",and errorData:",a),a.map(((e,a)=>({line:e.lineNum||a,isError:"red"==e.color?"是":"否",error:e.message}))));i((()=>{T()}));const T=async()=>{if(U.dictKeys&&U.dictKeys.length){const e=await l(U.dictKeys);e&&(U.DICTS=e,U.refuseOptions=e["dispatch-audit-add-reason"])}},N=()=>{C.value&&C.value.validate((e=>{if(e){U.loading=!0;const e=U.data.map((e=>e.id));let l=U.ruleForm.auditRemark?U.ruleForm.remark+"-"+U.ruleForm.auditRemark:U.ruleForm.remark,t=Object.assign({},U.ruleForm);t.auditRemark=1==U.ruleForm.auditStatus?U.ruleForm.auditRemark:l,1==U.ruleForm.auditStatus&&delete t.remark,a(t,e).then((e=>{!e||200!=e.code||e.data&&0!==e.data.length?e.data?q.value&&q.value.openErrorDialog(e.data):r.error(e.msg||"批量审核失败"):(r.success("批量审核成功"),O("ok"),A())}),(e=>{r.error(e&&e.msg||"批量审核失败")}))["finally"]((e=>{U.loading=!1}))}}))},A=()=>{C.value&&C.value.clearValidate(),U.isShowDialog=!1,U.loading=!1,U.ruleForm={}};return R({openDialog:async e=>{U.data=e,U.ruleForm={auditStatus:"1"},U.refuseOptions&&0!==Object.keys(U.refuseOptions).length||T(),U.isShowDialog=!0}}),(a,l)=>{const r=f("el-radio"),o=f("el-radio-group"),u=f("el-form-item"),s=f("el-col"),d=f("el-option"),i=f("el-select"),R=f("el-input"),O=f("el-row"),T=f("el-form"),H=f("el-button"),I=f("el-dialog");return g(),m("div",null,[n(I,{title:"审核确认",modelValue:U.isShowDialog,"onUpdate:modelValue":l[3]||(l[3]=e=>U.isShowDialog=e),width:"576px",onClose:A,"close-on-click-modal":!1},{footer:p((()=>[k("span",V,[n(H,{onClick:A,size:"default"},{"default":p((()=>[w])),_:1}),n(H,{type:"primary",onClick:N,size:"default",loading:U.loading},{"default":p((()=>[j])),_:1},8,["loading"])])])),"default":p((()=>[n(T,{ref_key:"formRef",ref:C,model:U.ruleForm,rules:c(E),size:"default","label-width":"90px","validate-on-rule-change":!1},{"default":p((()=>[n(O,null,{"default":p((()=>[n(s,{"class":"mb20"},{"default":p((()=>[n(u,{label:"审核状态",prop:"auditStatus"},{"default":p((()=>[n(o,{modelValue:U.ruleForm.auditStatus,"onUpdate:modelValue":l[0]||(l[0]=e=>U.ruleForm.auditStatus=e),onChange:z},{"default":p((()=>[n(r,{label:"1"},{"default":p((()=>[v])),_:1}),n(r,{label:"2"},{"default":p((()=>[x])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),"2"==U.ruleForm.auditStatus?(g(),h(s,{key:0,"class":"mb20"},{"default":p((()=>[n(u,{label:"退回原因",prop:"remark"},{"default":p((()=>[n(i,{modelValue:U.ruleForm.remark,"onUpdate:modelValue":l[1]||(l[1]=e=>U.ruleForm.remark=e),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:""},{"default":p((()=>[(g(!0),m(F,null,b(U.refuseOptions,((e,a)=>(g(),h(d,{label:e,key:a,value:e},{"default":p((()=>[S(_(e),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})):y("",!0),n(s,{"class":"mb20"},{"default":p((()=>[n(u,{label:"审核意见",prop:"auditRemark"},{"default":p((()=>[n(R,{modelValue:U.ruleForm.auditRemark,"onUpdate:modelValue":l[2]||(l[2]=e=>U.ruleForm.auditRemark=e),placeholder:"请输入",rows:3,type:"textarea",clearable:"",maxLength:150,"show-word-limit":""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),n(e,{title:"批量审核",ref_key:"bathAuditRef",ref:q,type:1,errName:"派单批量审核",batchName:"staff-batch-audit",errorHeader:c(t),errorData:K,customErrorContent:"",download:""},{error:p((()=>[D])),_:1},8,["errorHeader"])])}}});export{O as default};