import{i as e,d as a,a as t}from"./policy.1672389691407.js";import{P as n}from"./ProTable.1672389691407.js";import{P as o}from"./index.16723896914072.js";import i from"./InsureCompanySelect.1672389691407.js";import{aV as l}from"./header.1672389691407.js";import{_ as s,f as r,U as c,a as d,h as m}from"./index.1672389691407.js";import{e as p}from"./excel.1672389691407.js";import u from"./PolicyDetailDialog.1672389691407.js";import y from"./PolicyEditDialog.1672389691407.js";import{i as f,f as h,$ as g,a2 as b,c as x,W as T,P as C,u as P,a3 as D,o as j,U as I,V as R,T as v}from"./vue.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";import"./company.1672389691407.js";const S={"class":"archives-online-container"},k={key:0,style:{color:"red"}};var Y=s({name:"保单维护",components:{ProTable:n,ProButtons:o,ArrowDown:r,CompanySelect:i,PolicyEditDialog:y,PolicyDetailDialog:u},setup(){var n;const o=null==(n=f())?void 0:n.appContext.config.globalProperties.$message,i=h(null),s=h(null),r=h(null),u=()=>{i.value&&i.value.doSearch()},y=g({searchConfig:{labelWidth:110,option:{extBtn:"extBtns"}},columns:[{dataIndex:"policyNo",title:"保单号",minWidth:140},{dataIndex:"createTime",title:"保单起止日期",hideInSearch:!0,minWidth:200,valueType:"custom",scopedSlots:{customRender:"BeginEndTime"}},{dataIndex:"createTime",title:"保单起止日期",hideInTable:!0,searchIndex:"startEndTime",startTime:"policyStart",endTime:"policyEnd",format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",valueType:"dateTimeRange"},{dataIndex:"insuranceCompanyName",title:"保险公司",hideInTable:!0,valueType:"custom",scopedSlots:{customRender:"CompanySelect"}},{dataIndex:"insuranceCompanyName",title:"保险公司",hideInSearch:!0,minWidth:120},{dataIndex:"insuranceTypeName",title:"险种",minWidth:120},{dataIndex:"enableFlag",title:"是否启用",minWidth:100,valueEnum:{0:"启用",1:"禁用"}},{dataIndex:"option",title:"操作",key:"option",width:170,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"导出",onClick:()=>{y.btn.find((e=>"导出"==e.label)).loading=!0;let e=Object.assign(i.value.getParams(),y.params);delete e.size,delete e.current,t(e).then((e=>{if(e&&200===e.code){const a=e.data.map((e=>({...e,enableFlag:{0:"启用",1:"禁用"}[e.enableFlag]})));p(l,a,`保单信息批量导出${m().format("YYYYMMDDHHmmss")}`)}else o.error(e.msg||"操作失败")}))["finally"]((()=>{y.btn.find((e=>"导出"==e.label)).loading=!1}))},permission:["insurancePolicy_list"],type:"default",icon:"icon-ic_edit_upload"}],cellBtns:[{text:"查看",prop:"detail",permission:["insurancePolicy_getById"]},{text:"编辑",prop:"edit",permission:["insurancePolicy_update"]},{text:"删除",prop:"delete",permission:["insurancePolicy_delete"]}],params:{insuranceCompanyName:""}});return{...b(y),editPolicyRef:s,detailPolicyRef:r,request:async a=>{try{const t=Object.assign({},a,y.params),n=await e(t);if(n&&200==n.code&&n.data)return{current:n.data.current,total:n.data.total,data:n.data.records}}catch(t){}return{current:1,total:0,data:[]}},onCellClick:async(e,t)=>{var n,i;switch(e){case"detail":null==(n=P(r))||n.openDialog(t);break;case"edit":null==(i=P(s))||i.openDialog(t);break;case"delete":const e='<p style="font-size:16px;font-weight:600">是否确定删除?<br/>\n\t\t\t\t<span style="color:red;font-size:14px;font-weight:400">删除后，保单将从系统消失，请谨慎操作！</span></p>';d.confirm(e,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((async()=>{try{const e=await a(t.id);200===e.code?o.success("删除成功"):o.error(e.msg||"删除失败")}catch(e){o.error("删除失败")}finally{u()}}))["catch"]((()=>{}))}},proTableRef:i,refreshList:u,onReset:()=>{y.params={}},formatRangeDateAndDiff:c}}},[["render",function(e,a,t,n,o,i){const l=D("company-select"),s=D("pro-buttons"),r=D("pro-table"),c=D("policy-edit-dialog"),d=D("policy-detail-dialog");return j(),x("div",S,[T(r,{ref:"proTableRef","row-key":"id",columns:e.columns,request:n.request,btn:e.btn,searchConfig:e.searchConfig,onOnReset:n.onReset},{BeginEndTime:C((e=>[I(R(n.formatRangeDateAndDiff(e.policyStart,e.policyEnd))+" ",1),e.buyMonth?(j(),x("span",k,R(`${e.buyMonth}个月`),1)):v("",!0)])),CompanySelect:C((()=>[T(l,{modelValue:e.params.insuranceCompanyName,"onUpdate:modelValue":a[0]||(a[0]=a=>e.params.insuranceCompanyName=a),style:{width:"100%"}},null,8,["modelValue"])])),option:C((a=>[T(s,{array:e.cellBtns,model:a,onOnClick:n.onCellClick},null,8,["array","model","onOnClick"])])),_:1},8,["columns","request","btn","searchConfig","onOnReset"]),T(c,{ref:"editPolicyRef",onOk:n.refreshList},null,8,["onOk"]),T(d,{ref:"detailPolicyRef"},null,512)])}]]);export{Y as default};