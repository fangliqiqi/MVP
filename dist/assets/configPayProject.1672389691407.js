import{_ as e,h as l,E as a,a as t}from"./index.1672389691407.js";import{h as s,i as r,s as o}from"./paysearch.1672389691407.js";import{d}from"./vuedraggable.umd.1672389691407.js";import{d as i,f as u,$ as n,k as m,j as c,c as p,W as f,P as y,a3 as g,o as h,a as _,F,a5 as L,O as b,U as S,V as v,u as I,T as V,ay as k,az as Z}from"./vue.1672389691407.js";const w=e=>(k("data-v-72be3bc2"),e=e(),Z(),e),x={"class":"system-add-dic-container"},D={"class":"draggable_bot"},z=S("不显示空值或为0项"),C=w((()=>_("span",null,"可拖动调整显示顺序",-1))),j={"class":"dialog-footer"},M=S("取 消"),U=S("预 览"),N=S("确 定"),Y=S("0000.00"),E=S("实发工资"),P=S("明细"),O=i({name:"configPagProject"});var T=e(Object.assign(O,{emits:["ok"],setup(e,{expose:i,emit:k}){const Z=u(null);u(null);const w=n({isShowDialog:!1,id:null,title:"工资条配置",ruleForm:{id:null,salaryId:null,deptId:null,detailList:[],isZero:null},oldisZero:null,salaryItem:[],salarySet:[],drag:!1,preDialog:!1,salaryMonth:null}),O=e=>(e.sort((function(e,l){return e.localeCompare(l,"zh-CN")})),e),T=()=>{const e=[];return w.ruleForm.detailList.map(((l,a)=>{const t=w.salarySet.find((e=>e.cnName==l));t?e.push({...t,orderLine:a}):e.push({cnName:l,orderLine:a})})),e},H=()=>{Z.value.resetFields(),w.ruleForm={id:null,salaryId:null,deptId:null,detailList:[],isZero:null},w.salarySet=[],w.isShowDialog=!1},R=()=>{H()},W=()=>{w.preDialog=!0},$=m((()=>w.ruleForm.detailList.length>0?w.ruleForm.detailList:w.salaryItem)),q=u(!1),A=()=>{Z.value.validate((e=>{if(e)if(q.value=!0,0!=w.ruleForm.detailList.length||w.ruleForm.isZero){const e={id:w.ruleForm.id,salaryId:w.ruleForm.salaryId,deptId:w.ruleForm.deptId,detailList:T(),isZero:w.ruleForm.isZero?"1":"0"};o(e).then((e=>{e&&200==e.code?(a.success(e.msg||"配置成功"),k("ok"),H()):a.error(e.msg||"配置失败")}),(()=>{a.error("配置失败")}))["catch"]()["finally"]((()=>{q.value=!1}))}else if(w.salarySet.length>0||w.oldisZero){const e='<p style="font-size:16px;font-weight:600">是否清空配置?<br/>\n\t\t\t\t\t<span style="color:red;font-size:14px;font-weight:400">清空后,新建项目配置将默认获取本项目的上一个配置！</span></p>';t.confirm(e,{type:"warning",dangerouslyUseHTMLString:!0}).then((async()=>{let e=await r(w.ruleForm.id);200==e.code?(a.success("配置成功"),H()):(a.error(e.msg||"配置失败"),H()),q.value=!1}))["catch"]((e=>{q.value=!1}))}else q.value=!1,a.success("配置成功"),H()}))};return c((()=>{})),i({openDialog:async e=>{if(e&&e.id)try{const t=await s(e.id);if(200==t.code)if(w.salaryMonth=l(e.salaryMonth).format("YYYY年MM月"),w.isShowDialog=!0,w.salaryItem=O(t.data.salaryItem),w.ruleForm.salaryId=e.id,w.ruleForm.deptId=e.deptId,w.ruleForm.isZero=!1,w.oldisZero=!1,t.data.salarySet){w.salarySet=t.data.salarySet.detailList||[],w.ruleForm.id=t.data.salarySet.id,w.ruleForm.isZero="1"==t.data.salarySet.isZero,w.oldisZero="1"==t.data.salarySet.isZero;const e=t.data.salarySet.detailList.sort(((e,l)=>e.orderLine-l.orderLine)),l=[];e.forEach((e=>{w.salaryItem.find((l=>l===e.cnName))&&l.push(e.cnName)})),w.ruleForm.detailList=l}else w.ruleForm.detailList=[];else a.error(t.msg||"获取工资条配置失败")}catch(t){a.error(t.msg||"获取工资条配置失败")}}}),(e,l)=>{const a=g("el-checkbox"),t=g("el-checkbox-group"),s=g("el-form-item"),r=g("el-col"),o=g("el-divider"),i=g("el-tag"),u=g("el-row"),n=g("el-form"),m=g("el-button"),c=g("el-dialog");return h(),p("div",x,[f(c,{title:w.title,modelValue:w.isShowDialog,"onUpdate:modelValue":l[5]||(l[5]=e=>w.isShowDialog=e),"close-on-click-modal":!1,width:"816px",onClose:H},{footer:y((()=>[_("span",j,[f(m,{onClick:R,size:"default"},{"default":y((()=>[M])),_:1}),f(m,{type:"primary",onClick:W,size:"default"},{"default":y((()=>[U])),_:1}),f(m,{type:"primary",loading:q.value,onClick:A,size:"default"},{"default":y((()=>[N])),_:1},8,["loading"])])])),"default":y((()=>[f(n,{ref_key:"formRef",ref:Z,model:w.ruleForm,size:"default","label-width":"110px"},{"default":y((()=>[f(u,null,{"default":y((()=>[f(r,{span:24},{"default":y((()=>[f(s,{label:"可见项选择"},{"default":y((()=>[f(t,{"class":"checkgroup",modelValue:w.ruleForm.detailList,"onUpdate:modelValue":l[0]||(l[0]=e=>w.ruleForm.detailList=e)},{"default":y((()=>[(h(!0),p(F,null,L(w.salaryItem,(e=>(h(),b(a,{key:e,label:e},{"default":y((()=>[S(v(e),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),f(o),f(r,{span:24},{"default":y((()=>[f(s,{label:"已选可见项"},{"default":y((()=>[f(I(d),{"class":"draggable",modelValue:w.ruleForm.detailList,"onUpdate:modelValue":l[1]||(l[1]=e=>w.ruleForm.detailList=e),group:"people",onStart:l[2]||(l[2]=e=>w.drag=!0),onEnd:l[3]||(l[3]=e=>w.drag=!1),"item-key":"id","chosen-class":"chosen"},{item:y((({element:e})=>[f(i,{"class":"eltag",type:"info",closable:"",onClose:l=>{return a=e,void(w.ruleForm.detailList=w.ruleForm.detailList.filter((e=>String(e)!=String(a))));var a}},{"default":y((()=>[S(v(e),1)])),_:2},1032,["onClose"])])),_:1},8,["modelValue"]),_("div",D,[f(a,{label:"1",modelValue:w.ruleForm.isZero,"onUpdate:modelValue":l[4]||(l[4]=e=>w.ruleForm.isZero=e)},{"default":y((()=>[z])),_:1},8,["modelValue"]),C])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["title","modelValue"]),f(c,{title:"工资明细",modelValue:w.preDialog,"onUpdate:modelValue":l[6]||(l[6]=e=>w.preDialog=e),width:"576px"},{"default":y((()=>[f(u,{"class":"pre_month"},{"default":y((()=>[S(v(w.salaryMonth),1)])),_:1}),f(o),f(u,{style:{"text-align":"center"}},{"default":y((()=>[f(r,{span:24,"class":"pre_momeny"},{"default":y((()=>[Y])),_:1}),f(r,{span:24,"class":"pre_text"},{"default":y((()=>[E])),_:1}),f(o),I($).length>0?(h(),b(r,{key:0,span:24,"class":"pre_detail"},{"default":y((()=>[P])),_:1})):V("",!0)])),_:1}),f(u,null,{"default":y((()=>[(h(!0),p(F,null,L(I($),((e,l)=>(h(),b(r,{span:24,key:l,"class":"pre_list"},{"default":y((()=>[_("h4",null,v(e),1),f(o)])),_:2},1024)))),128))])),_:1})])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-72be3bc2"]]);export{T as default};