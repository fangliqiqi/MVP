import{d as e,f as t,E as a,j as n,$ as i,c as s,W as l,P as r,aD as o,aA as d,a3 as c,o as p,O as m,i as u}from"./vue.1672389691407.js";import{P as h}from"./ProTable.1672389691407.js";import{e as f,f as y}from"./contract.1672389691407.js";import I from"./contractCheckDilog.1672389691407.js";import{P as x}from"./index.16723896914072.js";import{g,l as _}from"./city.1672389691407.js";import{g as b,E as v}from"./index.1672389691407.js";import{o as C,a as j}from"./events.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./showDeletes.1672389691407.js";const k={"class":"contract-apply-container"},W=e({name:"合同审核"}),S=Object.assign(W,{setup(e){const W=o(),S=d(),{proxy:w}=u(),T=t(null),D=t(null),P=()=>{T.value&&T.value.refresh()},E=()=>{V.params={}};a((()=>{C(w)})),n((()=>{j(w,S.path,(()=>{P()})),N();const e=g();V.areaJson=e}));const N=async()=>{try{const e=await b(V.dictKeys);e&&(V.DICTS=e,V.columns=V.columns.map((t=>{const a={...t};switch(t.dataIndex){case"empNatrue":a.valueEnum=e.emp_natrue;break;case"contractType":a.valueEnum=e.employee_contract_type;break;case"contractStatus":a.valueEnum=e.personnel_state;break;case"situation":a.valueEnum=O(e.situation_type);break;case"contractName":a.valueEnum=O(e.personnel_type);break;case"type":a.valueEnum=e.check_type}return a})))}catch(e){}},O=e=>{const t=Object.values(e),a={};return t.forEach((e=>a[e]=e)),a},Y=(e,t)=>{const a=e.level,n=e.isLeaf;if(0!==a)return t(n?[]:_(e.data.id));t(_(0));return t([])},L=async(e,t)=>{"audit"===e&&W.push({name:"contract-audit",params:{id:t.id}})},A=(e,t)=>{const a=[e.id];t.parent&&0!=t.parent.level&&(a.unshift(t.parent.data.id),t.parent.parent&&0!=t.parent.parent.level&&a.unshift(t.parent.parent.data.id));let n=null,i=null,s=null;n=a[0]||null,a.length>1&&(i=a[1]||null),a.length>2&&(s=a[2]||null),V.params.fileProvince=n,V.params.fileCity=i,V.params.fileTown=s},R=()=>{V.params.fileProvince=null,V.params.fileCity=null,V.params.fileTown=null},M=e=>{V.selectionChangeList=e},J=t(!1),V=i({areaJson:null,searchConfig:{labelWidth:110},selectionChangeList:[],params:{},dictKeys:["emp_natrue","employee_contract_type","situation_type","personnel_type","check_type"],DICTS:{},areaProps:{label:"areaName"},cellBtns:[{text:"审核",prop:"audit",permission:["temployeecontractinfo_audit"]}],btn:[{label:"批量导出",permission:["employee_export_contract_audit"],onClick:async()=>{if(J.value=!0,V.selectionChangeList.length>0){const e=[];V.selectionChangeList.map((t=>{e.push(t.id)})),V.params={ids:e.join(",")}}else V.params=T.value.getParams(),delete V.params.size,delete V.params.current;const{menuInfo:e,...t}=V.params,a=Object.assign({},{mId:e});y(a,Object.assign({},t,{menuInfo:e})).then((e=>{200==e.code?v.success("导出成功"):v.error(e.msg||"导出失败")}))["catch"]((e=>{v.error(e.msg||"导出失败")}))["finally"]((()=>{J.value=!1}))},icon:"icon-ic_edit_export",loading:J},{label:"批量审核",permission:["temployeecontractinfo_audit"],onClick:async()=>{if(0==V.selectionChangeList.length)return v.error("请选择待审核的合同！");D.value&&D.value.openDialog(V.selectionChangeList)},icon:"icon-ic_edit_add"}],columns:[{dataIndex:"type",title:"审核类型",hideInSearch:!1,minWidth:200,tooltip:!0},{dataIndex:"applyNo",title:"申请编号",hideInSearch:!0,minWidth:200,tooltip:!0},{dataIndex:"empName",title:"员工姓名",minWidth:160,ellipsis:!0},{dataIndex:"empIdcard",title:"身份证号",minWidth:180},{dataIndex:"fileaddress",title:"档案所在地",tooltip:!0,minWidth:180,valueType:"addRess",params:{pro:"fileProvince",city:"fileCity",town:"fileTown"}},{dataIndex:"empNatrue",title:"员工类型",minWidth:160,ellipsis:!0},{dataIndex:"contractName",title:"合同类型",minWidth:180,ellipsis:!0},{dataIndex:"situation",title:"签订类型",minWidth:160,ellipsis:!0},{dataIndex:"subjectDepart",title:"项目名称",minWidth:160,tooltip:!0},{dataIndex:"deptNo",title:"项目编码",minWidth:160,tooltip:!0},{dataIndex:"subjectUnit",title:"客户名称",minWidth:180,tooltip:!0},{dataIndex:"contractParty",title:"合同甲方",minWidth:160,ellipsis:!0},{dataIndex:"contractStart",title:"合同起始日期",hideInSearch:!0,minWidth:160,ellipsis:!0,dateFormat:"YYYY-MM-DD"},{dataIndex:"contractEnd",title:"合同截止日期",hideInSearch:!0,minWidth:160,ellipsis:!0,dateFormat:"YYYY-MM-DD"},{dataIndex:"contractType",title:"签订期限",minWidth:160,ellipsis:!0},{dataIndex:"createName",title:"创建人",hideInSearch:!1,minWidth:160,ellipsis:!0},{dataIndex:"createTime",title:"创建时间",hideInSearch:!0,minWidth:160,ellipsis:!0},{dataIndex:"applyNo",title:"申请编码",hideInTable:!0,minWidth:160,ellipsis:!0},{dataIndex:"option",title:"操作",key:"option",width:100,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}]}),z=async e=>{try{const t=Object.assign({},e);delete t.fileAddress;const a=await f(t);if(a&&200==a.code&&a.data)return{current:a.data.current,total:a.data.total,data:a.data.records}}catch(t){}return{current:1,total:0,data:[]}};return(e,t)=>{const a=c("el-tree-select");return p(),s("div",k,[l(h,{ref_key:"proTableRef",ref:T,"row-key":"id",columns:V.columns,request:z,onOnReset:E,searchConfig:V.searchConfig,btn:V.btn,multi:!0,onSelectionChange:M},{option:r((e=>[l(x,{array:V.cellBtns,model:e,onOnClick:L},null,8,["array","model"])])),fileAddress:r((e=>[(p(),m(a,{modelValue:V.params.fileAddress,"onUpdate:modelValue":t[0]||(t[0]=e=>V.params.fileAddress=e),data:V.areaJson,key:"arch_search_props_"+e.dateIndex,style:{width:"100%"},placeholder:"请选择",props:V.areaProps,onCurrentChange:A,onClear:R,"node-key":"id",load:Y,"check-strictly":"",lazy:"",clearable:"",download:""},null,8,["modelValue","data","props"]))])),_:1},8,["columns","searchConfig","btn"]),l(I,{ref_key:"contractCheckRef",ref:D,onOk:P},null,512)])}}});export{S as default};