import{P as e}from"./ProTable.1672389691407.js";import{P as a}from"./index.16723896914072.js";import{B as t}from"./index.16723896914077.js";import{E as r,ag as s}from"./header.1672389691407.js";import{_ as i,g as o,f as n,a as l,E as d}from"./index.1672389691407.js";import{d as c,f as m,$ as p,a2 as u,j as h,E as f,c as y,W as x,P as b,u as _,aD as g,aA as v,a3 as I,o as j,a as w,U as k,ay as W,az as F,i as S}from"./vue.1672389691407.js";import{o as C,a as D}from"./events.1672389691407.js";import{payParams as P,batchRules as E,moneyParams as T,pay_header as Y,batchErrorData as N,batchUploadFile as R,importType as B,cardCheck as H,beforeFlag as O,changeFile as M,batchUploadyYearMoney as z,momeyRules as G,changePayParams as A}from"./payimport.1672389691407.js";import K from"./submitPay.1672389691407.js";import{c as q,d as U,e as $,f as J}from"./payimport.16723896914072.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";import"./xlsx.1672389691407.js";import"./excel.1672389691407.js";import"./presendorder.1672389691407.js";import"./file.1672389691407.js";import"./index.16723896914078.js";const L=e=>(W("data-v-1b3340d0"),e=e(),F(),e),Q={"class":"system-dict-container"},V={"class":"el-dropdown-link"},X=k(" 模板下载 "),Z=L((()=>w("a",{href:"/template/payservice/薪资上传模板.xls",download:""},"薪资模板",-1))),ee=L((()=>w("a",{href:"/template/payservice/劳务费上传模板.xls",download:""},"劳务费模板",-1))),ae=L((()=>w("a",{href:"/template/payservice/稿酬上传模板.xls",download:""},"稿酬模板",-1))),te=L((()=>w("a",{href:"/template/payservice/年终奖测算导入模板.xls",download:""},"年终奖测算模板",-1))),re=c({name:"薪酬导入申请"});var se=i(Object.assign(re,{setup(i){const c=m(null),k=m(null),W=m(null),F=m(null),L=g(),re=v(),{proxy:se}=S(),ie=(e,a)=>!a.includes(e.status),oe=(e,a)=>!a.includes(e.status),ne=p({batchExtParams:[...P],batchRules:{...E},moneyParams:[...T],searchConfig:{labelWidth:110,option:{extBtn:"extBtns"}},columns:[{dataIndex:"status",title:"薪酬状态",hideInSearch:!0,minWidth:160},{dataIndex:"deptName",title:"项目名称",minWidth:200,tooltip:!0},{dataIndex:"deptNo",title:"项目编码",minWidth:160},{dataIndex:"applyNo",title:"申请编码",minWidth:160},{dataIndex:"status",title:"薪酬状态",hideInTable:!0,minWidth:160},{dataIndex:"settlementAmount",title:"项目金额",minWidth:160,hideInSearch:!0},{dataIndex:"invoiceTitle",title:"封面抬头",hideInSearch:!0,minWidth:200,tooltip:!0},{dataIndex:"salaryMonth",title:"薪酬月份",minWidth:160,valueType:"date",selectType:"month",valueFormat:"YYYYMM",format:"YYYYMM"},{dataIndex:"formType",title:"表单类型",minWidth:160,hideInSearch:!0},{dataIndex:"createTime",title:"创建时间",minWidth:180,hideInSearch:!0},{dataIndex:"createName",title:"创建人",minWidth:180,hideInSearch:!0},{dataIndex:"option",title:"操作",key:"option",minWidth:280,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"导入表单",onClick:()=>{A(0),k.value&&k.value.openDialog()},permission:[],icon:"icon-ic_edit_add"},{label:"年终奖计税测算",permission:["salary_tstatisticsbonus-batch-import"],onClick:()=>{W.value&&W.value.openDialog()},type:"normal",icon:"icon-ic_edit_upload"}],cellBtns:[{text:"详情",prop:"detail",permission:[]},{text:"提交",prop:"submit",permission:[],isGray:e=>ie(e,[0,6,5])},{text:"删除",prop:"delete",permission:["salary_tsalarystandard_del"],isGray:e=>ie(e,[0,6,5])},{text:"发送数字化平台",prop:"send",permission:[],isHide:e=>oe(e,[0,1,2,3,4,5,6,7,8,9,10]),isGray:e=>ie(e,[2,10])},{text:"推送收入",prop:"push",permission:["salary_tsalarystandard_push"],isHide:e=>oe(e,[11,12])}],selectOptions:[],params:{},dictKeys:["form_type","salary_status"],isSendFinishFlag:!0}),{columns:le,cellBtns:de,btn:ce,searchConfig:me}=u(ne),pe=async e=>{try{const a=await q(e);if(a&&200==a.code&&a.data)return{current:a.data.current,total:a.data.total,data:a.data.records.map(((a,t)=>({...a,index:(e.current-1)*e.size+t+1})))}}catch(a){}return{current:1,total:0,data:[]}},ue=()=>{c.value.refresh()},he=async(e,a)=>{if("delete"===e)l.confirm("是否确定删除",{type:"warning"}).then((async()=>{const e=await U(a.id);e&&200==e.code?(d.success("删除成功"),ue()):d.error(e.msg||"删除失败")}))["catch"]((()=>{}));else if("detail"===e)L.push({name:"payservice-import-detail",params:{id:a.id}});else if("submit"==e)F.value&&F.value.openDialog(a);else if("send"==e){if(!ne.isSendFinishFlag)return;ne.isSendFinishFlag=!1,$(a.id).then((e=>{200==e.code?(d.success("发送成功"),ue()):d.error(e.msg||"发送失败")}))["catch"]((e=>{d.error("发送失败")}))["finally"]((()=>{ne.isSendFinishFlag=!0}))}else"push"==e&&J(a.id).then((e=>{200==e.code?(d.success("生成收入并推送中，请耐心等待"),ue()):"1"==e.code?d.error(e.msg||"数据处理中，请勿重复点击！"):d.error(e.msg||"推送失败")}))["catch"]((e=>{d.error("推送失败")}))};return h((()=>{(async()=>{try{const e=await o(ne.dictKeys);e&&ne.columns.map((a=>{switch(a.dataIndex){case"status":a.valueEnum=e.salary_status;break;case"formType":a.valueEnum=e.form_type}return a}))}catch(e){}})(),D(se,re.path,(()=>{ue()}))})),f((()=>{C(se)})),(i,o)=>{const l=I("el-icon"),d=I("el-button"),m=I("el-dropdown-item"),p=I("el-dropdown-menu"),u=I("el-dropdown");return j(),y("div",Q,[x(e,{ref_key:"proTableRef",ref:c,"row-key":"id",columns:_(le),request:pe,btn:_(ce),searchConfig:_(me)},{extBtns:b((()=>[x(u,{"class":"arch-btn","popper-class":"module-download"},{dropdown:b((()=>[x(p,null,{"default":b((()=>[x(m,null,{"default":b((()=>[Z])),_:1}),x(m,null,{"default":b((()=>[ee])),_:1}),x(m,null,{"default":b((()=>[ae])),_:1}),x(m,null,{"default":b((()=>[te])),_:1})])),_:1})])),"default":b((()=>[w("span",V,[x(d,{size:"default"},{"default":b((()=>[X,x(l,{"class":"el-icon--right"},{"default":b((()=>[x(_(n))])),_:1})])),_:1})])])),_:1})])),option:b((e=>[x(a,{array:_(de),model:e,onOnClick:he},null,8,["array","model"])])),_:1},8,["columns","btn","searchConfig"]),x(t,{ref_key:"batchImportDialogRef",ref:k,width:"816px",header:_(Y),batchName:"pay-batch-import",errorHeader:_(r),errorData:_(N),upload:_(R),"ext-params":ne.batchExtParams,rules:ne.batchRules,errName:"薪酬导入表单",type:_(B),cardCheck:_(H),beforeFlag:_(O),customError:"",download:"",onChangeFile:_(M),onOk:ue},null,8,["header","errorHeader","errorData","upload","ext-params","rules","type","cardCheck","beforeFlag","onChangeFile"]),x(t,{ref_key:"moneyDialogRef",ref:W,header:_(s),batchName:"pay-batch-import",errorHeader:_(r),errorData:_(N),upload:_(z),"ext-params":ne.moneyParams,rules:_(G),title:"年终奖计税测算",type:1,customError:"",download:"",onOk:ue},null,8,["header","errorHeader","errorData","upload","ext-params","rules"]),x(K,{ref_key:"submitPayRef",ref:F,onOk:ue},null,512)])}}}),[["__scopeId","data-v-1b3340d0"]]);export{se as default};