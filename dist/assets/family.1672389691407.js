import{P as e}from"./ProTable.1672389691407.js";import{P as a}from"./index.16723896914072.js";import{B as t}from"./index.16723896914077.js";import{M as i,N as l}from"./header.1672389691407.js";import{e as r}from"./excel.1672389691407.js";import n from"./attachDetail.1672389691407.js";import o from"./addFamily.1672389691407.js";import{o as s,p as d,q as c,r as m}from"./attach.1672389691407.js";import{_ as p,M as h,N as f,E as u,f as y,h as b,a as g}from"./index.1672389691407.js";import{d as x,f as k,$ as v,a2 as I,j as _,c as j,W as w,P as S,u as N,a3 as C,o as W,a as O,U as T,ay as D,az as L}from"./vue.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";import"./xlsx.1672389691407.js";import"./file.1672389691407.js";import"./staff.1672389691407.js";const B=e=>(D("data-v-13cbecc6"),e=e(),L(),e),R={"class":"system-dict-container"},P={"class":"el-dropdown-link"},U=T(" 模板下载 "),z=B((()=>O("a",{href:"/template/员工家庭模板.xls",download:""}," 批量导入模板",-1))),M=x({name:"家庭信息"});var Y=p(Object.assign(M,{setup(p){const x=k(null),T=k(null),D=k(null),L=k(null),B=e=>{M.selectOptions=e,e.length>0?M.btn[3].disabled=!1:M.btn[3].disabled=!0},M=v({searchConfig:{labelWidth:110,option:{extBtn:"extBtns"}},columns:[{dataIndex:"empName",title:"员工姓名",minWidth:180},{dataIndex:"empIdcard",title:"身份证号",minWidth:200},{dataIndex:"familyName",title:"成员姓名",hideInSearch:!0,minWidth:160},{dataIndex:"relationshipSelf",title:"与本人关系",hideInSearch:!0,minWidth:140,formatter:e=>h(M.relationList,e.relationshipSelf)||"--"},{dataIndex:"birthday",title:"出生日期",hideInSearch:!0,minWidth:160,formatter:e=>e.birthday?e.birthday.substring(0,10):"--"},{dataIndex:"workUnit",title:"工作单位",hideInSearch:!0,minWidth:180,tooltip:!0},{dataIndex:"contractTel",title:"手机号码",hideInSearch:!0,minWidth:160},{dataIndex:"createName",title:"创建人",minWidth:160},{dataIndex:"createTime",title:"创建时间",minWidth:180,searchIndex:"createTimes",valueType:"dateTimeRange"},{dataIndex:"option",title:"操作",key:"option",minWidth:200,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"新增",onClick:()=>{D.value.openDialog("",M.relationList)},permission:["archives-family-add"],icon:"icon-ic_edit_add"},{label:"批量导入",permission:["archives-family-batch-import"],onClick:()=>{L.value&&L.value.openDialog()},type:"normal",icon:"icon-ic_edit_upload"},{label:"批量导出",permission:["archives-family-batch-export"],onClick:()=>{if(M.selectOptions.length>0){const e=[];M.selectOptions.map((a=>{e.push(a.id)})),M.params={ids:e.join(",")}}else M.params=x.value.getParams(),delete M.params.size,delete M.params.current;M.btn.find((e=>"批量导出"===e.label)).loading=!0,d(M.params).then((e=>{200==e.code?(r(l,e.data.map((e=>({empName:e.empName,empIdcard:e.empIdcard,familyName:e.familyName,relationshipSelf:h(M.relationList,e.relationshipSelf)||"",birthday:e.birthday?e.birthday.substring(0,10):"",workUnit:e.workUnit||"",contractTel:e.contractTel||""}))),`家庭信息批量导出${b().format("YYYY-MM-DD")}`),u.success("导出成功")):u.error(e.msg)}))["catch"]((e=>{u.error("导出失败")}))["finally"]((()=>{M.btn.find((e=>"批量导出"===e.label)).loading=!1}))},type:"normal",icon:"icon-ic_edit_export",loading:!1},{label:"批量删除",permission:["archives-family-batch-delete"],onClick:()=>{M.selectOptions.length>0&&g.confirm(`是否确定删除${M.selectOptions.length}条家庭信息？`,"提示",{type:"warning"}).then((()=>{const e=[];M.selectOptions.map((a=>{e.push(a.id)})),c(e).then((e=>{200==e.code&&e.data?(u.success("删除成功"),x.value.refresh()):u.error(e.msg||"删除失败")}))}))},type:"normal",icon:"icon-ic_edit_delete",disabled:!0}],cellBtns:[{text:"详情",prop:"detail",permission:["archives-family-detail"]},{text:"编辑",prop:"edit",permission:["archives-family-edit"]},{text:"删除",prop:"delete",permission:["archives-family-delete"]}],detailConf:[{label:"员工姓名",key:"empName"},{label:"身份证号",key:"empIdcard"},{label:"成员姓名",key:"familyName",tooltip:!0},{label:"与本人关系",key:"relationshipSelf"},{label:"出生日期",key:"birthday"},{label:"工作单位",key:"workUnit",tooltip:!0},{label:"手机号码",key:"contractTel"},{label:"创建人",key:"createName"},{label:"创建时间",key:"createTime"}],relationList:[],selectOptions:[],params:{}}),{columns:Y,cellBtns:$,btn:q,searchConfig:F}=I(M),A=async e=>{try{const a=await s(e);if(a&&200==a.code&&a.data)return{current:a.data.current,total:a.data.total,data:a.data.records.map(((a,t)=>({...a,index:(e.current-1)*e.size+t+1})))}}catch(a){}return{current:1,total:0,data:[]}},E=()=>{x.value.refresh()},G=async(e,a)=>{"delete"===e?g.confirm("是否确定删除？","提示",{type:"warning"}).then((async()=>{const e=await m(a.id);e&&200==e.code?(u.success("删除成功"),E()):u.error(e.msg||"删除失败")}))["catch"]((()=>{})):"edit"===e?D.value.openDialog(a,M.relationList):"detail"===e&&(a.relationshipSelf=h(M.relationList,a.relationshipSelf),a.birthday=a.birthday?a.birthday.substring(0,10):"",T.value&&T.value.openDialog(a,M.detailConf,"家庭信息详情"))};return _((()=>{f("family_relation").then((e=>{e&&200==e.code&&e.data?M.relationList=e.data:u.error(e.msg||"获取亲属关系字典失败")}))["catch"]((e=>{u.error(e.msg||"获取亲属关系字典失败")}))})),(l,r)=>{const s=C("el-icon"),d=C("el-button"),c=C("el-dropdown-item"),m=C("el-dropdown-menu"),p=C("el-dropdown");return W(),j("div",R,[w(e,{ref_key:"proTableRef",ref:x,"row-key":"id",columns:N(Y),request:A,btn:N(q),searchConfig:N(F),multi:!0,onSelectionChange:B},{extBtns:S((()=>[w(p,{"class":"arch-btn","popper-class":"module-download"},{dropdown:S((()=>[w(m,null,{"default":S((()=>[w(c,null,{"default":S((()=>[z])),_:1})])),_:1})])),"default":S((()=>[O("span",P,[w(d,{size:"default"},{"default":S((()=>[U,w(s,{"class":"el-icon--right"},{"default":S((()=>[w(N(y))])),_:1})])),_:1})])])),_:1})])),option:S((e=>[w(a,{array:N($),model:e,onOnClick:G},null,8,["array","model"])])),_:1},8,["columns","btn","searchConfig"]),w(n,{ref_key:"attachDetailRef",ref:T},null,512),w(o,{ref_key:"addFamilyRef",ref:D,onOk:E},null,512),w(t,{ref_key:"batchImportDialogRef",ref:L,header:N(i),url:"/yifu-archives/method/tempfamily/importListAdd",errName:"员工家庭信息批量导入",download:!0,onOk:E},null,8,["header"])])}}}),[["__scopeId","data-v-13cbecc6"]]);export{Y as default};