import{P as e}from"./ProTable.1672389691407.js";import{P as i}from"./index.16723896914072.js";import{B as t}from"./index.16723896914077.js";import{Q as a,R as s}from"./header.1672389691407.js";import{e as n}from"./excel.1672389691407.js";import l from"./attachDetail.1672389691407.js";import d from"./addInvalidism.1672389691407.js";import{w as r,x as o,y as m,z as c,A as p}from"./attach.1672389691407.js";import{_ as u,M as f,N as y,E as h,f as b,h as g,a as _}from"./index.1672389691407.js";import{d as I,f as x,$ as v,a2 as j,j as k,c as T,W as L,P as w,u as D,a3 as W,o as C,a as N,U as O,V as S,ay as z,az as R}from"./vue.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";import"./xlsx.1672389691407.js";import"./file.1672389691407.js";import"./staff.1672389691407.js";import"./attachUpload.1672389691407.js";const G=e=>(z("data-v-1807fe74"),e=e(),R(),e),B={"class":"system-dict-container"},P={"class":"el-dropdown-link"},Y=O(" 模板下载 "),A=G((()=>N("a",{href:"/template/员工伤残模板.xls",download:""}," 批量导入模板",-1))),M=I({name:"伤残信息"});var $=u(Object.assign(M,{setup(u){const I=x(null),z=x(null),R=x(null),G=x(null),M=e=>{$.selectOptions=e,e.length>0?$.btn[3].disabled=!1:$.btn[3].disabled=!0},$=v({searchConfig:{labelWidth:110,option:{extBtn:"extBtns"}},columns:[{dataIndex:"empName",title:"员工姓名",minWidth:180},{dataIndex:"empIdcard",title:"身份证号",minWidth:200},{dataIndex:"disabilityName",title:"伤残病名称",hideInSearch:!0,minWidth:200,tooltip:!0},{dataIndex:"occupationalDisease",title:"职业病名称",hideInSearch:!0,minWidth:200,tooltip:!0},{dataIndex:"disabilityLevel",title:"伤残等级",hideInSearch:!0,minWidth:120,formatter:e=>f($.disabilityGradeList,e.disabilityLevel)||"--"},{dataIndex:"startTime",title:"伤残开始日期",hideInSearch:!0,minWidth:160,formatter:e=>e.startTime?e.startTime.substring(0,10):""},{dataIndex:"endTime",title:"伤残结束日期",hideInSearch:!0,minWidth:160,formatter:e=>e.endTime?e.endTime.substring(0,10):""},{dataIndex:"injuryIdentification",title:"是否工伤",hideInSearch:!0,minWidth:120,scopedSlots:{customRender:"injuryIdentification"}},{dataIndex:"createName",title:"创建人",minWidth:160},{dataIndex:"createTime",title:"创建时间",minWidth:180,searchIndex:"createTimes",valueType:"dateTimeRange"},{dataIndex:"option",title:"操作",key:"option",minWidth:200,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"新增",onClick:()=>{R.value.openDialog("",$.disabilityGradeList)},permission:["archives_tempdisabilityinfo_add"],icon:"icon-ic_edit_add"},{label:"批量导入",permission:["archives_tempdisabilityinfo_importListAdd"],onClick:()=>{G.value&&G.value.openDialog()},type:"normal",icon:"icon-ic_edit_upload"},{label:"批量导出",permission:["archives_tempdisabilityinfo_exportList"],onClick:()=>{if($.selectOptions.length>0){const e=[];$.selectOptions.map((i=>{e.push(i.id)})),$.params={ids:e.join(",")}}else $.params=I.value.getParams(),delete $.params.size,delete $.params.current;$.btn.find((e=>"批量导出"==e.label)).loading=!0,o($.params).then((e=>{200==e.code?(n(s,e.data.map((e=>({empName:e.empName,empIdcard:e.empIdcard,disabilityName:e.disabilityName||"",occupationalDisease:e.occupationalDisease||"",disabilityLevel:f($.disabilityGradeList,e.disabilityLevel)||"",startTime:e.startTime?e.startTime.substring(0,10):"",endTime:e.endTime?e.endTime.substring(0,10):"",injuryIdentification:1==e.injuryIdentification?"否":"是",remark:e.remark||""}))),`伤残信息批量导出${g().format("YYYYMMDD")}`),h.success("导出成功")):h.error(e.msg)}))["catch"]((e=>{h.error("导出失败")}))["finally"]((()=>{$.btn.find((e=>"批量导出"==e.label)).loading=!1}))},type:"normal",icon:"icon-ic_edit_export"},{label:"批量删除",permission:["archives_tempdisabilityinfo_del_batch"],onClick:()=>{$.selectOptions.length>0&&_.confirm(`是否确定删除${$.selectOptions.length}条伤残信息？`,"提示",{type:"warning"}).then((()=>{const e=[];$.selectOptions.map((i=>{e.push(i.id)})),m(e).then((e=>{200==e.code&&e.data?(h.success("删除成功"),I.value.refresh()):h.error(e.msg||"删除失败")}))}))},type:"normal",icon:"icon-ic_edit_delete",disabled:!0}],cellBtns:[{text:"详情",prop:"detail",permission:["archives_tempdisabilityinfo_get"]},{text:"编辑",prop:"edit",permission:["archives_tempdisabilityinfo_edit"]},{text:"删除",prop:"delete",permission:["archives_tempdisabilityinfo_del"]}],detailConf:[{label:"员工姓名",key:"empName"},{label:"身份证号",key:"empIdcard"},{label:"伤残病名称",key:"disabilityName",tooltip:!0},{label:"职业病名称",key:"occupationalDisease",tooltip:!0},{label:"伤残等级",key:"disabilityLevel"},{label:"是否工伤",key:"injuryIdentification"},{label:"伤残开始日期",key:"startTime"},{label:"伤残结束日期",key:"endTime"},{label:"创建人",key:"createName"},{label:"创建时间",key:"createTime"},{label:"备注",key:"remark",tooltip:"true",size:24},{label:"附件内容",key:"",file:"true",size:24}],disabilityGradeList:[],selectOptions:[],params:{}}),{columns:U,cellBtns:q,btn:E,searchConfig:Q}=j($),V=async e=>{try{const i=await r(e);if(i&&200==i.code&&i.data)return{current:i.data.current,total:i.data.total,data:i.data.records.map(((i,t)=>({...i,index:(e.current-1)*e.size+t+1})))}}catch(i){}return{current:1,total:0,data:[]}},F=()=>{I.value.refresh()},H=async(e,i)=>{"delete"===e?_.confirm("是否确定删除？","提示",{type:"warning"}).then((async()=>{const e=await c(i.id);e&&200==e.code?(h.success("删除成功"),F()):h.error(e.msg||"删除失败")}))["catch"]((()=>{})):"edit"===e?R.value.openDialog(i,$.disabilityGradeList):"detail"===e&&p(i.id).then((e=>{if(200==e.code&&e.data){const i=e.data;i.startTime=i.startTime?i.startTime.substring(0,10):"",i.endTime=i.endTime?i.endTime.substring(0,10):"",i.disabilityLevel=f($.disabilityGradeList,i.disabilityLevel),i.injuryIdentification="0"==i.injuryIdentification?"是":"否",z.value&&z.value.openDialog(i,$.detailConf,"伤残信息详情",!0)}else h.error(e.msg||"获取伤残信息详情失败")}))["catch"]((e=>{h.error("获取伤残信息详情失败")}))};return k((()=>{y("disability_grade").then((e=>{e&&200==e.code&&e.data?$.disabilityGradeList=e.data:h.error(e.msg||"获取伤残等级字典失败")}))["catch"]((e=>{h.error(e.msg||"获取伤残等级字典失败")}))})),(s,n)=>{const r=W("el-icon"),o=W("el-button"),m=W("el-dropdown-item"),c=W("el-dropdown-menu"),p=W("el-dropdown"),u=W("el-tag");return C(),T("div",B,[L(e,{ref_key:"proTableRef",ref:I,"row-key":"id",columns:D(U),request:V,btn:D(E),searchConfig:D(Q),multi:!0,onSelectionChange:M},{extBtns:w((()=>[L(p,{"class":"arch-btn","popper-class":"module-download"},{dropdown:w((()=>[L(c,null,{"default":w((()=>[L(m,null,{"default":w((()=>[A])),_:1})])),_:1})])),"default":w((()=>[N("span",P,[L(o,{size:"default"},{"default":w((()=>[Y,L(r,{"class":"el-icon--right"},{"default":w((()=>[L(D(b))])),_:1})])),_:1})])])),_:1})])),injuryIdentification:w((e=>[L(u,{size:"small",type:1==e.injuryIdentification?"info":""},{"default":w((()=>[O(S(1==e.injuryIdentification?"否":"是"),1)])),_:2},1032,["type"])])),option:w((e=>[L(i,{array:D(q),model:e,onOnClick:H},null,8,["array","model"])])),_:1},8,["columns","btn","searchConfig"]),L(l,{ref_key:"attachDetailRef",ref:z},null,512),L(d,{ref_key:"addInvalidismRef",ref:R,onOk:F},null,512),L(t,{ref_key:"batchImportDialogRef",ref:G,header:D(a),url:"/yifu-archives/method/tempdisabilityinfo/importListAdd",onOk:F,errName:"员工伤残信息批量导入",download:!0,type:1},null,8,["header"])])}}}),[["__scopeId","data-v-1807fe74"]]);export{$ as default};