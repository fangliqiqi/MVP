import{d as e,f as l,$ as r,c as o,W as a,P as s,a3 as t,o as i,a as n,T as d,Q as u,R as p,U as m}from"./vue.1672389691407.js";import{_ as c,H as f,E as g}from"./index.1672389691407.js";const h={"class":"reply-add-electronic-container"},w=m("点击上传"),v={key:0,"class":"error-text"},y={"class":"demo-progress"},_={"class":"dialog-footer"},k=m("取 消"),x=m("确 定"),F=e({name:"AddReply"});var b=c(Object.assign(F,{props:{orderNo:null},emits:["ok"],setup(e,{expose:m,emit:c}){const F=e,b=l(null),E=l(null),V=r({isShowDialog:!1,ruleForm:{remark:null,files:null},loading:!1,progress:!1,percentage:0,showError:!1}),D=()=>{var e,l;V.ruleForm={},V.isShowDialog=!1,V.progress=!1,V.showError=!1,V.loading=!1,V.percentage=0,null==(e=null==b?void 0:b.value)||e.clearValidate(),null==(l=null==E?void 0:E.value)||l.clearFiles()},z=()=>{D()},R=()=>{const e=V.ruleForm.files&&V.ruleForm.files.length,l=!!V.ruleForm.remark;V.showError=!e&&!l,V.showError||(e&&(V.progress=!0),V.loading=!0,S())},S=async()=>{var e;try{const l=new FormData;null==(e=V.ruleForm.files)||e.forEach((e=>{l.append("file",e.raw)})),l.append("orderNo",F.orderNo),l.append("replyContent",V.ruleForm.remark||""),l.append("filePath","");const r=await f(l,(e=>{V.percentage=e.loaded/e.total*98|0}));200===r.code?(g.success("上传完成！"),c("ok"),D()):g.error(r.msg)}finally{V.loading=!1,V.progress=!1}};let j=null;const C=(e,l)=>{var r;if(V.showError=!1,e.raw.size>52428800)return null==(r=null==E?void 0:E.value)||r.handleRemove(e),clearTimeout(j),j=setTimeout((()=>{g.error("文件大小不能超过50M！")})),!1;V.ruleForm.files=l},T=()=>{g.error("文件数量最多上传20个")};return m({openDialog:async e=>{V.loading=!1,V.showError=!1,V.ruleForm={remark:null,files:null},setTimeout((()=>{var e;null==(e=null==b?void 0:b.value)||e.clearValidate()}),100),V.isShowDialog=!0}}),(e,l)=>{const r=t("el-input"),m=t("el-form-item"),c=t("el-col"),f=t("el-button"),g=t("el-upload"),F=t("el-row"),S=t("el-form"),j=t("el-progress"),U=t("el-dialog");return i(),o("div",h,[a(U,{title:"添加回复",modelValue:V.isShowDialog,"onUpdate:modelValue":l[3]||(l[3]=e=>V.isShowDialog=e),"close-on-click-modal":!1,width:"538px",onClose:D},{footer:s((()=>[n("span",_,[a(f,{onClick:z,size:"default"},{"default":s((()=>[k])),_:1}),a(f,{type:"primary",onClick:R,size:"default",loading:V.loading},{"default":s((()=>[x])),_:1},8,["loading"])])])),"default":s((()=>[a(S,{ref_key:"formRef",ref:b,model:V.ruleForm,size:"default","label-width":"72px"},{"default":s((()=>[a(F,null,{"default":s((()=>[a(c,{"class":"mb20"},{"default":s((()=>[a(m,{label:"回复内容",prop:"remark"},{"default":s((()=>[a(r,{modelValue:V.ruleForm.remark,"onUpdate:modelValue":l[0]||(l[0]=e=>V.ruleForm.remark=e),placeholder:"请输入",maxlength:"200",clearable:"",rows:2,type:"textarea","show-word-limit":"",onInput:l[1]||(l[1]=e=>V.showError=!1)},null,8,["modelValue"])])),_:1})])),_:1}),a(c,{"class":"mb20"},{"default":s((()=>[a(m,{label:"附件",prop:"files",style:{"margin-bottom":"0"}},{"default":s((()=>[a(g,{"class":"uploadList",style:{"max-width":"100%"},"file-list":V.files,"onUpdate:file-list":l[2]||(l[2]=e=>V.files=e),"on-exceed":T,"on-change":C,"auto-upload":!1,multiple:!0,limit:20,ref_key:"uploadRef",ref:E,accept:".pdf,.png,.jpg,.doc,.docx,.xls,.xlsx,.rar,.zip"},{"default":s((()=>[a(f,null,{"default":s((()=>[w])),_:1})])),_:1},8,["file-list"])])),_:1})])),_:1}),a(c,{"class":"mb20"},{"default":s((()=>[a(m,{style:{"margin-bottom":"0"}},{"default":s((()=>[V.showError?(i(),o("div",v,"回复内容或者附件至少填一项")):d("",!0)])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),u(n("div",y,[a(j,{type:"circle",percentage:V.percentage,color:"var(--el-color-primary)"},null,8,["percentage"])],512),[[p,V.progress]])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-387348c4"]]);export{b as default};