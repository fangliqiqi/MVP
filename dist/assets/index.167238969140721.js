import{g as e,s as a}from"./dept.1672389691407.js";import{P as t}from"./ProTable.1672389691407.js";import{_ as s,d as r}from"./index.1672389691407.js";import{f as n,i as o,$ as i,a2 as c,c as l,W as d,P as u,a3 as m,o as p,a as f,V as h}from"./vue.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";const g={"class":"system-dept-container"};var v=s({name:"部门管理",components:{ProTable:t},setup(){var t;const s=n(null),l=null==(t=o())?void 0:t.appContext.config.globalProperties.$message,d=(e,a,t=[])=>{let s=[],r=[...t];return s=e.map((e=>{const t={...e};if(e.children){const s=d(e.children,a,r),n=s.data;if(r=s.ids,n&&n.length)return t.children=n,r.push(t.id),t}return-1!==e.name.indexOf(a)?(delete t.children,r.push(t.id),t):null})).filter((e=>!!e)),{data:s,ids:r}},u=(e,a)=>{const t=a.name;let r=[];if(t&&t.trim().length){const t=d(e,a.name,[])||{data:[],ids:[]};return r=t.data,s.value&&r.length&&s.value.setExpandRowKeys(t.ids),{current:1,total:r.length,data:r}}s.value&&s.value.refresh()},m=n(!1),p=i({searchConfig:{pagination:!1,onSearch:u},columns:[{dataIndex:"name",title:"部门名称",ellipsis:!0},{dataIndex:"createTime",title:"创建时间",hideInSearch:!0}],btn:[{label:"手动同步",onClick:async()=>{m.value=!0;const e=r.service({lock:!0,text:"数据同步中...",background:"rgba(0, 0, 0, 0.7)","custom-class":"dept-global-loading"});try{const t=await a();t&&200===t.code?(l.success("数据同步成功"),s.value&&s.value.refresh()):l.error(t.msg||"数据同步失败")}catch(t){l.error("数据同步失败")}finally{e.close(),m.value=!1}},loading:m,permission:["sys_dict_add"],icon:"icon-ic_edit_refresh"}]});return{...c(p),request:async a=>{try{const t=await e(a);if(t&&200==t.code&&t.data)return{current:1,total:t.data.length,data:t.data}}catch(t){}return{current:1,total:0,data:[]}},onSearch:u,proRef:s}}},[["render",function(e,a,t,s,r,n){const o=m("pro-table");return p(),l("div",g,[d(o,{ref:"proRef","row-key":"id",columns:e.columns,request:s.request,searchConfig:e.searchConfig,btn:e.btn},{weight:u((e=>[f("span",null,h(e.weight),1)])),_:1},8,["columns","request","searchConfig","btn"])])}],["__scopeId","data-v-9aa4cfc4"]]);export{v as default};