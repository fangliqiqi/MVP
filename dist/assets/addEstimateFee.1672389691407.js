import{c as e,g as l,d as a}from"./fee.1672389691407.js";import{P as t}from"./index.16723896914073.js";import{h as o,E as r}from"./index.1672389691407.js";import{d as u,f as s,$ as d,h as m,j as n,O as i,P as p,n as c,a3 as f,o as h,a as y,W as F,T as g,c as _,a5 as I,U as b,V,F as v}from"./vue.1672389691407.js";const D=b("按个人"),k=b("按项目"),M={"class":"dialog-footer"},x=b("取 消"),w=b("确 定"),C=u({name:"addEstimateFee"}),j=Object.assign(C,{emits:["ok"],setup(u,{expose:C,emit:j}){const Y=s(null),q=s(!1),U=s(null),S=s(null),z=d({isShowDialog:!1,ruleForm:{},data:null,rules:{type:[{required:!0,message:"请选择生成方式"}],customerId:[{required:!0,message:"请选择客户名称"}],settleDomainIds:[{required:!0,message:"请选择项目名称，可多选"}],payMonths:[{required:!0,message:"请选择缴纳月份，可多选"}],empIdCard:[{required:!0,message:"请输入身份证号"}]},ext:{},months:{}});m((()=>z.ruleForm.type),(e=>{0!=e&&1!=e||(z.ruleForm.customerId=null,z.ruleForm.payMonths=null,z.ruleForm.settleDomainIds=null,z.ruleForm.empIdCard=null)}));const O=e=>{z.ruleForm.customerId&&(z.ruleForm.settleDomainIds=null),z.ext={customerId:e.id},c((()=>{U.value&&U.value.refresh()}))},P=async l=>{try{const a=await e(l);if(a&&200==a.code&&a.data)return{current:a.data.current,total:a.data.total,data:a.data.records}}catch(a){}return{current:1,total:0,data:[]}},R=async e=>{try{const a=Object.assign({},e,{flag:"1"}),t=await l(a);if(t&&200==t.code&&t.data)return{current:t.data.current,total:t.data.total,data:t.data.records}}catch(a){}return{current:1,total:0,data:[]}};n((()=>{(e=>{let l={};for(let a=0-e;a<e+1;a++){let e=null;e=a<0?o().subtract(Math.abs(a),"months"):o().add(a,"months");const t=e.format("YYYYMM"),r=e.format("YYYY年MM月");l[t]=r}z.months=l})(6)}));const E=()=>{Y.value&&Y.value.validate((e=>{if(e){let e={};"0"==z.ruleForm.type?e={empIdCard:z.ruleForm.empIdCard,payMonths:z.ruleForm.payMonths.join(",")}:"1"==z.ruleForm.type&&(e={payMonths:z.ruleForm.payMonths.join(","),settleDomainIds:z.ruleForm.settleDomainIds.map((e=>e.id)).join(",")}),q.value=!0,a(e).then((e=>{e&&200==e.code?(r.success("生成成功"),j("ok"),N()):r.error(e.msg||"生成失败")}),(e=>{r.error(e&&e.msg||"生成失败")}))["finally"]((()=>{q.value=!1}))}}))},N=()=>{Y.value&&Y.value.clearValidate(),z.isShowDialog=!1,z.ruleForm={}};return C({openDialog:async e=>{z.data=e,z.ruleForm={type:"0"},z.isShowDialog=!0,c((()=>{setTimeout((()=>{Y.value&&Y.value.clearValidate()}),100)}))},isLoading:q}),(e,l)=>{const a=f("el-radio"),o=f("el-radio-group"),r=f("el-form-item"),u=f("el-col"),s=f("el-input"),d=f("el-option"),m=f("el-select"),n=f("el-row"),c=f("el-form"),C=f("el-button"),j=f("el-dialog");return h(),i(j,{title:"按缴纳月重新生成",modelValue:z.isShowDialog,"onUpdate:modelValue":l[5]||(l[5]=e=>z.isShowDialog=e),width:"576px",onClose:N,"close-on-click-modal":!1},{footer:p((()=>[y("span",M,[F(C,{onClick:N,size:"default"},{"default":p((()=>[x])),_:1}),F(C,{loading:q.value,type:"primary",onClick:E,size:"default"},{"default":p((()=>[w])),_:1},8,["loading"])])])),"default":p((()=>[F(c,{ref_key:"formRef",ref:Y,model:z.ruleForm,rules:z.rules,size:"default","label-width":"110px","validate-on-rule-change":!1},{"default":p((()=>[F(n,null,{"default":p((()=>[F(u,{"class":"mb20"},{"default":p((()=>[F(r,{label:"生成方式",prop:"type"},{"default":p((()=>[F(o,{modelValue:z.ruleForm.type,"onUpdate:modelValue":l[0]||(l[0]=e=>z.ruleForm.type=e)},{"default":p((()=>[F(a,{label:"0"},{"default":p((()=>[D])),_:1}),F(a,{label:"1"},{"default":p((()=>[k])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),1==z.ruleForm.type?(h(),i(u,{key:0,"class":"mb20"},{"default":p((()=>[F(r,{label:"客户名称",prop:"customerId"},{"default":p((()=>[F(t,{ref_key:"customerPageSelectRef",ref:S,modelValue:z.ruleForm.customerId,"onUpdate:modelValue":l[1]||(l[1]=e=>z.ruleForm.customerId=e),request:P,"value-key":"id",onChange:O,title:"name",search:"name",placeholder:"请选择"},null,8,["modelValue"])])),_:1})])),_:1})):g("",!0),1==z.ruleForm.type?(h(),i(u,{key:1,"class":"mb20"},{"default":p((()=>[F(r,{label:"项目名称",prop:"settleDomainIds"},{"default":p((()=>[F(t,{ref_key:"settleDomainRef",ref:U,modelValue:z.ruleForm.settleDomainIds,"onUpdate:modelValue":l[2]||(l[2]=e=>z.ruleForm.settleDomainIds=e),request:R,ext:z.ext,"value-key":"id",title:"departName",search:"departName",placeholder:"请选择，可多选",manual:"",multiple:""},null,8,["modelValue","ext"])])),_:1})])),_:1})):g("",!0),0==z.ruleForm.type?(h(),i(u,{key:2,"class":"mb20"},{"default":p((()=>[F(r,{label:"身份证号",prop:"empIdCard"},{"default":p((()=>[F(s,{modelValue:z.ruleForm.empIdCard,"onUpdate:modelValue":l[3]||(l[3]=e=>z.ruleForm.empIdCard=e),placeholder:"请输入",maxlength:"18"},null,8,["modelValue"])])),_:1})])),_:1})):g("",!0),F(u,{"class":"mb20"},{"default":p((()=>[F(r,{label:"缴纳月份",prop:"payMonths"},{"default":p((()=>[F(m,{modelValue:z.ruleForm.payMonths,"onUpdate:modelValue":l[4]||(l[4]=e=>z.ruleForm.payMonths=e),style:{width:"100%"},multiple:"",placeholder:"请选择，可多选",clearable:""},{"default":p((()=>[(h(!0),_(v,null,I(z.months,((e,l)=>(h(),i(d,{key:l,value:l,label:e},{"default":p((()=>[b(V(e),1)])),_:2},1032,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])}}});export{j as default};