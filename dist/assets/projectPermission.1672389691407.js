import{d as t,f as e,$ as a,c as s,W as i,P as n,ax as o,o as r}from"./vue.1672389691407.js";import{P as l}from"./ProTable.1672389691407.js";import{P as c}from"./index.16723896914072.js";import{g as d,_ as m,a as u,d as p,b as h}from"./addProjectPermission.1672389691407.js";import{v as f}from"./header.1672389691407.js";import{e as g}from"./excel.1672389691407.js";import{h as x,E as y,a as b}from"./index.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";import"./contractPermission.16723896914072.js";import"./fee.1672389691407.js";const j={"class":"cardinal-config-container"},v=t({name:"项目权限"}),C=Object.assign(v,{setup(t){const v=e(null);o();const C=e(null),I=()=>{v.value&&v.value.onSearch()},P=e(!1),k=a({searchConfig:{labelWidth:120},columns:[{dataIndex:"userNickName",title:"员工姓名",minWidth:200,tooltip:!0},{dataIndex:"userLoginName",title:"登录账号",minWidth:180,tooltip:!0},{dataIndex:"userDeptName",title:"所在部门",minWidth:180,tooltip:!0},{dataIndex:"settleDomainName",title:"项目名称",minWidth:200,tooltip:!0},{dataIndex:"settleDomainNo",title:"项目编码",minWidth:200,tooltip:!0},{dataIndex:"status",title:"授权状态",minWidth:120,tooltip:!1,valueEnum:{0:"启用",1:"禁用"}},{dataIndex:"option",title:"操作",key:"option",width:200,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],params:{},btn:[{label:"新增",onClick:()=>{C.value&&C.value.openDialog()},permission:[],icon:"icon-ic_edit_add"},{label:"批量导出",onClick:()=>{P.value=!0;let t=null;t=0!=k.selectionChangeList.length?k.params:Object.assign({},k.params,v.value.getParams()),delete t.size,delete t.current,u(t).then((t=>{g(f,(t.data||[]).map((t=>(t.status=0==t.status?"启用":"禁用",t))),`项目权限批量导出${x().format("YYYYMMDD-HHmmss")}`),y.success("导出成功")}))["finally"]((t=>{P.value=!1}))},loading:P,permission:[],type:"normal",icon:"icon-ic_edit_export"}],cellBtns:[{text:"删除",prop:"delete",permission:[]},{text:"启用",prop:"enable",permission:[],isGray:t=>0==t.status},{text:"禁用",prop:"stop",permission:[],isGray:t=>1==t.status}],selectionChangeList:[],statusRes:0}),w=t=>{k.selectionChangeList=t;let e=null;if(k.selectionChangeList.length>0){const t=[];k.selectionChangeList.map((e=>{t.push(e.id)})),e={idList:t,...v.value.getParams()}}else e={...v.value.getParams()};k.params=e},L=async(t,e)=>{switch(t){case"delete":_(e);break;case"enable":W({id:e.id,status:0,userId:e.userId});break;case"stop":W({id:e.id,status:1,userId:e.userId})}},W=t=>{p(t).then((e=>{e&&200==e.code?(I(),y.success(e.msg||(0==t.status?"启用":"禁用")+"成功")):y.error(e.msg||(0==t.status?"启用":"禁用")+"失败")}),(t=>{}))["finally"]((()=>{k.loading=!1}))},_=t=>{b.confirm('<p style="font-size:16px;font-weight:600">是否确定删除?<br/>\n\t\t\t\t<span style="color:red;font-size:14px;font-weight:400">删除后，配置将从系统消失，请谨慎操作！</span></p>',{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((async()=>{try{const e=await h(t.id);e&&200===e.code?(y.success("删除成功"),I(),v.value.clearAllSelection()):y.error(e.msg||"删除失败")}catch(e){y.error(e&&e.msg||"删除失败")}}))["catch"]((()=>{}))},D=async t=>{try{const e=await d(t);if(e&&200==e.code&&e.data)return{current:e.data.current,total:e.data.total,data:e.data.records}}catch(e){}return{current:1,total:0,data:[]}};return(t,e)=>(r(),s("div",j,[i(l,{ref_key:"proTableRef",ref:v,"row-key":"id",columns:k.columns,request:D,btn:k.btn,searchConfig:k.searchConfig,onSelectionChange:w,multi:""},{option:n((t=>[i(c,{array:k.cellBtns,model:t,onOnClick:L},null,8,["array","model"])])),_:1},8,["columns","btn","searchConfig"]),i(m,{ref_key:"addProjectPermissionRef",ref:C,onOk:I},null,512)]))}});export{C as default};