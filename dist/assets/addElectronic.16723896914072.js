import{d as e,f as l,$ as a,c as r,W as o,P as s,a3 as n,o as t,a as i,Q as u,R as d,U as c}from"./vue.1672389691407.js";import{s as f,_ as m,E as p}from"./index.1672389691407.js";async function g(e,l){return f({url:"/yifu-insurances/method/insuranceEnclosure/getInsuranceEnclosurePage",method:"POST",params:e,data:l})}async function h(e){return f({url:`/yifu-insurances/method/insuranceEnclosure/deleteInsuranceEnclosure/${e}`,method:"GET"})}async function v(e){return f({url:`/yifu-insurances/method/insuranceEnclosure/getInsuranceEnclosureUrl/${e}`,method:"GET"})}const y={"class":"insurance-add-electronic-container"},_=c("点击上传"),w={"class":"demo-progress"},L={"class":"dialog-footer"},k=c("取 消"),x=c("确 定"),b=e({name:"addElectronic"});var E=m(Object.assign(b,{emits:["ok"],setup(e,{expose:c,emit:m}){const g=l(null),h=l(null),v=a({isShowDialog:!1,ruleForm:{remark:null,files:null},fileList:[],loading:!1,progress:!1,percentage:0}),b={files:[{required:!0,message:"请选择需要上传的附件"}]},E=()=>{var e,l;v.ruleForm={},v.isShowDialog=!1,v.fileList=[],v.progress=!1,v.percentage=0,null==(e=null==g?void 0:g.value)||e.clearValidate(),null==(l=null==h?void 0:h.value)||l.clearFiles()},F=()=>{E()},S=()=>{g.value&&g.value.validate((e=>{e&&(v.progress=!0,v.loading=!0,T())}))},T=async()=>{var e;const l=(v.fileList||[]).shift();if(l)try{const a=new FormData;a.append("file",l.raw),a.append("remark",v.ruleForm.remark||""),a.append("filePath","");const r=await async function(e,l){return f({url:"/yifu-insurances/method/insuranceEnclosure/uploadInsuranceEnclosure",method:"POST",data:e,onUploadProgress:l})}(a,(e=>{1==v.fileListLength&&(v.percentage=e.loaded/e.total*98|0)}));200===r.code?null==(e=null==h?void 0:h.value)||e.handleRemove(l):p.error(r.msg),v.percentage=100*((v.fileListLength-v.fileList.length)/v.fileListLength).toFixed(2)}finally{T()}else v.loading=!1,v.progress=!1,v.percentage=0,p.success("上传完成！"),m("ok"),E()};let V=null;const D=(e,l)=>{var a;if(e.raw.size>52428800)return null==(a=null==h?void 0:h.value)||a.handleRemove(e),clearTimeout(V),V=setTimeout((()=>{p.error("文件大小不能超过50M！")})),!1;v.ruleForm.files=l,v.fileList.push(e),v.fileListLength=v.fileList.length},P=e=>{},j=()=>{p.error("文件数量最多上传15个")};return c({openDialog:async e=>{v.loading=!1,v.ruleForm={remark:null,files:null},setTimeout((()=>{g.value&&g.value.clearValidate()}),100),v.isShowDialog=!0}}),(e,l)=>{const a=n("el-input"),c=n("el-form-item"),f=n("el-col"),m=n("el-button"),p=n("el-upload"),T=n("el-row"),V=n("el-form"),z=n("el-progress"),U=n("el-dialog");return t(),r("div",y,[o(U,{title:"电子保单导入",modelValue:v.isShowDialog,"onUpdate:modelValue":l[2]||(l[2]=e=>v.isShowDialog=e),"close-on-click-modal":!1,width:"538px",onClose:E},{footer:s((()=>[i("span",L,[o(m,{onClick:F,size:"default"},{"default":s((()=>[k])),_:1}),o(m,{type:"primary",onClick:S,size:"default",loading:v.loading},{"default":s((()=>[x])),_:1},8,["loading"])])])),"default":s((()=>[o(V,{ref_key:"formRef",ref:g,model:v.ruleForm,rules:b,size:"default","label-width":"70px"},{"default":s((()=>[o(T,null,{"default":s((()=>[o(f,{"class":"mb20"},{"default":s((()=>[o(c,{label:"备注",prop:"remark"},{"default":s((()=>[o(a,{modelValue:v.ruleForm.remark,"onUpdate:modelValue":l[0]||(l[0]=e=>v.ruleForm.remark=e),placeholder:"请输入",maxlength:"50",clearable:"",rows:2,type:"textarea","show-word-limit":""},null,8,["modelValue"])])),_:1})])),_:1}),o(f,{"class":"mb20"},{"default":s((()=>[o(c,{label:"附件",prop:"files"},{"default":s((()=>[o(p,{"class":"uploadList",style:{"max-width":"100%"},"file-list":v.files,"onUpdate:file-list":l[1]||(l[1]=e=>v.files=e),"on-remove":P,"on-exceed":j,"on-change":D,"auto-upload":!1,multiple:!0,ref_key:"uploadRef",ref:h,accept:".pdf,.png,.jpg,.doc,.docx,.xls,.xlsx,.rar,.zip"},{"default":s((()=>[o(m,null,{"default":s((()=>[_])),_:1})])),_:1},8,["file-list"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),u(i("div",w,[o(z,{type:"circle",percentage:v.percentage,color:"var(--el-color-primary)"},null,8,["percentage"])],512),[[d,v.progress]])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-efb50734"]]),F=Object.freeze(Object.defineProperty({__proto__:null,"default":E},Symbol.toStringTag,{value:"Module"}));export{E as a,v as b,F as c,h as d,g};