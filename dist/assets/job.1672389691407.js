import{P as e}from"./ProTable.1672389691407.js";import{P as t}from"./index.16723896914072.js";import{B as a}from"./index.16723896914077.js";import{T as r,U as o}from"./header.1672389691407.js";import{e as i}from"./excel.1672389691407.js";import n from"./attachDetail.1672389691407.js";import s from"./addJob.1672389691407.js";import{D as d,E as l,F as c,G as p,H as m}from"./attach.1672389691407.js";import{_ as h,M as u,N as k,E as g,f,h as w,a as y}from"./index.1672389691407.js";import{d as b,f as _,$ as D,a2 as x,j as I,c as v,W as T,P as S,u as j,a3 as W,o as C,a as O,U as L,V as N,ay as R,az as B}from"./vue.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";import"./xlsx.1672389691407.js";import"./file.1672389691407.js";import"./staff.1672389691407.js";const J=e=>(R("data-v-60a79aa8"),e=e(),B(),e),U={"class":"system-dict-container"},z={"class":"el-dropdown-link"},P=L(" 模板下载 "),Y=J((()=>O("a",{href:"/template/员工工作记录模板.xls",download:""}," 批量导入模板",-1))),M=b({name:"工作记录"});var $=h(Object.assign(M,{setup(h){const b=_(null),R=_(null),B=_(null),J=_(null),M=e=>{$.selectOptions=e,e.length>0?$.btn[3].disabled=!1:$.btn[3].disabled=!0},$=D({searchConfig:{labelWidth:110,option:{extBtn:"extBtns"}},columns:[{dataIndex:"empName",title:"员工姓名",minWidth:180},{dataIndex:"empIdcard",title:"身份证号",minWidth:200},{dataIndex:"workUnit",title:"工作单位",hideInSearch:!0,minWidth:160,tooltip:!0},{dataIndex:"workDepart",title:"工作部门",hideInSearch:!0,minWidth:160,tooltip:!0},{dataIndex:"workJob",title:"工作岗位",hideInSearch:!0,minWidth:160,tooltip:!0},{dataIndex:"workingType\t",title:"工作类型",hideInSearch:!0,minWidth:140,formatter:e=>u($.workTypeList,e.workingType)||"--"},{dataIndex:"workingStatus",title:"在职状态",hideInSearch:!0,minWidth:120,scopedSlots:{customRender:"workingStatus"}},{dataIndex:"startDate",title:"开始工作日期",hideInSearch:!0,minWidth:160,formatter:e=>e.startDate?e.startDate.substring(0,10):""},{dataIndex:"endDate",title:"结束工作日期",hideInSearch:!0,minWidth:160,formatter:e=>e.endDate?e.endDate.substring(0,10):"--"},{dataIndex:"createName",title:"创建人",minWidth:160},{dataIndex:"createTime",title:"创建时间",minWidth:180,searchIndex:"createTimes",valueType:"dateTimeRange"},{dataIndex:"option",title:"操作",key:"option",minWidth:200,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"新增",onClick:()=>{B.value.openDialog("",$.workTypeList)},permission:["archives_tempworkrecording_add"],icon:"icon-ic_edit_add"},{label:"批量导入",permission:["archives_tempworkrecording_importListAdd"],onClick:()=>{J.value&&J.value.openDialog()},type:"normal",icon:"icon-ic_edit_upload"},{label:"批量导出",permission:["archives_tempworkrecording-export"],onClick:()=>{if($.selectOptions.length>0){const e=[];$.selectOptions.map((t=>{e.push(t.id)})),$.params={ids:e.join(",")}}else $.params=b.value.getParams(),delete $.params.size,delete $.params.current;$.btn.find((e=>"批量导出"==e.label)).loading=!0,l($.params).then((e=>{200==e.code?(i(o,e.data.map((e=>({empName:e.empName,empIdcard:e.empIdcard,workUnit:e.workUnit,workDepart:e.workDepart||"",workJob:e.workJob||"",workingType:u($.workTypeList,e.workingType)||"",workingStatus:e.workingStatus?"离职":"在职",startDate:e.startDate?e.startDate.substring(0,10):"",endDate:e.endDate?e.endDate.substring(0,10):""}))),`工作记录批量导出${w().format("YYYYMMDD")}`),g.success("导出成功")):g.error(e.msg)}))["catch"]((e=>{g.error("导出失败")}))["finally"]((()=>{$.btn.find((e=>"批量导出"==e.label)).loading=!1}))},type:"normal",icon:"icon-ic_edit_export"},{label:"批量删除",permission:["archives_tempworkrecording_del_batch"],onClick:()=>{$.selectOptions.length>0&&y.confirm(`是否确定删除${$.selectOptions.length}条工作记录？`,"提示",{type:"warning"}).then((()=>{const e=[];$.selectOptions.map((t=>{e.push(t.id)})),c(e).then((e=>{200==e.code&&e.data?(g.success("删除成功"),b.value.refresh()):g.error(e.msg||"删除失败")}))}))},type:"normal",icon:"icon-ic_edit_delete",disabled:!0}],cellBtns:[{text:"详情",prop:"detail",permission:["archives_tempworkrecording_get"]},{text:"编辑",prop:"edit",permission:["archives_tempworkrecording_edit"]},{text:"删除",prop:"delete",permission:["archives_tempworkrecording_del"]}],detailConf:[{label:"员工姓名",key:"empName"},{label:"身份证号",key:"empIdcard"},{label:"工作单位",key:"workUnit",tooltip:!0},{label:"工作部门",key:"workDepart",tooltip:!0},{label:"工作岗位",key:"workJob",tooltip:!0},{label:"工作类型",key:"workingType"},{label:"在职状态",key:"workingStatus"},{label:"开始工作日期",key:"startDate"},{label:"结束工作日期",key:"endDate"},{label:"创建人",key:"createName"},{label:"创建时间",key:"createTime"}],workTypeList:[],selectOptions:[],params:{}}),{columns:A,cellBtns:E,btn:q,searchConfig:F}=x($),G=async e=>{try{const t=await d(e);if(t&&200==t.code&&t.data)return{current:t.data.current,total:t.data.total,data:t.data.records.map(((t,a)=>({...t,index:(e.current-1)*e.size+a+1})))}}catch(t){}return{current:1,total:0,data:[]}},H=()=>{b.value.refresh()},V=async(e,t)=>{"delete"===e?y.confirm("是否确定删除？","提示",{type:"warning"}).then((async()=>{const e=await p(t.id);e&&200==e.code?(g.success("删除成功"),H()):g.error(e.msg||"删除失败")}))["catch"]((()=>{})):"edit"===e?B.value.openDialog(t,$.workTypeList):"detail"===e&&m(t.id).then((e=>{if(200==e.code){const t=e.data;t.workingType=u($.workTypeList,t.workingType),t.workingStatus=K(t.workingStatus),t.startDate=t.startDate?t.startDate.substring(0,10):"",t.endDate=t.endDate?t.endDate.substring(0,10):"",R.value&&R.value.openDialog(t,$.detailConf,"工作记录详情")}else g.error(e.msg||"获取工作记录详情失败")}))["catch"]((e=>{g.error("获取工作记录详情失败")}))},K=e=>"0"==e?"在职":"离职";return I((()=>{k("workinfo_type").then((e=>{e&&200==e.code&&e.data?$.workTypeList=e.data:g.error(e.msg||"获取工作类型字典失败")}))["catch"]((e=>{g.error(e.msg||"获取工作类型字典失败")}))})),(o,i)=>{const d=W("el-icon"),l=W("el-button"),c=W("el-dropdown-item"),p=W("el-dropdown-menu"),m=W("el-dropdown"),h=W("el-tag");return C(),v("div",U,[T(e,{ref_key:"proTableRef",ref:b,"row-key":"id",columns:j(A),request:G,btn:j(q),searchConfig:j(F),multi:!0,onSelectionChange:M},{extBtns:S((()=>[T(m,{"class":"arch-btn","popper-class":"module-download"},{dropdown:S((()=>[T(p,null,{"default":S((()=>[T(c,null,{"default":S((()=>[Y])),_:1})])),_:1})])),"default":S((()=>[O("span",z,[T(l,{size:"default"},{"default":S((()=>[P,T(d,{"class":"el-icon--right"},{"default":S((()=>[T(j(f))])),_:1})])),_:1})])])),_:1})])),workingStatus:S((e=>[T(h,{size:"small",type:1==e.workingStatus?"info":""},{"default":S((()=>[L(N(1==e.workingStatus?"离职":"在职"),1)])),_:2},1032,["type"])])),option:S((e=>[T(t,{array:j(E),model:e,onOnClick:V},null,8,["array","model"])])),_:1},8,["columns","btn","searchConfig"]),T(n,{ref_key:"attachDetailRef",ref:R},null,512),T(s,{ref_key:"addJobRef",ref:B,onOk:H},null,512),T(a,{ref_key:"batchImportDialogRef",ref:J,header:j(r),errName:"员工工作记录批量导入",download:!0,url:"/yifu-archives/method/tempworkrecording/importListAdd",onOk:H},null,8,["header"])])}}}),[["__scopeId","data-v-60a79aa8"]]);export{$ as default};