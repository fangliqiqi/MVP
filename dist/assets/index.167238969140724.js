import{_ as e,a8 as t,a9 as a,a as n,aa as o,ab as s}from"./index.1672389691407.js";import{P as r}from"./ProTable.1672389691407.js";import{P as i}from"./index.16723896914072.js";import l from"./addMenu.1672389691407.js";import{d as c,f as d,i as u,$ as m,a2 as p,c as f,W as h,P as y,a3 as g,o as x,a as v,J as C}from"./vue.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";const b=c({name:"菜单管理",components:{ProTable:r,ProButtons:i,addMenuVue:l},setup(){var e;const r=d(null),i=d(null),l=null==(e=u())?void 0:e.appContext.config.globalProperties.$message,c=d(!1),f=e=>"0"===e.systemFlag,h=m({searchConfig:{pagination:!1},btn:[{label:"新增",onClick:()=>{i.value.openDialog()},permission:["sys_menu_add"],icon:"icon-ic_edit_add"},{label:"更新缓存",loading:c,onClick:()=>{c.value=!0,s().then((e=>{e&&200==e.code?(l.success("菜单缓存更新成功"),r.value.refresh()):l.error(e.msg||"菜单缓存更新失败")}),(e=>{e?l.error(e.msg||"菜单缓存更新失败"):l.error("菜单缓存更新失败")}))["catch"]()["finally"]((()=>{c.value=!1}))},icon:"icon-ic_edit_refresh"}],columns:[{dataIndex:"name",title:"菜单名称",minWidth:180,ellipsis:!0},{dataIndex:"icon",title:"图标",valueType:"custom",scopedSlots:{customRender:"icon"}},{dataIndex:"sortOrder",title:"排序"},{dataIndex:"path",title:"路由地址",minWidth:140,tooltip:!0},{dataIndex:"type",title:"类型",valueEnum:{0:"菜单",1:"按钮"}},{dataIndex:"permission",title:"权限标识",minWidth:220},{dataIndex:"option",title:"操作",key:"option",minWidth:120,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],cellBtns:[{text:"编辑",prop:"edit",permission:["sys_menu_edit"],tooltip:"当前菜单不可编辑",isGray:f},{text:"删除",prop:"delete",permission:["sys_menu_del"],tooltip:"当前菜单不可删除",isGray:f}]}),y=()=>{r.value.refresh()};return{...p(h),request:async e=>{try{const a=await t(e);if(a&&200==a.code&&a.data)return{current:1,total:a.data.length,data:a.data}}catch(a){}return{current:1,total:0,data:[]}},onCellClick:async(e,t)=>{if("edit"===e)try{const e=await a(t.id);e&&200===e.code?i.value.openDialog(e.data):l.error(e.msg||"获取菜单详情失败")}catch(s){l.error("获取菜单详情失败")}else"delete"===e&&n.confirm("是否确定删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{const e=await o(t.id);e&&200==e.code?(l.success("删除成功"),y()):l.error(e.msg||"删除失败")}catch(s){l.error("删除失败")}}))["catch"]((()=>{}))},proRef:r,addMenuRef:i,refreshList:y}}}),_={"class":"system-menu-container"};var k=e(b,[["render",function(e,t,a,n,o,s){const r=g("pro-buttons"),i=g("pro-table"),l=g("add-menu-vue");return x(),f("div",_,[h(i,{ref:"proRef","row-key":"id",columns:e.columns,request:e.request,showHeader:!1,searchConfig:e.searchConfig,btn:e.btn},{option:y((t=>[h(r,{array:e.cellBtns,model:t,onOnClick:e.onCellClick},null,8,["array","model","onOnClick"])])),icon:y((e=>[v("em",{"class":C(`iconfont ${e.icon}`)},null,2)])),_:1},8,["columns","request","searchConfig","btn"]),h(l,{ref:"addMenuRef",onOk:e.refreshList},null,8,["onOk"])])}]]);export{k as default};