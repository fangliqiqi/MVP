import{P as e}from"./ProTable.1672389691407.js";import{P as a}from"./index.16723896914072.js";import t from"./insureDetailDialog.1672389691407.js";import r from"./insureEditDialog.1672389691407.js";import{B as n}from"./index.16723896914077.js";import{I as o,m as s,n as i,D as l,a7 as d}from"./header.1672389691407.js";import{_ as c,f as u,U as p,h as m,L as h,a as f}from"./index.1672389691407.js";import{e as y}from"./excel.1672389691407.js";import{b as _,c as g,r as x,f as E,h as b,d as I}from"./custserve.1672389691407.js";import v from"./ProjectSelect.1672389691407.js";import{buyHandleStatusList as D,buyType as R,buyHandleStatus as S,settleType as H}from"./dict.1672389691407.js";import{a as w}from"./index.167238969140714.js";import{i as T,f as A,$ as j,a2 as N,c as k,W as B,P as C,a3 as O,o as F,a as U,U as M,V as P,T as Y,ay as K,az as z}from"./vue.1672389691407.js";import"./index.16723896914073.js";import"./index.16723896914074.js";import"./city.1672389691407.js";import"./AreaUnionSelect.1672389691407.js";import"./company.1672389691407.js";import"./xlsx.1672389691407.js";const L={name:"投保",components:{ProTable:e,ProButtons:a,insureDetailDialog:t,insureEditDialog:r,ArrowDown:u,batchImportDialog:n,ProjectSelect:v},setup(){var e;const a=null==(e=T())?void 0:e.appContext.config.globalProperties.$message,t=A(null),r=A(null),n=A(null),c=A(null),u=A(null),v=A(null),k=()=>{t.value&&t.value.doSearch()},B=e=>{const a=h.get("user_info");return(null==a?void 0:a.id)!=e.createBy||4!=e.buyHandleStatus},C=j({params:{deptNo:null,buyHandleStatusList:[1,2,4]},searchConfig:{labelWidth:"90px",option:{extBtn:"extBtns"}},columns:[{dataIndex:"buyHandleStatus",title:"投保状态",width:115,valueEnum:D},{dataIndex:"buyType",title:"投保类型",width:110,hideInSearch:!0,valueEnum:R},{dataIndex:"projectName",title:"项目",minWidth:120,hideInSearch:!0,ellipsis:!0},{dataIndex:"deptNo",title:"项目",minWidth:200,valueType:"PageSelect",hideInTable:!0,request:async e=>{try{const a=Object.assign({},{deleteFlag:0},e),t=await w(a);if(t&&200==t.code&&t.data)return{current:t.data.current,total:t.data.total,data:t.data.records};ElMessage.error(t.msg)}catch(a){}return{current:1,total:0,data:[]}},pageProps:{valueKey:"departNo",title:"departName",search:"departName",parmas:{}},tooltip:!0},{dataIndex:"empName",title:"姓名",width:140,tooltip:!0},{dataIndex:"empIdcardNo",title:"身份证号",width:170},{dataIndex:"insuranceCompanyName",title:"保险公司",minWidth:120,hideInSearch:!0,ellipsis:!0},{dataIndex:"insuranceTypeName",title:"险种",minWidth:120,hideInSearch:!0,ellipsis:!0},{dataIndex:"policyTimeRange",title:"保单起止时间",minWidth:230,hideInSearch:!0,valueType:"custom",scopedSlots:{customRender:"BeginEndTime"}},{dataIndex:"buyStandard",title:"购买标准",minWidth:110,hideInSearch:!0},{dataIndex:"createName",title:"派单人",minWidth:110,hideInSearch:!0},{dataIndex:"createTime",title:"派单日期",width:100,hideInSearch:!0,dateFormat:"YYYY-MM-DD"},{dataIndex:"option",title:"操作",key:"option",width:180,hideInSearch:!0,fixed:"right",scopedSlots:{customRender:"option"}}],btn:[{label:"新增投保",onClick:()=>{r.value&&r.value.openDialog()},permission:["insurance_custserve_insure_add"],icon:"icon-ic_edit_add"},{label:"批增",onClick:()=>{n.value&&n.value.openDialog()},permission:["insurance_custserve_insure_batch_add"],icon:"icon-ic_edit_add"},{label:"替换",type:"normal",onClick:()=>{v.value&&v.value.openDialog()},permission:["insurance_custserve_insure_update"],icon:"icon-ic_edit_refresh"},{label:"导出",type:"normal",onClick:()=>{const e=Object.assign({},C.params,t.value.getParams());delete e.size,delete e.current,C.btn.find((e=>"导出"==e.label)).loading=!0,b(e).then((e=>{y(d,(e.data||[]).map((e=>(e.buyHandleStatus=S[e.buyHandleStatus],e.settleType=H[e.settleType],e.buyType=R[e.buyType],e))),`商险投保人员名册_${m().format("YYYYMMDDHHmmss")}`),a.success("导出成功")}))["finally"]((()=>{C.btn.find((e=>"导出"==e.label)).loading=!1}))},permission:["insurance_custserve_insure_export"],icon:"icon-ic_edit_export"}],cellBtns:[{text:"查看",prop:"detail",permission:["insurance_custserve_insure_detail"]},{text:"编辑",prop:"edit",permission:["insurance_custserve_insure_edit"],tooltip:"当前状态不可编辑",isGray:B},{text:"删除",prop:"delete",permission:["insurance_custserve_insure_delete"],tooltip:"当前状态不可删除",isGray:B}]});return{...N(C),request:async e=>{const a=Object.assign({},C.params,e);try{const e=await E({size:a.size,current:a.current,mId:a.mId},a);if(e&&200==e.code&&e.data)return{current:e.data.current,total:e.data.total,data:e.data.records||[]}}catch(t){}return{current:1,total:0,data:[]}},onCellClick:async(e,t)=>{switch(e){case"detail":c.value&&c.value.openDialog(t);break;case"edit":u.value&&u.value.openDialog(t);break;case"delete":(e=>{f.confirm('<p style="font-size:16px;font-weight:600">是否确定删除?<br/>\n\t\t\t\t<span style="color:red;font-size:14px;font-weight:400">删除后，投保记录将从系统消失，请谨慎操作！</span></p>',{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((async()=>{try{const t=await I(e.id);200===t.code?a.success("删除成功"):a.error(t.msg||"删除失败")}catch(t){a.error("删除失败")}finally{k()}}))["catch"]((()=>{}))})(t)}},proTableRef:t,addInsureRef:r,addBatchInsureRef:n,insureChangeRef:v,refreshList:()=>{t.value&&t.value.refresh()},doSearchList:k,insureDetailRef:c,insureEditRef:u,onReset:()=>{C.params={deptNo:null,buyHandleStatusList:[1,2,4]}},INSURE_ADD_HEADER:o,INSURE_BATCH_HEADER:s,INSURE_CHANGE_HEADER:i,formatRangeDateAndDiff:p,addInsuranceByFile:(e,a)=>_(a),customErrorHeader:e=>{const a=[];return Object.keys(e).forEach((t=>{a.push({header:e[t],key:t,width:18})})),a.push({header:"错误原因",key:"errorMessage",width:30}),a},addBatchInsuranceByFile:(e,a)=>g(a),changeInsuranceByFile:(e,a)=>x(a),DATE_FORMAT_KEY:l}}},W=e=>(K("data-v-0be7b05a"),e=e(),z(),e),q={"class":"custserve-container"},G={"class":"el-dropdown-link"},V=M(" 模板下载 "),$=W((()=>U("a",{href:"/template/insurance/商险新增模板.xlsx",download:""},"新增投保模板",-1))),J=W((()=>U("a",{href:"/template/insurance/商险批增模板.xlsx",download:""},"批增模板",-1))),Q=W((()=>U("a",{href:"/template/insurance/商险替换模板.xlsx",download:""},"替换模板",-1))),X={key:0,style:{color:"red"}},Z=W((()=>U("div",null,[
U("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"新增投保失败！"),
U("span",null,[
M("存在不符合要求的数据，请修改后，重新导入！"),
U("br"),
M("已为您下载反馈结果！")])],-1))),ee=W((()=>U("div",null,[
U("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"批增投保失败！"),
U("span",null,[
M("存在不符合要求的数据，请修改后，重新导入！"),
U("br"),
M("已为您下载反馈结果！")])],-1))),ae=W((()=>U("div",null,[
U("div",{style:{color:"red","font-size":"24px","text-align":"center",margin:"10px 0 25px"}},"替换投保失败！"),
U("span",null,[
M("存在不符合要求的数据，请修改后，重新导入！"),
U("br"),
M("已为您下载反馈结果！")])],-1)));var te=c(L,[["render",function(e,a,t,r,n,o){const s=O("arrow-down"),i=O("el-icon"),l=O("el-button"),d=O("el-dropdown-item"),c=O("el-dropdown-menu"),u=O("el-dropdown"),p=O("project-select"),m=O("pro-buttons"),h=O("pro-table"),f=O("insure-detail-dialog"),y=O("insure-edit-dialog"),_=O("batch-import-dialog");return F(),k("div",q,[B(h,{ref:"proTableRef","row-key":"id",columns:e.columns,request:r.request,btn:e.btn,searchConfig:e.searchConfig,onOnReset:r.onReset},{extBtns:C((()=>[B(u,{"popper-class":"module-download",style:{"margin-left":"6px"}},{dropdown:C((()=>[B(c,null,{"default":C((()=>[B(d,null,{"default":C((()=>[$])),_:1}),B(d,null,{"default":C((()=>[J])),_:1}),B(d,null,{"default":C((()=>[Q])),_:1})])),_:1})])),"default":C((()=>[U("span",G,[B(l,{size:"default"},{"default":C((()=>[V,B(i,{"class":"el-icon--right"},{"default":C((()=>[B(s)])),_:1})])),_:1})])])),_:1})])),BeginEndTime:C((e=>[M(P(r.formatRangeDateAndDiff(e.policyStart,e.policyEnd))+" ",1),e.buyMonth?(F(),k("span",X,P(`${e.buyMonth}个月`),1)):Y("",!0)])),ProjectSelect:C((()=>[B(p,{modelValue:e.params.deptNo,"onUpdate:modelValue":a[0]||(a[0]=a=>e.params.deptNo=a),style:{width:"100%"}},null,8,["modelValue"])])),option:C((a=>[B(m,{array:e.cellBtns,model:a,onOnClick:r.onCellClick},null,8,["array","model","onOnClick"])])),_:1},8,["columns","request","btn","searchConfig","onOnReset"]),B(f,{ref:"insureDetailRef"},null,512),B(y,{ref:"insureEditRef",onOk:r.doSearchList},null,8,["onOk"]),B(_,{title:"新增投保",ref:"addInsureRef",header:r.INSURE_ADD_HEADER,upload:r.addInsuranceByFile,onOk:r.refreshList,type:1,customError:"",errorHeader:r.customErrorHeader(r.INSURE_ADD_HEADER),download:"",dateFormatKeys:r.DATE_FORMAT_KEY},{error:C((()=>[Z])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"]),B(_,{title:"批增投保",ref:"addBatchInsureRef",header:r.INSURE_BATCH_HEADER,upload:r.addBatchInsuranceByFile,onOk:r.refreshList,type:1,customError:"",errorHeader:r.customErrorHeader(r.INSURE_BATCH_HEADER),download:"",dateFormatKeys:r.DATE_FORMAT_KEY},{error:C((()=>[ee])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"]),B(_,{title:"替换投保",ref:"insureChangeRef",header:r.INSURE_CHANGE_HEADER,upload:r.changeInsuranceByFile,onOk:r.refreshList,type:1,customError:"",errorHeader:r.customErrorHeader(r.INSURE_CHANGE_HEADER),download:"",dateFormatKeys:r.DATE_FORMAT_KEY},{error:C((()=>[ae])),_:1},8,["header","upload","onOk","errorHeader","dateFormatKeys"])])}],["__scopeId","data-v-0be7b05a"]]);export{te as default};