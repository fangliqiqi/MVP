import{d as a,f as e,k as t,j as r,$ as s,c as l,a as o,W as i,P as n,u,ay as c,az as d,aD as m,aA as p,i as f,a3 as b,o as g,F as k,a5 as y,O as h,V as _,U as v,T as F}from"./vue.1672389691407.js";import{_ as S,E as T,c as j,g as w,e as L,h as N,t as R}from"./index.1672389691407.js";import{b as V,c as D}from"./contract.1672389691407.js";import{h as x}from"./header.1672389691407.js";import{g as C}from"./file.1672389691407.js";import{e as P}from"./events.1672389691407.js";const H=a=>(c("data-v-3a52825a"),a=a(),d(),a),M={"class":"contract-audit-detail"},U={"class":"content"},q={"class":"basic-info section-container"},A=H((()=>o("div",{"class":"title",style:{"margin-bottom":"12px"}},[
o("span",null,"基础信息")],-1))),I=["innerHTML"],O={"class":"desc-content"},E={"class":"detail-tooltip-container"},Y=["innerHTML"],z={style:{"margin-bottom":"8px"}},K=["href","download"],$={key:1},W={"class":"detail-tooltip-container"},B=["innerHTML"],G={"class":"audit-info section-container"},J=H((()=>o("div",{"class":"title",style:{"margin-bottom":"18px"}},[
o("span",null,"审核信息")],-1))),Q=v("通过"),X=v("不通过"),Z={"class":"operation-container"},aa=v("返 回"),ea=v("保 存"),ta=a({name:"contractAuditDetail"});var ra=S(Object.assign(ta,{setup(a){const c=m(),d=p(),{proxy:S}=f(),H=e(null),ta=t((()=>{if("终止"==da.info.situation){const a=["leaveDate","reduceReason"];return[...da.abolishParams.slice(0,4),...a,...da.abolishParams.slice(4,20)]}return da.isAbolish?da.abolishParams:da.normalParams})),ra=()=>{H.value&&H.value.clearValidate()},sa=t((()=>"3"==da.ruleForm.auditStatus&&"其他"!=da.ruleForm.remark?(H.value.clearValidate(["auditRemark"]),{auditStatus:[{required:!0,message:"请选择审核意见",trigger:"blur"}],remark:[{required:!0,message:"请选择原因",trigger:"change"}]}):"其他"==da.ruleForm.remark?{auditStatus:[{required:!0,message:"请选择审核意见",trigger:"blur"}],auditRemark:[{required:!0,message:"请填写说明",trigger:"blur"}],remark:[{required:!0,message:"请选择原因",trigger:"change"}]}:{auditStatus:[{required:!0,message:"请选择审核意见",trigger:"blur"}]})),la=()=>{H.value&&H.value.validate((async a=>{if(a){da.loading=!0;const a=da.ruleForm.auditRemark?":"+da.ruleForm.auditRemark:"",e={auditStatus:da.ruleForm.auditStatus,auditRemark:2==da.ruleForm.auditStatus?da.ruleForm.auditRemark:da.ruleForm.remark+a};V(Object.assign({},e,{id:da.info.id})).then((a=>{a&&200===a.code?(T.success("审核成功"),na()):T.error(a.msg||"审核失败")}),(a=>{T.error(a&&a.msg||"审核失败")}))["finally"]((()=>{da.loading=!1}))}}))},oa=a=>x[a],ia=async()=>{try{const a=await w(da.dictKeys);a&&(da.DICTS=a,da.refuseOptions=a["dispatch-audit-add-reason"])}catch(a){}};r((async()=>{d.params&&d.params.id?(da.staffId=d.params.id,(async a=>{ia(),da.id=a;try{const e=await D(a);if(e&&200===e.code){const a=e.data;da.info=e.data,"作废"==a.situation||"终止"==a.situation?da.isAbolish=!0:da.isAbolish=!1}else T.error(e.msg||"获取合同详情失败"),na();const t=await C(a);t&&200==t.code?da.fileList=t.data.map((a=>(a.name=a.attaName,a.uid=a.id,a.url=a.attaUrl,a))):(da.fileList=[],T.error(e.msg||"获取合同申请附件失败"))}catch(e){T.error(e&&e.msg||"获取合同详情失败"),na()}})(d.params.id)):(T.error("不合法的路由地址"),na())}));const na=()=>{try{c.push({path:"/contract/contractCheck"}),j(d,S),P(S,"/contract/contractCheck")}catch(a){}},ua=(a,e)=>R(a,e,da.DICTS),ca=a=>{let e=da.info[a];switch(a){case"empNatrue":e=ua("emp_natrue",da.info[a]);break;case"workingHours":e=ua("working_hours",da.info[a]);break;case"contractType":e=ua("employee_contract_type",da.info[a]);break;case"type":e=ua("check_type",da.info[a]);break;case"contractStart":case"contractEnd":e=da.info[a]?N(da.info[a]).format("YYYY-MM-DD"):L;break;default:if(null==e||""==e)return L}return e},da=s({id:null,loading:!1,info:{},DICTS:{},fileList:[],ruleForm:{},refuseOptions:{},dictKeys:["emp_natrue","situation_type","personnel_state","employee_contract_type","working_hours","contract_business_type","dispatch-audit-add-reason","check_type"],isAbolish:!1,abolishParams:["empName","subjectDepart","empNatrue","situation","contractName","contractSubName","subjectUnit","contractParty","contractType","type","contractStart","contractEnd","reason"],normalParams:["empName","subjectDepart","empNatrue","situation","contractName","contractSubName","type","reason","subjectUnit","contractParty","contractType","contractStart","contractEnd","contractTerm","post","workingHours","contractNo","fileCabinetNo","file","remark"]}),ma=a=>"reason"===a||"remark"===a||"file"===a?24:"reduceReason"===a?18:6;return(a,e)=>{const t=b("el-tooltip"),r=b("el-col"),s=b("el-row"),c=b("el-radio"),d=b("el-radio-group"),m=b("el-form-item"),p=b("el-option"),f=b("el-select"),S=b("el-input"),T=b("el-form"),j=b("el-button");return g(),l("div",M,[o("div",U,[o("div",q,[A,i(s,null,{"default":n((()=>[(g(!0),l(k,null,y(u(ta),(a=>(g(),h(r,{key:`basicInfo_${a}`,"class":"basic-info-item",span:ma(a)},{"default":n((()=>[o("span",{"class":"desc-title",innerHTML:oa(a)},null,8,I),o("div",O,["file"===a?(g(),l(k,{key:0},[da.fileList&&da.fileList.length?(g(!0),l(k,{key:0},y(da.fileList,(a=>(g(),h(t,{key:a.uid,placement:"top-start",effect:"dark","popper-class":"detail-tooltip-popper"},{content:n((()=>[o("div",E,[o("span",{innerHTML:a.name},null,8,Y)])])),"default":n((()=>[o("div",z,[o("a",{href:a.url,download:a.name,target:"_blank"},_(a.name),9,K)])])),_:2},1024)))),128)):(g(),l("span",$,_(u(L)),1))],64)):(g(),h(t,{key:1,placement:"top-start",effect:"dark",content:ca(a),"popper-class":"detail-tooltip-popper"},{content:n((()=>[o("div",W,[o("span",{innerHTML:ca(a)},null,8,B)])])),"default":n((()=>[o("span",null,_(ca(a)),1)])),_:2},1032,["content"]))])])),_:2},1032,["span"])))),128))])),_:1})]),o("div",G,[J,i(T,{ref_key:"formRef",ref:H,model:da.ruleForm,rules:u(sa),size:"default","label-width":"100px"},{"default":n((()=>[i(s,null,{"default":n((()=>[i(r,{"class":"mb20"},{"default":n((()=>[i(m,{label:"审核意见",prop:"auditStatus"},{"default":n((()=>[i(d,{modelValue:da.ruleForm.auditStatus,"onUpdate:modelValue":e[0]||(e[0]=a=>da.ruleForm.auditStatus=a),onChange:ra},{"default":n((()=>[i(c,{label:"2"},{"default":n((()=>[Q])),_:1}),i(c,{label:"3"},{"default":n((()=>[X])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(r,{"class":"mb20"},{"default":n((()=>["3"==da.ruleForm.auditStatus?(g(),h(m,{key:0,label:"原因",prop:"remark"},{"default":n((()=>[i(f,{modelValue:da.ruleForm.remark,"onUpdate:modelValue":e[1]||(e[1]=a=>da.ruleForm.remark=a),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:""},{"default":n((()=>[(g(!0),l(k,null,y(da.refuseOptions,((a,e)=>(g(),h(p,{label:a,key:e,value:a},{"default":n((()=>[v(_(a),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):F("",!0)])),_:1}),i(r,{"class":"mb20"},{"default":n((()=>[i(m,{label:"说明",prop:"auditRemark"},{"default":n((()=>[i(S,{modelValue:da.ruleForm.auditRemark,"onUpdate:modelValue":e[2]||(e[2]=a=>da.ruleForm.auditRemark=a),type:"textarea",placeholder:"请输入审核意见，不超过150字",maxlength:"150",clearable:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])]),o("div",Z,[i(j,{onClick:na,style:{height:"100%"}},{"default":n((()=>[aa])),_:1}),i(j,{type:"primary",onClick:la,loading:da.loading,style:{height:"100%"}},{"default":n((()=>[ea])),_:1},8,["loading"])])])}}}),[["__scopeId","data-v-3a52825a"]]);export{ra as default};